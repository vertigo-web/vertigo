"use strict";const e=e=>{throw Error("assert never")},t=new TextDecoder("utf-8"),s=new TextEncoder;class r{constructor(e,t,s){this.getUint8Memory=e,this.ptr=t,this.size=s,this.pointer=0,this.dataView=new DataView(this.getUint8Memory().buffer,this.ptr,this.size)}getByte(){const e=this.dataView.getUint8(this.pointer);return this.pointer+=1,e}setByte(e){this.dataView.setUint8(this.pointer,e),this.pointer+=1}getU16(){const e=this.dataView.getUint16(this.pointer);return this.pointer+=2,e}setU16(e){this.dataView.setUint16(this.pointer,e),this.pointer+=2}getU32(){const e=this.dataView.getUint32(this.pointer);return this.pointer+=4,e}setU32(e){this.dataView.setUint32(this.pointer,e),this.pointer+=4}getI32(){const e=this.dataView.getInt32(this.pointer);return this.pointer+=4,e}setI32(e){this.dataView.setInt32(this.pointer,e),this.pointer+=4}getU64(){const e=this.dataView.getBigUint64(this.pointer);return this.pointer+=8,e}setU64(e){this.dataView.setBigUint64(this.pointer,e),this.pointer+=8}getI64(){const e=this.dataView.getBigInt64(this.pointer);return this.pointer+=8,e}setI64(e){this.dataView.setBigInt64(this.pointer,e),this.pointer+=8}getF64(){const e=this.dataView.getFloat64(this.pointer);return this.pointer+=8,e}setF64(e){this.dataView.setFloat64(this.pointer,e),this.pointer+=8}getBuffer(){const e=this.getU32(),t=this.getUint8Memory().subarray(this.ptr+this.pointer,this.ptr+this.pointer+e);return this.pointer+=e,t}setBuffer(e){const t=e.length;this.setU32(t);this.getUint8Memory().subarray(this.ptr+this.pointer,this.ptr+this.pointer+t).set(e),this.pointer+=t}getString(){return t.decode(this.getBuffer())}setString(e){const t=s.encode(e);this.setBuffer(t)}getSavedSize(){return this.pointer}}const n=e=>(new TextEncoder).encode(e).length;var o;!function(e){e.isString=e=>"string"==typeof e,e.isStringOrNull=e=>null===e||"string"==typeof e,e.isNumber=e=>"object"==typeof e&&null!==e&&"type"in e&&(e.type===g.I32||e.type===g.U32),e.isBigInt=e=>"object"==typeof e&&null!==e&&"type"in e&&(e.type===g.I64||e.type===g.U64)}(o||(o={}));const i=1,a=2,c=3,l=4,u=5,h=6,d=7,f=e=>{if("boolean"==typeof e)return 1;if(null===e)return 1;if("string"==typeof e)return 5+n(e);if(Array.isArray(e)){let t=5;for(const s of e)t+=f(s);return t}if("number"==typeof e)return 9;let t=3;for(const[s,r]of Object.entries(e))t+=4+n(s),t+=f(r);return t},p=e=>{const t=e.getByte();if(t===i)return!0;if(t===a)return!1;if(t===c)return null;if(t===l)return e.getString();if(t===u)return e.getF64();if(t===h){const t=[],s=e.getU32();for(let r=0;r<s;r++)t.push(p(e));return t}const s={},r=e.getU16();for(let t=0;t<r;t++){const t=e.getString(),r=p(e);s[t]=r}return s},m=(e,t)=>{if(!0===e)return void t.setByte(i);if(!1===e)return void t.setByte(a);if(null===e)return void t.setByte(c);if("string"==typeof e)return t.setByte(l),void t.setString(e);if("number"==typeof e)return t.setByte(u),void t.setF64(e);if(Array.isArray(e)){t.setByte(h),t.setU32(e.length);for(const s of e)m(s,t);return}const s=[];for(const[t,r]of Object.entries(e))s.push([t,r]);t.setByte(d),t.setU16(s.length);for(const[e,r]of s)t.setString(e),m(r,t)},g={U32:1,I32:2,U64:3,I64:4,F64:5,True:6,False:7,Null:8,Undefined:9,Vec:10,String:11,List:12,Object:13,Json:14},y=e=>{const t=e.getByte();if(t===g.U32)return{type:g.U32,value:e.getU32()};if(t===g.I32)return{type:g.I32,value:e.getI32()};if(t===g.U64)return{type:g.U64,value:e.getU64()};if(t===g.I64)return{type:g.I64,value:e.getI64()};if(t===g.F64)return{type:g.F64,value:e.getF64()};if(t===g.True)return!0;if(t===g.False)return!1;if(t===g.Null)return null;if(t!==g.Undefined){if(t===g.Vec)return e.getBuffer();if(t===g.String)return e.getString();if(t===g.List){const t=[],s=e.getU32();for(let r=0;r<s;r++)t.push(y(e));return t}if(t===g.Object){const t={},s=e.getU16();for(let r=0;r<s;r++){const s=e.getString(),r=y(e);t[s]=r}return{type:g.Object,value:t}}if(t===g.Json){const t=p(e);return{type:g.Json,value:t}}throw console.error("typeParam",t),Error("Invalid branch")}},w=t=>{if(!0===t||!1===t||null==t)return 1;if(o.isString(t))return 5+n(t);if(Array.isArray(t)){let e=5;for(const s of t)e+=w(s);return e}if(t instanceof Uint8Array)return 5+t.length;if(t.type===g.I32||t.type===g.U32)return 5;if(t.type===g.I64||t.type===g.U64||t.type==g.F64)return 9;if(t.type===g.Object){let e=3;for(const[s,r]of Object.entries(t.value))e+=4+n(s),e+=w(r);return e}return t.type===g.Json?1+f(t.value):e()},v=(t,s)=>{if(!0!==t)if(!1!==t)if(null!==t)if(void 0!==t){if(t instanceof Uint8Array)return s.setByte(g.Vec),void s.setBuffer(t);if(o.isString(t))return s.setByte(g.String),void s.setString(t);if(Array.isArray(t)){s.setByte(g.List),s.setU32(t.length);for(const e of t)v(e,s)}else{if(t.type===g.U32)return s.setByte(g.U32),void s.setU32(t.value);if(t.type===g.I32)return s.setByte(g.I32),void s.setI32(t.value);if(t.type===g.U64)return s.setByte(g.U64),void s.setU64(t.value);if(t.type===g.I64)return s.setByte(g.I64),void s.setI64(t.value);if(t.type===g.F64)return s.setByte(g.F64),void s.setF64(t.value);if(t.type!==g.Object)return t.type===g.Json?(s.setByte(g.Json),void m(t.value,s)):e();{const e=[];for(const[s,r]of Object.entries(t.value))e.push([s,r]);s.setByte(g.Object),s.setU16(e.length);for(const[t,r]of e)s.setString(t),v(r,s)}}}else s.setByte(g.Undefined);else s.setByte(g.Null);else s.setByte(g.False);else s.setByte(g.True)},_=t=>{if(!0===t)return!0;if(!1===t)return!1;if(null===t)return null;if(void 0!==t){if(t instanceof Uint8Array)return t;if(o.isString(t))return t;if(Array.isArray(t)){const e=[];for(const s of t)e.push(_(s));return e}if(t.type===g.U32||t.type===g.I32)return t.value;if(t.type===g.U64||t.type===g.I64||t.type===g.F64)return t.value;if(t.type===g.Object){const e={};for(const[s,r]of Object.entries(t.value))e[s]=_(r);return e}return t.type===g.Json?t.value:e()}},b=e=>{if("string"==typeof e)return e;if(!0===e||!1===e||null==e)return e;if("number"==typeof e)return e===(0|e)?-2147483648<=e&&e<2**31?{type:g.I32,value:e}:{type:g.I64,value:BigInt(e)}:{type:g.F64,value:e};if("bigint"==typeof e)return{type:g.I64,value:e};if(e instanceof Uint8Array)return e;if("object"==typeof e){try{const t=k(e);return{type:g.Json,value:t}}catch(e){}const t={};for(const[s,r]of Object.entries(e))t[s]=b(r);return{type:g.Object,value:t}}if(Array.isArray(e))try{const t=e.map(k);return{type:g.Json,value:t}}catch(t){return e.map(b)}throw console.warn("convertToJsValue",e),Error("It is not possible to convert this data to JsValue")},k=e=>{if("boolean"==typeof e||null===e||"number"==typeof e||"string"==typeof e)return e;if(Array.isArray(e))return e.map(k);if("object"==typeof e){const t={};for(const[s,r]of Object.entries(e))t[s]=k(r);return t}throw console.warn("convertToJsJson",e),Error("It is not possible to convert this data to JsJson")},U=async(e,t)=>{const s=await(async(e,t)=>{if("function"==typeof WebAssembly.instantiateStreaming){const s=fetch(e);try{return await WebAssembly.instantiateStreaming(s,t)}catch(e){console.warn("`WebAssembly.instantiateStreaming` failed. This could happen if your server does not serve wasm with `application/wasm` MIME type, but check the original error too. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e)}}console.info("fetchModule by WebAssembly.instantiate");const s=await fetch(e),r=await s.arrayBuffer();return await WebAssembly.instantiate(r,t)})(e,t);let n=new Uint8Array(1);const o=()=>{if(s.instance.exports.memory instanceof WebAssembly.Memory)return n.buffer!==s.instance.exports.memory.buffer&&(n=new Uint8Array(s.instance.exports.memory.buffer)),n;throw Error("Missing memory")},i=s.instance.exports,a=(e,t)=>((e,t,s)=>{try{const n=new r(e,t,s);return y(n)}catch(e){return console.error(e),[]}})(o,e,t),c=e=>((e,t,s)=>{if(void 0===s)return 0;const n=w(s),o=t(n),i=new r(e,o,n);if(v(s,i),n!==i.getSavedSize())throw console.error({size:n,savedSize:i.getSavedSize()}),Error("Mismatch between calculated and recorded size");return o})(o,i.alloc,e);return{exports:i,decodeArguments:a,getUint8Memory:o,wasm_callback:(e,t)=>{const s=c(t);let r=i.wasm_callback(e,s);if(0n===r)return;const n=r%2n**32n,o=r>>32n;o>=2n**32n&&console.error(`Overflow of a variable with a pointer result_ptr_and_size=${r}`);const l=a(Number(o),Number(n));return i.free(Number(o)),l},valueSaveToBuffer:c}};class x{constructor(){this.get=e=>{for(const t of document.cookie.split(";")){if(""===t)continue;const s=t.trim().split("=");if(2!==s.length){console.warn(`Cookies.get: Incorrect number of cookieChunk => ${s.length} in ${t}`);continue}const r=s[0],n=s[1];if(void 0!==r&&void 0!==n){if(r===e)return decodeURIComponent(n)}else console.warn(`Cookies.get: Broken cookie part => ${t}`)}return""},this.get_json=e=>{let t=this.get(e);if(0!==t.length)try{return JSON.parse(t)}catch(e){console.error("Error deserializing cookie",e)}return null},this.set=(e,t,s)=>{const r=null==t?"":encodeURIComponent(t),n=new Date;n.setTime(n.getTime()+1e3*Number(s));let o="expires="+n.toUTCString();document.cookie=`${e}=${r};${o};path=/;samesite=strict"`},this.set_json=(e,t,s)=>{let r=JSON.stringify(t);this.set(e,r,s)}}}class E{constructor(e){this.interval_set=(e,t)=>setInterval((()=>{this.getWasm().wasm_callback(t,void 0)}),e),this.interval_clear=e=>{clearInterval(e)},this.timeout_set=(e,t)=>setTimeout((()=>{this.getWasm().wasm_callback(t,void 0)}),e),this.timeout_clear=e=>{clearTimeout(e)},this.getWasm=e}}class A{constructor(e){this.trigger=()=>{for(const e of Array.from(this.callback.values()))e()},this.add=e=>{this.callback.set(e,(()=>{this.getWasm().wasm_callback(e,this.get())}))},this.remove=e=>{this.callback.delete(e)},this.push=e=>{this.get()!==e&&(location.hash=e,this.trigger())},this.getWasm=e,this.callback=new Map,window.addEventListener("hashchange",this.trigger)}get(){return decodeURIComponent(location.hash.substr(1))}}const S=async(e,t,s,r)=>{try{await r(s)}catch(r){console.error("fetch error (2) - json",r);const n=new String(r).toString();e.wasm_callback(t,[!1,{type:g.U32,value:s.status},n])}};class I{constructor(e){this.fetch_send_request=(e,t,s,r,n)=>{this.fetch_send_request_inner(e,t,s,r,n)},this.fetch_send_request_inner=async(e,t,s,r,n)=>{const o=this.getWasm(),[i,a]=((e,t)=>{const s=new Headers(e);return void 0===t?[s,void 0]:"string"==typeof t?(!1===s.has("content-type")&&s.set("content-type","text/plain; charset=utf-8"),[s,t]):t instanceof Uint8Array?(!1===s.has("content-type")&&s.set("content-type","application/octet-stream"),[s,t]):(!1===s.has("content-type")&&s.set("content-type","application/json; charset=utf-8"),[s,JSON.stringify(t)])})(r,n);try{const r=await fetch(s,{method:t,headers:i,body:a}),n=(e=>{if(null===e)return console.info("Missing header content-type"),"bin";const[t]=e.split(";");if(void 0===t)return console.error("Missing value for content-type"),"bin";const s=t.toLowerCase().trim();return"application/json"===s?"json":"text/plain"===s?"text":(console.error(`No match found for content-type=${e}`),"bin")})(r.headers.get("content-type"));if("json"===n)return void S(o,e,r,(async t=>{const s=await t.json();o.wasm_callback(e,[!0,{type:g.U32,value:t.status},{type:g.Json,value:s}])}));if("text"===n)return void S(o,e,r,(async t=>{const s=await t.text();o.wasm_callback(e,[!0,{type:g.U32,value:t.status},s])}));S(o,e,r,(async t=>{const s=await t.arrayBuffer(),r=new Uint8Array(s);o.wasm_callback(e,[!0,{type:g.U32,value:t.status},r])}))}catch(t){console.error("fetch error (1)",t);const s=new String(t).toString();o.wasm_callback(e,[!1,{type:g.U32,value:0},s])}},this.getWasm=e}}class B{constructor(){this.events=new Set}on(e){let t=!0;const s=s=>{t&&e(s)};return this.events.add(s),()=>{t=!1,this.events.delete(s)}}trigger(e){const t=Array.from(this.events.values());for(const s of t)try{s(e)}catch(e){console.error(e)}}get size(){return this.events.size}}class L{constructor(){this.promiseResolveReject=null,this.resolve=e=>{const t=this.promiseResolveReject;this.promiseResolveReject=null,null!==t&&t.resolve(e)},this.reject=e=>{const t=this.promiseResolveReject;this.promiseResolveReject=null,null!==t&&t.reject(e)},this.isFulfilled=()=>null===this.promiseResolveReject;const[e,t]=(()=>{let e=null,t=null;const s=new Promise(((s,r)=>{e=s,t=r}));if(null===e)throw Error("createPromiseValue - resolve is null");if(null===t)throw Error("createPromiseValue - reject is null");return[{resolve:e,reject:t},s]})();this.promiseResolveReject=e,this.promise=t}}const T=async(e,t)=>{console.info(`${e} wait ${t}ms`),await(async e=>new Promise((t=>{setTimeout(t,e)})))(t),console.info(`${e} go forth`)};class W{constructor(e){this.host=e,this.formatLog=e=>`Socket ${this.host} ==> ${e}`}}class N{constructor(e,t){this.eventMessage=new B,this.close=e,this.send=t}static connect(e,t,s){const r=new L,n=new L,o=new WebSocket(t);let i=!1;console.info(e.formatLog("starting ..."));const a=()=>{i||(console.info(e.formatLog("close")),i=!0,r.resolve(null),n.resolve(),o.close())},c=new N(a,(e=>{i||o.send(e)}));setTimeout((()=>{!1===r.isFulfilled()&&(console.error(e.formatLog(`timeout (${s}ms)`)),a())}),s);return o.addEventListener("open",(()=>{console.info(e.formatLog("open")),r.resolve(c)})),o.addEventListener("error",(t=>{console.error(e.formatLog("error"),t),a()})),o.addEventListener("close",a),o.addEventListener("message",(t=>{if(i)return;const s=t.data;"string"!=typeof s?console.error(e.formatLog("onMessage - expected string"),s):c.eventMessage.trigger(s)})),{socket:r.promise,done:n.promise}}static startSocket(e,t,s,r){let n=!0,o=null;const i=new W(e);return(async()=>{for(;n;){const a=N.connect(i,e,t),c=await a.socket;if(null!==c){if(o=c,r({type:"socket",socket:c}),c.eventMessage.on((e=>{r({type:"message",message:e})})),await a.done,r({type:"close"}),!n)return void console.info(i.formatLog("disconnect (1)"));await T(i.formatLog("reconnect after close"),s)}else await T(i.formatLog("reconnect after error"),s)}console.info(i.formatLog("disconnect (2)"))})().catch((e=>{console.error(e)})),{send:e=>{null===o?console.error("send fail - missing connection",e):o.send(e)},dispose:()=>{n=!1,o?.close()}}}}class ${constructor(e){this.websocket_register_callback=(e,t)=>{const s=this.getWasm();let r=N.startSocket(e,5e3,3e3,(e=>{if(!1!==this.controllerList.has(t)){if("socket"===e.type)return this.socket.set(t,e.socket),void s.wasm_callback(t,!0);if("message"!==e.type)return"close"===e.type?(this.socket.delete(t),void s.wasm_callback(t,!1)):(e=>{throw console.error(e),Error("unknown message")})(e);s.wasm_callback(t,e.message)}}));this.controllerList.set(t,r)},this.websocket_unregister_callback=e=>{const t=this.controllerList.get(e);void 0!==t?(t.dispose(),this.controllerList.delete(e)):console.error("Expected controller")},this.websocket_send_message=(e,t)=>{const s=this.socket.get(e);void 0===s?console.error(`Missing socket connection for callback_id=${e}`):s.send(t)},this.getWasm=e,this.controllerList=new Map,this.socket=new Map}}class j{constructor(){this.data=new Map,this.initNodes=[...this.get_root_head().childNodes,...this.get_root_body().childNodes],this.style=document.createElement("style"),this.get_root_head().appendChild(this.style)}get_root_html(){return document.documentElement}get_root_head(){return document.head}get_root_body(){return document.body}set(e,t){1===e||2===e||3===e||this.data.set(e,t)}get_any_option(e){return 1===e?this.get_root_html():2===e?this.get_root_head():3===e?this.get_root_body():this.data.get(e)}get_any(e,t){const s=this.get_any_option(t);if(void 0===s)throw Error(`${e} -> item not found=${t}`);return s}get(e,t){const s=this.get_any_option(t);if(void 0===s)throw new Error(`${e}->get: Item id not found = ${t}`);return s}get_node_element(e,t){const s=this.get(e,t);if(s instanceof HTMLElement)return s;throw Error(`Expected id=${t} as HTMLElement`)}get_node(e,t){const s=this.get(e,t);if(s instanceof Element)return s;throw Error(`Expected id=${t} as Element`)}get_text(e,t){const s=this.get(e,t);if(s instanceof Text)return s;throw Error(`Expected id=${t} as Text`)}get_comment(e,t){const s=this.get(e,t);if(s instanceof Comment)return s;throw Error(`Expected id=${t} as Comment`)}delete(e,t){const s=this.get_any_option(t);if(this.data.delete(t),void 0===s)throw new Error(`${e}->delete: Item id not found = ${t}`);return s}insert_css(e,t){const s=document.createTextNode(`\n${e} { ${t} }`);this.style.appendChild(s)}removeInitNodes(){const e=this.initNodes;if(this.initNodes=null,null!==e)for(const t of e)t.remove()}insert_before(e,t,s){const r=this.get("insert_before",e),n=this.get_any("insert_before child",t);if(null==s)r.insertBefore(n,null);else{const e=this.get_any("insert_before ref",s);r.insertBefore(n,e)}r===this.get_root_head()&&this.get_root_head().appendChild(this.style)}}class M{constructor(e,t){this.dom_bulk_update=e=>{const t=new Set;for(const s of e){try{this.bulk_update_command(s)}catch(e){console.error("bulk_update - item",e,s)}"set_attr"===s.type&&"autofocus"===s.name.toLocaleLowerCase()&&t.add(s.id)}t.size>0&&setTimeout((()=>{for(const e of t){this.nodes.get_node_element(`set focus ${e}`,e).focus()}}),0),this.nodes.removeInitNodes()},this.historyLocation=e,this.getWasm=t,this.nodes=new j,this.callbacks=new Map,document.addEventListener("dragover",(e=>{e.preventDefault()}))}debugNodes(...e){const t={};for(const s of e){const e=this.nodes.get_any_option(s);t[s]=e}console.info("debug nodes",t)}create_node(e,t){const s=(e=>"path"==e||"svg"==e?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e))(t);this.nodes.set(e,s),"a"===t.toLowerCase().trim()&&s.addEventListener("click",(e=>{let t=s.getAttribute("href");null!==t&&(t.startsWith("#")||t.startsWith("http://")||t.startsWith("https://")||t.startsWith("//")||(e.preventDefault(),this.historyLocation.push(t),window.scrollTo(0,0)))}))}set_attribute(e,t,s){const r=this.nodes.get_node("set_attribute",e);if(r.setAttribute(t,s),"value"==t){if(r instanceof HTMLInputElement)return void(r.value=s);if(r instanceof HTMLTextAreaElement)return r.value=s,void(r.defaultValue=s)}}remove_attribute(e,t){const s=this.nodes.get_node("remove_attribute",e);if(s.removeAttribute(t),"value"==t){if(s instanceof HTMLInputElement)return void(s.value="");if(s instanceof HTMLTextAreaElement)return s.value="",void(s.defaultValue="")}}remove_node(e){this.nodes.delete("remove_node",e).remove()}create_text(e,t){const s=document.createTextNode(t);this.nodes.set(e,s)}remove_text(e){this.nodes.delete("remove_node",e).remove()}update_text(e,t){this.nodes.get_text("set_attribute",e).textContent=t}callback_click(e,t){e.preventDefault(),this.getWasm().wasm_callback(t,void 0)}callback_submit(e,t){e.preventDefault(),this.getWasm().wasm_callback(t,void 0)}callback_input(e,t){const s=e.target;s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement?this.getWasm().wasm_callback(t,s.value):console.warn("event input ignore",s)}callback_change(e,t){const s=e.target;s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement||s instanceof HTMLSelectElement?this.getWasm().wasm_callback(t,s.value):console.warn("event input ignore",s)}callback_blur(e,t){this.getWasm().wasm_callback(t,void 0)}callback_mousedown(e,t){this.getWasm().wasm_callback(t,void 0)&&e.preventDefault()}callback_mouseup(e,t){this.getWasm().wasm_callback(t,void 0)&&e.preventDefault()}callback_mouseenter(e,t){this.getWasm().wasm_callback(t,void 0)}callback_mouseleave(e,t){this.getWasm().wasm_callback(t,void 0)}callback_drop(e,t){if(e.preventDefault(),e instanceof DragEvent)if(null===e.dataTransfer)console.error("dom -> drop -> dataTransfer null");else{const s=[];for(let t=0;t<e.dataTransfer.items.length;t++){const r=e.dataTransfer.items[t];if(void 0===r)console.error("dom -> drop -> item - undefined");else{const e=r.getAsFile();null===e?console.error(`dom -> drop -> index:${t} -> It's not a file`):s.push(e.arrayBuffer().then((t=>({name:e.name,data:new Uint8Array(t)}))))}}s.length?Promise.all(s).then((e=>{const s=[];for(const t of e)s.push([t.name,t.data]);this.getWasm().wasm_callback(t,[s])})).catch((e=>{console.error("callback_drop -> promise.all -> ",e)})):console.error("No files to send")}else console.warn("event drop ignore",e)}callback_keydown(e,t){if(e instanceof KeyboardEvent){!0===this.getWasm().wasm_callback(t,[e.key,e.code,e.altKey,e.ctrlKey,e.shiftKey,e.metaKey])&&(e.preventDefault(),e.stopPropagation())}else console.warn("keydown ignore",e)}callback_load(e,t){e.preventDefault(),this.getWasm().wasm_callback(t,void 0)}callback_add(e,t,s){const r=e=>"click"===t?this.callback_click(e,s):"submit"===t?this.callback_submit(e,s):"input"===t?this.callback_input(e,s):"change"===t?this.callback_change(e,s):"blur"===t?this.callback_blur(e,s):"mousedown"===t?this.callback_mousedown(e,s):"mouseup"===t?this.callback_mouseup(e,s):"mouseenter"===t?this.callback_mouseenter(e,s):"mouseleave"===t?this.callback_mouseleave(e,s):"keydown"===t||"hook_keydown"===t?this.callback_keydown(e,s):"drop"===t?this.callback_drop(e,s):"load"===t?this.callback_load(e,s):void console.error(`No support for the event ${t}`);if(this.callbacks.has(s))console.error(`There was already a callback added with the callback_id=${s}`);else if(this.callbacks.set(s,r),"hook_keydown"===t)document.addEventListener("keydown",r,!1);else{this.nodes.get("callback_add",e).addEventListener(t,r,!1)}}callback_remove(e,t,s){const r=this.callbacks.get(s);if(this.callbacks.delete(s),void 0!==r)if("hook_keydown"===t)document.removeEventListener("keydown",r);else{this.nodes.get("callback_remove",e).removeEventListener(t,r)}else console.error(`The callback is missing with the id=${s}`)}bulk_update_command(e){if("remove_node"!==e.type)if("insert_before"!==e.type)if("create_node"!==e.type)if("create_text"!==e.type)if("update_text"!==e.type)if("set_attr"!==e.type)if("remove_attr"!==e.type)if("remove_text"!==e.type)if("insert_css"!==e.type)if("create_comment"!==e.type)if("remove_comment"!==e.type)if("callback_add"!==e.type){if("callback_remove"!==e.type)return(e=>{throw console.error(e),Error("unknown command")})(e);this.callback_remove(e.id,e.event_name,BigInt(e.callback_id))}else this.callback_add(e.id,e.event_name,BigInt(e.callback_id));else{this.nodes.delete("remove_comment",e.id).remove()}else{const t=document.createComment(e.value);this.nodes.set(e.id,t)}else this.nodes.insert_css(e.selector,e.value);else this.remove_text(e.id);else this.remove_attribute(e.id,e.name);else this.set_attribute(e.id,e.name,e.value);else this.update_text(e.id,e.value);else this.create_text(e.id,e.value);else this.create_node(e.id,e.name);else this.nodes.insert_before(e.parent,e.child,null===e.ref_id?null:e.ref_id);else this.remove_node(e.id)}}class J{constructor(e){this.trigger=()=>{for(const e of Array.from(this.callback.values()))e()},this.add=e=>{this.callback.set(e,(()=>{this.getWasm().wasm_callback(e,this.get())}))},this.remove=e=>{this.callback.delete(e)},this.push=e=>{this.get()!==e&&(window.history.pushState(null,"",e),this.trigger())},this.replace=e=>{this.get()!==e&&(window.history.replaceState(null,"",e),this.trigger())},this.getWasm=e,this.callback=new Map,window.addEventListener("popstate",this.trigger)}get(){return window.location.pathname+window.location.search+window.location.hash}}class V{constructor(e){this.getRandom=(e,t)=>{const s=t-e+1;return e+Math.floor(Math.random()*s)},this.isBrowser=()=>!0,this.get_env=e=>document.documentElement.getAttribute(`data-env-${e}`),this.getTimezoneOffset=()=>(new Date).getTimezoneOffset(),this.cookie=new x,this.interval=new E(e),this.hashRouter=new A(e),this.historyLocation=new J(e),this.fetch=new I(e),this.websocket=new $(e),this.dom=new M(this.historyLocation,e)}}class R{constructor(e,t,s){this.api=e,this.nodes=t,this.wsk=s}getByProperty(e,t){try{const e=this.wsk[t];return new R(this.api,this.nodes,e)}catch(s){return console.error("A problem with get",{path:e,property:t,error:s}),null}}toValue(){return b(this.wsk)}next(e,t){if(Array.isArray(t)){const[s,...r]=t;return"api"===s?this.nextApi(e,r):"root"===s?this.nextRoot(e,r):"get"===s?this.nextGet(e,r):"set"===s?this.nextSet(e,r):"call"===s?this.nextCall(e,r):"get_props"===s?this.nextGetProps(e,r):(console.error("JsNode.next - wrong commandName",s),null)}return console.error("JsNode.next - array was expected",{path:e,command:t}),null}nextApi(e,t){return 0===t.length?new R(this.api,this.nodes,this.api):(console.error("nextApi: wrong parameter",{path:e,args:t}),null)}nextRoot(e,t){const[s,...r]=t;if(o.isString(s)&&0===r.length)return"window"===s?new R(this.api,this.nodes,window):"document"===s?new R(this.api,this.nodes,document):(console.error(`JsNode.nextRoot: Global name not found -> ${s}`,{path:e,args:t}),null);if(o.isNumber(s)&&0===r.length){const r=s.value,n=this.nodes.get_any_option(r);return void 0!==n?new R(this.api,this.nodes,n):(console.error(`JsNode.nextRoot: No node with id=${r}`,{path:e,args:t}),null)}return console.error("JsNode.nextRoot: wrong parameter",{path:e,args:t}),null}nextGet(e,t){const[s,...r]=t;return o.isString(s)&&0===r.length?this.getByProperty(e,s):(console.error("JsNode.nextGet - wrong parameters",{path:e,args:t}),null)}nextSet(e,t){const[s,r,...n]=t;if(o.isString(s)&&0===n.length)try{return this.wsk[s]=_(r),new R(this.api,this.nodes,void 0)}catch(t){return console.error("A problem with set",{path:e,property:s,error:t}),null}return console.error("JsNode.nextSet - wrong parameters",{path:e,args:t}),null}nextCall(e,t){const[s,...r]=t;if(o.isString(s))try{let e=r.map(_);const t=this.wsk[s](...e);return new R(this.api,this.nodes,t)}catch(t){return console.error("A problem with call",{path:e,property:s,error:t}),null}return console.error("JsNode.nextCall - wrong parameters",{path:e,args:t}),null}nextGetProps(e,t){const s={};for(const r of t){if(!o.isString(r))return console.error("JsNode.nextGetProps - wrong parameters",{path:e,args:t,property:r}),null;{const t=this.getByProperty(e,r);if(null===t)return null;s[r]=t.toValue()}}return new R(this.api,this.nodes,s)}}class O{constructor(e){this.wasm=e}vertigo_entry_function(e,t){this.wasm.exports.vertigo_entry_function(e,t)}static async create(e){let t=null;const s=()=>{if(null===t)throw Error("Wasm is no initialized");return t},r=new V(s);return window.$vertigoApi=r,t=await U(e,{mod:{panic_message:(e,t)=>{const r=new TextDecoder("utf-8"),n=s().getUint8Memory().subarray(e,e+t),o=r.decode(n);console.error("PANIC",o)},dom_access:(e,t)=>{let n=s().decodeArguments(e,t);if(Array.isArray(n)){const e=n;let t=new R(r,r.dom.nodes,null);for(const s of e){const r=t.next(e,s);if(null===r)return 0;t=r}return s().valueSaveToBuffer(t.toValue())}return console.error("dom_access - wrong parameters",n),0}}}),new O(t)}}const F=new Set,C=async()=>{document.querySelectorAll("*[data-vertigo-run-wasm]").forEach((e=>{const t=e.getAttribute("data-vertigo-run-wasm");"string"==typeof t?(async e=>{if(F.has(e))return;if(F.size>0)return void console.error("Only one wasm module can be run",{moduleRun:F,wasm:e});F.add(e),console.info(`Wasm module: "${e}" -> start`);const t=await O.create(e);console.info(`Wasm module: "${e}" -> initialized`),t.vertigo_entry_function(0,7),console.info(`Wasm module: "${e}" -> launched vertigo_entry_function with version 0.7`)})(t):console.error("Run error",e)}))};window.addEventListener("load",C),setTimeout(C,3e3);
//# sourceMappingURL=wasm_run.js.map
