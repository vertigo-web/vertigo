{"version":3,"file":"wasm_run.js","sources":["src_js/jsvalue_types.ts","src_js/guard.ts","src_js/assert_never.ts","src_js/buffer_cursor.ts","src_js/jsjson.ts","src_js/jsvalue.ts","src_js/wasm_init.ts","src_js/api_browser/dom/map_nodes.ts","src_js/api_browser/dom/dom.ts","src_js/api_browser.ts","src_js/js_node.ts","src_js/exec_command/websocket/event_emiter.ts","src_js/exec_command/websocket/promise.ts","src_js/exec_command/websocket/connection.ts","src_js/exec_command/websocket/websocket.ts","src_js/exec_command/command/fetchCacheGet.ts","src_js/exec_command/command/fetchExec.ts","src_js/exec_command/command/interval.ts","src_js/exec_command/command/cookies.ts","src_js/exec_command/command/getRandom.ts","src_js/exec_command/exec_command.ts","src_js/exec_command/location/hashrouter.ts","src_js/exec_command/location/historyLocation.ts","src_js/exec_command/location/AppLocation.ts","src_js/wasm_module.ts","src_js/index.ts"],"sourcesContent":["import { JsJsonType } from \"./jsjson\";\n\nexport const JsValueConst = {\n    U32: 1,\n    I32: 2,\n    U64: 3,\n    I64: 4,\n    F64: 5,\n\n    True: 6,\n    False: 7,\n    Null: 8,\n    Undefined: 9,\n\n    Vec: 10,\n    String: 11,\n    List: 12,\n    Object: 13,\n    Json: 14,\n} as const;\n\nexport type JsValueType\n    = { type: typeof JsValueConst.U32, value: number, }\n    | { type: typeof JsValueConst.I32, value: number, }\n    | { type: typeof JsValueConst.U64, value: bigint, }\n    | { type: typeof JsValueConst.I64, value: bigint, }\n    | { type: typeof JsValueConst.F64, value: number, }\n    | boolean\n    | null\n    | undefined\n    | string\n    | Array<JsValueType>\n    | Uint8Array\n    | { type: typeof JsValueConst.Object, value: JsValueMapType }\n    | { type: typeof JsValueConst.Json, value: JsJsonType };\n\nexport interface JsValueMapType {\n    [key: string]: JsValueType\n}\n","import { JsJsonType } from \"./jsjson\";\nimport { JsValueType, JsValueConst, JsValueMapType } from \"./jsvalue_types\";\n\nexport namespace GuardJsValue {\n    export const isString = (value: JsValueType): value is string => {\n        return typeof value === 'string';\n    }\n\n    export const isStringOrNull = (value: JsValueType): value is string | null => {\n        return value === null || typeof value === 'string';\n    }\n\n    export const isNumber = (value: JsValueType): value is { type: typeof JsValueConst.U32, value: number } | { type: typeof JsValueConst.I32, value: number } => {\n        if (typeof value === 'object' && value !== null && 'type' in value) {\n            return value.type === JsValueConst.I32 || value.type === JsValueConst.U32\n        }\n\n        return false;\n    }\n\n    export const isBigInt = (value: JsValueType): value is { type: typeof JsValueConst.U64, value: bigint } | { type: typeof JsValueConst.I64, value: bigint } => {\n        if (typeof value === 'object' && value !== null && 'type' in value) {\n            return value.type === JsValueConst.I64 || value.type === JsValueConst.U64\n        }\n\n        return false;\n    }\n\n    export const isJsObject = (value: JsValueType): value is { type: typeof JsValueConst.Object, value: JsValueMapType } => {\n        return (\n            value !== null &&\n            typeof value === 'object' &&\n            'type' in value &&\n            value.type === JsValueConst.Object\n        );\n    }\n\n    export const isJson = (value: JsValueType): value is { type: typeof JsValueConst.Json, value: JsJsonType } => {\n        return (\n            value !== null &&\n            typeof value === 'object' &&\n            'type' in value &&\n            value.type === JsValueConst.Json\n        );\n    }\n}\n","\nexport const assertNever = (_value: never) => {\n    throw Error(\"assert never\");\n}\n","///https://javascript.info/arraybuffer-binary-arrays#dataview\n\nconst decoder = new TextDecoder(\"utf-8\");\nconst encoder = new TextEncoder();\n\nexport class BufferCursor {\n    private dataView: DataView;\n    private pointer: number = 0;\n    private ptr: number;\n    private size: number;\n\n    constructor(\n        private getUint8Memory: () => Uint8Array,\n        long_ptr: bigint,\n    ) {\n        this.ptr = Number(long_ptr >> 32n);\n        this.size = Number(long_ptr % (2n ** 32n));\n\n        this.dataView = new DataView(\n            this.getUint8Memory().buffer,\n            this.ptr,\n            this.size\n        );\n    }\n\n    public getByte(): number {\n        const value = this.dataView.getUint8(this.pointer);\n        this.pointer += 1;\n        return value;\n    }\n\n    public setByte(byte: number) {\n        this.dataView.setUint8(this.pointer, byte);\n        this.pointer += 1;\n    }\n\n    public getU16(): number {\n        const value = this.dataView.getUint16(this.pointer);\n        this.pointer += 2;\n        return value;\n    }\n\n    public setU16(value: number) {\n        this.dataView.setUint16(this.pointer, value);\n        this.pointer += 2;\n    }\n\n    public getU32(): number {\n        const value = this.dataView.getUint32(this.pointer);\n        this.pointer += 4;\n        return value;\n    }\n\n    public setU32(value: number) {\n        this.dataView.setUint32(this.pointer, value);\n        this.pointer += 4;\n    }\n\n    public getI32(): number {\n        const value = this.dataView.getInt32(this.pointer);\n        this.pointer += 4;\n        return value;\n    }\n\n    public setI32(value: number) {\n        this.dataView.setInt32(this.pointer, value);\n        this.pointer += 4;\n    }\n\n    public getU64(): bigint {\n        const value = this.dataView.getBigUint64(this.pointer);\n        this.pointer += 8;\n        return value;\n    }\n\n    public setU64(value: bigint) {\n        this.dataView.setBigUint64(this.pointer, value);\n        this.pointer += 8;\n    }\n\n    public getI64(): bigint {\n        const value = this.dataView.getBigInt64(this.pointer);\n        this.pointer += 8;\n        return value;\n    }\n\n    public setI64(value: bigint) {\n        this.dataView.setBigInt64(this.pointer, value);\n        this.pointer += 8;\n    }\n\n    public getF64(): number {\n        const value = this.dataView.getFloat64(this.pointer);\n        this.pointer += 8;\n        return value;\n    }\n\n    public setF64(value: number) {\n        this.dataView.setFloat64(this.pointer, value);\n        this.pointer += 8;\n    }\n\n    public getBuffer(): Uint8Array {\n        const size = this.getU32();\n        const result = this\n            .getUint8Memory()\n            .subarray(\n                this.ptr + this.pointer,\n                this.ptr + this.pointer + size\n            );\n\n        this.pointer += size;\n        return result;\n    }\n\n    public setBuffer(buffer: Uint8Array) {\n        const size = buffer.length;\n        this.setU32(size);\n\n        const sub_buffer = this\n            .getUint8Memory()\n            .subarray(\n                this.ptr + this.pointer,\n                this.ptr + this.pointer + size\n            );\n\n        sub_buffer.set(buffer);\n\n        this.pointer += size;\n    }\n\n    public getString(): string {\n        return decoder.decode(this.getBuffer());\n    }\n\n    public setString(value: string) {\n        const buffer = encoder.encode(value);\n        this.setBuffer(buffer);\n    }\n\n    public getSavedSize(): number {\n        return this.pointer;\n    }\n}\n\nexport const getStringSize = (value: string): number => {\n    return new TextEncoder().encode(value).length;\n};\n\n","import { BufferCursor, getStringSize } from \"./buffer_cursor\";\n\nconst JsJsonConst = {\n    True: 1,\n    False: 2,\n    Null: 3,\n\n    String: 4,\n    Number: 5,\n    List: 6,\n    Object: 7,\n} as const;\n\nexport type JsJsonType\n    = boolean\n    | null\n    | number\n    | string\n    | Array<JsJsonType>\n    | JsJsonMapType;\n\ninterface JsJsonMapType {\n    [key: string]: JsJsonType\n}\n\nexport const jsJsonGetSize = (value: JsJsonType): number => {\n\n    if (typeof value === 'boolean') {\n        return 1;\n    }\n\n    if (value === null) {\n        return 1;\n    }\n\n    if (typeof value === 'string') {\n        return 1 + 4 + getStringSize(value);\n    }\n\n    if (Array.isArray(value)) {\n        let sum = 1 + 4;\n\n        for (const item of value) {\n            sum += jsJsonGetSize(item);\n        }\n\n        return sum;\n    }\n\n    if (typeof value === 'number') {\n        return 9;   //1 + 8\n    }\n\n    //object\n    let sum = 1 + 2;\n\n    for (const [key, propertyValue] of Object.entries(value)) {\n        sum += 4 + getStringSize(key);\n        sum += jsJsonGetSize(propertyValue);\n    }\n\n    return sum;\n};\n\nexport const jsJsonDecodeItem = (cursor: BufferCursor): JsJsonType => {\n    const typeParam = cursor.getByte();\n\n    if (typeParam === JsJsonConst.True) {\n        return true;\n    }\n\n    if (typeParam === JsJsonConst.False) {\n        return false;\n    }\n\n    if (typeParam === JsJsonConst.Null) {\n        return null;\n    }\n\n    if (typeParam === JsJsonConst.String) {\n        return cursor.getString();\n    }\n\n    if (typeParam === JsJsonConst.Number) {\n        return cursor.getF64();\n    }\n\n    if (typeParam === JsJsonConst.List) {\n        const out: Array<JsJsonType> = [];\n\n        const listSize = cursor.getU32();\n\n        for (let i=0; i<listSize; i++) {\n            out.push(jsJsonDecodeItem(cursor))\n        }\n\n        return out;\n    }\n\n    //object\n    const out: Record<string, JsJsonType> = {};\n\n    const listSize = cursor.getU16();\n\n    for (let i=0; i<listSize; i++) {\n        const key = cursor.getString();\n        const value = jsJsonDecodeItem(cursor);\n        out[key] = value;\n    }\n\n    return out;\n}\n\nexport const saveJsJsonToBufferItem = (value: JsJsonType, cursor: BufferCursor) => {\n    if (value === true) {\n        cursor.setByte(JsJsonConst.True);\n        return;\n    }\n\n    if (value === false) {\n        cursor.setByte(JsJsonConst.False);\n        return;\n    }\n\n    if (value === null) {\n        cursor.setByte(JsJsonConst.Null);\n        return;\n    }\n\n    if (typeof value === 'string') {\n        cursor.setByte(JsJsonConst.String);\n        cursor.setString(value);\n        return;\n    }\n\n    if (typeof value === 'number') {\n        cursor.setByte(JsJsonConst.Number);\n        cursor.setF64(value);\n        return;\n    }\n\n    if (Array.isArray(value)) {\n        cursor.setByte(JsJsonConst.List);\n        cursor.setU32(value.length);\n\n        for (const item of value) {\n            saveJsJsonToBufferItem(item, cursor);\n        }\n\n        return;\n    }\n\n    //object\n    const list: Array<[string, JsJsonType]> = [];\n\n    for (const [key, propertyValue] of Object.entries(value)) {\n        list.push([key, propertyValue]);\n    }\n\n    cursor.setByte(JsJsonConst.Object);\n    cursor.setU16(list.length);\n\n    for (const [key, propertyValue] of list) {\n        cursor.setString(key);\n        saveJsJsonToBufferItem(propertyValue, cursor);\n    }\n};\n","import { assertNever } from \"./assert_never\";\nimport { BufferCursor, getStringSize } from \"./buffer_cursor\";\nimport { GuardJsValue } from \"./guard\";\nimport { jsJsonDecodeItem, jsJsonGetSize, JsJsonType, saveJsJsonToBufferItem } from \"./jsjson\";\nimport { JsValueType, JsValueConst } from \"./jsvalue_types\";\n\n//https://github.com/unsplash/unsplash-js/pull/174\n// export type AnyJson = boolean | number | string | null | JsonArray | JsonMap;\n// export interface JsonMap { [key: string]: AnyJson }\n// export interface JsonArray extends Array<AnyJson> {}\n\n\nconst jsValueDecodeItem = (cursor: BufferCursor): JsValueType => {\n    const typeParam = cursor.getByte();\n\n    if (typeParam === JsValueConst.U32) {\n        return {\n            type: JsValueConst.U32,\n            value: cursor.getU32()\n        };\n    }\n\n    if (typeParam === JsValueConst.I32) {\n        return {\n            type: JsValueConst.I32,\n            value: cursor.getI32()\n        };\n    }\n\n    if (typeParam === JsValueConst.U64) {\n        return {\n            type: JsValueConst.U64,\n            value: cursor.getU64()\n        };\n    }\n\n    if (typeParam === JsValueConst.I64) {\n        return {\n            type: JsValueConst.I64,\n            value: cursor.getI64()\n        };\n    }\n\n    if (typeParam === JsValueConst.F64) {\n        return {\n            type: JsValueConst.F64,\n            value: cursor.getF64()\n        };\n    }\n\n    if (typeParam === JsValueConst.True) {\n        return true;\n    }\n\n    if (typeParam === JsValueConst.False) {\n        return false;\n    }\n\n    if (typeParam === JsValueConst.Null) {\n        return null;\n    }\n\n    if (typeParam === JsValueConst.Undefined) {\n        return undefined;\n    }\n\n    if (typeParam === JsValueConst.Vec) {\n        return cursor.getBuffer();\n    }\n\n    if (typeParam === JsValueConst.String) {\n        return cursor.getString();\n    }\n\n    if (typeParam === JsValueConst.List) {\n        const out: Array<JsValueType> = [];\n\n        const listSize = cursor.getU32();\n\n        for (let i=0; i<listSize; i++) {\n            out.push(jsValueDecodeItem(cursor))\n        }\n\n        return out;\n    }\n\n    if (typeParam === JsValueConst.Object) {\n        const out: Record<string, JsValueType> = {};\n\n        const listSize = cursor.getU16();\n\n        for (let i=0; i<listSize; i++) {\n            const key = cursor.getString();\n            const value = jsValueDecodeItem(cursor);\n            out[key] = value;\n        }\n\n        return {\n            type: JsValueConst.Object,\n            value: out\n        };\n    }\n\n    if (typeParam === JsValueConst.Json) {\n        const json = jsJsonDecodeItem(cursor);\n\n        return {\n            type: JsValueConst.Json,\n            value: json\n        };\n    }\n\n    console.error('typeParam', typeParam);\n    throw Error('Invalid branch');\n};\n\nexport const jsValueDecode = (getUint8Memory: () => Uint8Array, long_ptr: bigint): JsValueType => {\n    try {\n        const cursor = new BufferCursor(getUint8Memory, long_ptr);\n        return jsValueDecodeItem(cursor);\n    } catch (err) {\n        console.error(err);\n        return [];\n    }\n};\n\nconst getSize = (value: JsValueType): number => {\n    if (\n        value === true ||\n        value === false ||\n        value === null ||\n        value === undefined\n    ) {\n        return 1;\n    }\n\n    if (GuardJsValue.isString(value)) {\n        return 1 + 4 + getStringSize(value);\n    }\n\n    if (Array.isArray(value)) {\n        let sum = 1 + 4;\n\n        for (const item of value) {\n            sum += getSize(item);\n        }\n\n        return sum;\n    }\n\n    if (value instanceof Uint8Array) {\n        return 1 + 4 + value.length;\n    }\n\n    if (value.type === JsValueConst.I32 || value.type === JsValueConst.U32) {\n        return 5;   // 1 + 4\n    }\n\n    if (value.type === JsValueConst.I64 || value.type === JsValueConst.U64 || value.type == JsValueConst.F64) {\n        return 9;   // 1 + 8\n    }\n\n    if (value.type === JsValueConst.Object) {\n        let sum = 1 + 2;\n\n        for (const [key, propertyValue] of Object.entries(value.value)) {\n            sum += 4 + getStringSize(key);\n            sum += getSize(propertyValue);\n        }\n\n        return sum;\n    }\n\n    if (value.type === JsValueConst.Json) {\n        return 1 + jsJsonGetSize(value.value);\n    }\n\n    return assertNever(value);\n};\n\nconst saveToBufferItem = (value: JsValueType, cursor: BufferCursor) => {\n    if (value === true) {\n        cursor.setByte(JsValueConst.True);\n        return;\n    }\n\n    if (value === false) {\n        cursor.setByte(JsValueConst.False);\n        return;\n    }\n\n    if (value === null) {\n        cursor.setByte(JsValueConst.Null);\n        return;\n    }\n\n    if (value === undefined) {\n        cursor.setByte(JsValueConst.Undefined);\n        return;\n    }\n\n    if (value instanceof Uint8Array) {\n        cursor.setByte(JsValueConst.Vec);\n        cursor.setBuffer(value);\n        return;\n    }\n\n    if (GuardJsValue.isString(value)) {\n        cursor.setByte(JsValueConst.String);\n        cursor.setString(value);\n        return;\n    }\n\n    if (Array.isArray(value)) {\n        cursor.setByte(JsValueConst.List);\n        cursor.setU32(value.length);\n\n        for (const item of value) {\n            saveToBufferItem(item, cursor);\n        }\n\n        return;\n    }\n\n    if (value.type === JsValueConst.U32) {\n        cursor.setByte(JsValueConst.U32);\n        cursor.setU32(value.value);\n        return;\n    }\n\n    if (value.type === JsValueConst.I32) {\n        cursor.setByte(JsValueConst.I32);\n        cursor.setI32(value.value);\n        return;\n    }\n\n    if (value.type === JsValueConst.U64) {\n        cursor.setByte(JsValueConst.U64);\n        cursor.setU64(value.value);\n        return;\n    }\n\n    if (value.type === JsValueConst.I64) {\n        cursor.setByte(JsValueConst.I64);\n        cursor.setI64(value.value);\n        return;\n    }\n\n    if (value.type === JsValueConst.F64) {\n        cursor.setByte(JsValueConst.F64);\n        cursor.setF64(value.value);\n        return;\n    }\n\n    if (value.type === JsValueConst.Object) {\n        const list: Array<[string, JsValueType]> = [];\n\n        for (const [key, propertyValue] of Object.entries(value.value)) {\n            list.push([key, propertyValue]);\n        }\n\n        cursor.setByte(JsValueConst.Object);\n        cursor.setU16(list.length);\n\n        for (const [key, propertyValue] of list) {\n            cursor.setString(key);\n            saveToBufferItem(propertyValue, cursor);\n        }\n        return;\n    }\n\n    if (value.type === JsValueConst.Json) {\n        cursor.setByte(JsValueConst.Json);\n        saveJsJsonToBufferItem(value.value, cursor);\n        return;\n    }\n\n    return assertNever(value);\n};\n\n\nexport const saveToBufferLongPtr = (\n    getUint8Memory: () => Uint8Array,\n    alloc: (size: number) => bigint,\n    value: JsValueType,\n): bigint => {\n    if (value === undefined) {\n        return 0n;\n    }\n\n    const size = getSize(value);\n    const long_ptr = alloc(size);\n\n    const cursor = new BufferCursor(getUint8Memory, long_ptr);\n    saveToBufferItem(value, cursor);\n\n    if (size !== cursor.getSavedSize()) {\n        console.error({\n            size,\n            savedSize: cursor.getSavedSize(),\n        });\n\n        throw Error('Mismatch between calculated and recorded size');\n    }\n\n    return long_ptr;\n};\n\nexport const convertFromJsValue = (value: JsValueType): unknown => {\n    if (value === true) {\n        return true;\n    }\n\n    if (value === false) {\n        return false;\n    }\n\n    if (value === null) {\n        return null;\n    }\n\n    if (value === undefined) {\n        return undefined;\n    }\n\n    if (value instanceof Uint8Array) {\n        return value;\n    }\n\n    if (GuardJsValue.isString(value)) {\n        return value;\n    }\n\n    if (Array.isArray(value)) {\n        const newList = [];\n\n        for (const item of value) {\n            newList.push(convertFromJsValue(item));\n        }\n\n        return newList;\n    }\n\n    if (value.type === JsValueConst.U32 || value.type === JsValueConst.I32) {\n        return value.value;\n    }\n\n    if (value.type === JsValueConst.U64 || value.type === JsValueConst.I64 || value.type === JsValueConst.F64) {\n        return value.value;\n    }\n\n    if (value.type === JsValueConst.Object) {\n        const result: Record<string, unknown> = {};\n\n        for (const [key, propertyValue] of Object.entries(value.value)) {\n            result[key] = convertFromJsValue(propertyValue);\n        }\n\n        return result;\n    }\n\n    if (value.type === JsValueConst.Json) {\n        return value.value;\n    }\n\n    return assertNever(value);\n};\n\n//throws an exception when it fails to convert to JsValue\nexport const convertToJsValue = (value: unknown): JsValueType => {\n    if (typeof value === 'string') {\n        return value;\n    }\n\n    if (value === true || value === false || value === undefined || value === null) {\n        return value;\n    }\n\n    if (typeof value === 'number') {\n        if (value === (value | 0)) {\n            // is integer\n            if (-(2 ** 31) <= value && value < 2 ** 31) {\n                return {\n                    type: JsValueConst.I32,\n                    value\n                };\n            }\n\n            return {\n                type: JsValueConst.I64,\n                value: BigInt(value)\n            };\n        } else {\n            // is float\n            return {\n                type: JsValueConst.F64,\n                value: value,\n            }\n        }\n    }\n\n    if (typeof value === 'bigint') {\n        return {\n            type: JsValueConst.I64,\n            value\n        };\n    }\n\n    if (value instanceof Uint8Array) {\n        return value;\n    }\n\n    if (typeof value === 'object') {\n        try {\n            const json = convertToJsJson(value);\n            return {\n                type: JsValueConst.Json,\n                value: json\n            };\n        } catch (_error) {\n        }\n\n        const result: Record<string, JsValueType> = {};\n\n        for (const [propName, propValue] of Object.entries(value)) {\n            result[propName] = convertToJsValue(propValue);\n        }\n\n        return {\n            type: JsValueConst.Object,\n            value: result\n        };\n    }\n\n    if (Array.isArray(value)) {\n        try {\n            const list = value.map(convertToJsJson);\n            return {\n                type: JsValueConst.Json,\n                value: list\n            };\n        } catch (_error) {\n            return value.map(convertToJsValue);\n        }\n    }\n\n    console.warn('convertToJsValue', value);\n    throw Error('It is not possible to convert this data to JsValue');\n};\n\n//throws an exception when it fails to convert to JsJson\nexport const convertToJsJson = (value: unknown): JsJsonType => {\n    if (typeof value === 'boolean' || value === null || typeof value === 'number' || typeof value === 'string') {\n        return value;\n    }\n\n    if (Array.isArray(value)) {\n        return value.map(convertToJsJson);\n    }\n\n    if (typeof value === 'object') {\n        const result: Record<string, JsJsonType> = {};\n\n        for (const [propName, propValue] of Object.entries(value)) {\n            result[propName] = convertToJsJson(propValue);\n        }\n\n        return result;\n    }\n\n    console.warn('convertToJsJson', value);\n    throw Error('It is not possible to convert this data to JsJson');\n};\n","import { GuardJsValue } from './guard';\nimport { JsJsonType } from './jsjson';\nimport { jsValueDecode, saveToBufferLongPtr } from './jsvalue';\nimport { JsValueType } from './jsvalue_types';\n\nexport interface BaseExportType {\n    vertigo_export_alloc_block: (size: number) => bigint,\n    vertigo_export_free_block: (pointer: bigint) => void,\n    vertigo_export_wasm_callback: (callback_id: bigint, value_ptr: bigint) => bigint,   //result => pointer: 32bit, size: 32bit\n    vertigo_export_wasm_command: (value_ptr: bigint) => bigint,\n};\n\nexport interface ModuleControllerType<ExportType extends BaseExportType> {\n    exports: ExportType,\n    decodeArgumentsLong: (long_ptr: bigint) => JsValueType,\n    getUint8Memory: () => Uint8Array,\n    /**\n     * @deprecated - pleas use wasm_command\n     */\n    wasm_callback: (callback_id: bigint, params: JsValueType) => JsValueType,\n    wasm_command: (params: JsJsonType) => JsJsonType,\n    valueSaveToBufferLong: (value: JsValueType) => bigint,\n}\n\nconst fetchModule = async (wasmBinPath: string, imports: Record<string, WebAssembly.ModuleImports>): Promise<WebAssembly.WebAssemblyInstantiatedSource> => {\n    if (typeof WebAssembly.instantiateStreaming === 'function') {\n        const stream = fetch(wasmBinPath);\n        try {\n            const module = await WebAssembly.instantiateStreaming(stream, imports);\n            return module;\n        } catch (err) {\n            console.warn(\"`WebAssembly.instantiateStreaming` failed. This could happen if your server does not serve wasm with `application/wasm` MIME type, but check the original error too. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", err);\n        }\n    }\n\n    console.info('fetchModule by WebAssembly.instantiate');\n\n    const resp = await fetch(wasmBinPath);\n    const binary = await resp.arrayBuffer();\n    const module_instance = await WebAssembly.instantiate(binary, imports);\n    return module_instance;\n};\n\nexport const wasmInit = async <ImportType extends Record<string, Function>, ExportType extends BaseExportType>(\n    wasmBinPath: string,\n    imports: { mod: ImportType },\n): Promise<ModuleControllerType<ExportType>> => {\n    const module_instance = await fetchModule(wasmBinPath, imports);\n\n    let cacheGetUint8Memory: Uint8Array = new Uint8Array(1);\n\n    const getUint8Memory = () => {\n        if (module_instance.instance.exports.memory instanceof WebAssembly.Memory) {\n            if (cacheGetUint8Memory.buffer !== module_instance.instance.exports.memory.buffer) {\n                cacheGetUint8Memory = new Uint8Array(module_instance.instance.exports.memory.buffer);\n            }\n            return cacheGetUint8Memory;\n        } else {\n            throw Error('Missing memory');\n        }\n    };\n\n    //@ts-expect-error\n    const exports: ExportType = module_instance.instance.exports;\n\n    const decodeArgumentsLong = (long_ptr: bigint): JsValueType => {\n        if (long_ptr === 0n) {\n            return undefined;\n        }\n\n        const response = jsValueDecode(getUint8Memory, long_ptr);\n        exports.vertigo_export_free_block(long_ptr);\n\n        return response;\n    };\n\n    const valueSaveToBufferLong = (value: JsValueType): bigint => saveToBufferLongPtr(getUint8Memory, exports.vertigo_export_alloc_block, value);\n\n    const wasm_callback = (callback_id: bigint, value: JsValueType): JsValueType => {\n        const value_ptr = valueSaveToBufferLong(value);\n        let result_long_ptr = exports.vertigo_export_wasm_callback(callback_id, value_ptr);\n        return decodeArgumentsLong(result_long_ptr);\n    };\n\n    const wasm_command = (value: JsJsonType): JsJsonType => {\n        const value_ptr = valueSaveToBufferLong({\n            type: 14,\n            value\n        });\n        let result_long_ptr = exports.vertigo_export_wasm_command(value_ptr);\n        const result = decodeArgumentsLong(result_long_ptr);\n\n        if (GuardJsValue.isJson(result)) {\n            return result.value;\n        }\n\n        throw Error('Json expected');\n    };\n    \n\n    return {\n        exports,\n        decodeArgumentsLong,\n        getUint8Memory,\n        wasm_callback,\n        wasm_command,\n        valueSaveToBufferLong,\n    };\n};\n","type NodeType = Element | Comment | Text;\nexport class MapNodes {\n    private data: Map<number, NodeType>;\n    private initNodes: Array<ChildNode> | null;\n    private style: HTMLStyleElement;\n\n    constructor() {\n        this.data = new Map();\n\n        this.initNodes = [\n            ...this.get_root_head().childNodes,\n            ...this.get_root_body().childNodes,\n        ];\n\n        this.style = document.createElement('style');\n        this.get_root_head().appendChild(this.style);\n    }\n\n    private get_root_html(): Element {\n        return document.documentElement;\n    }\n\n    private get_root_head(): Element {\n        return document.head;\n    }\n\n    private get_root_body(): Element {\n        return document.body;\n    }\n\n    public set(id: number, value: NodeType) {\n        if (id === 1 || id === 2 || id === 3) {\n            //ignore\n        } else {\n            this.data.set(id, value);\n        }\n    }\n\n    public get_any_option(id: number): NodeType | undefined {\n        if (id === 1) {\n            return this.get_root_html();\n        }\n\n        if (id === 2) {\n            return this.get_root_head();\n        }\n\n        if (id === 3) {\n            return this.get_root_body();\n        }\n\n        return this.data.get(id);\n    }\n\n    public get_any(label: string, id: number): NodeType {\n        const item = this.get_any_option(id);\n\n        if (item === undefined) {\n            throw Error(`${label} -> item not found=${id}`);\n        }\n\n        return item;\n    }\n\n    public get(label: string, id: number): NodeType {\n        const item = this.get_any_option(id);\n\n        if (item === undefined) {\n            throw new Error(`${label}->get: Item id not found = ${id}`);\n        }\n        return item;\n    }\n\n    public get_node_element(label: string, id: number): HTMLElement {\n        const node = this.get(label, id);\n        if (node instanceof HTMLElement) {\n            return node;\n        } else {\n            throw Error(`Expected id=${id} as HTMLElement`);\n        }\n    }\n\n    public get_node(label: string, id: number): Element {\n        const node = this.get(label, id);\n        if (node instanceof Element) {\n            return node;\n        } else {\n            throw Error(`Expected id=${id} as Element`);\n        }\n    }\n\n    public get_text(label: string, id: number): Text {\n        const node = this.get(label, id);\n        if (node instanceof Text) {\n            return node;\n        } else {\n            throw Error(`Expected id=${id} as Text`);\n        }\n    }\n\n    public get_comment(label: string, id: number): Comment {\n        const node = this.get(label, id);\n        if (node instanceof Comment) {\n            return node;\n        } else {\n            throw Error(`Expected id=${id} as Comment`);\n        }\n    }\n\n    public delete(label: string, id: number): NodeType {\n        const item = this.get_any_option(id);\n        this.data.delete(id);\n\n        if (item === undefined) {\n            throw new Error(`${label}->delete: Item id not found = ${id}`);\n        }\n\n        return item;\n    }\n\n    public insert_css(selector: string | null, value: string) {\n        if (selector !== null) {\n            // Add autocss styles\n            const content = document.createTextNode(`\\n${selector} { ${value} }`);\n            this.style.appendChild(content);\n        } else {\n            // Add bundle (i.e. a tailwind bundle)\n            const content = document.createTextNode(`\\n${value}`);\n            this.style.appendChild(content);\n        }\n    }\n\n    public removeInitNodes() {\n        const initNodes = this.initNodes;\n        this.initNodes = null;\n\n        if (initNodes === null) {\n            return;\n        }\n\n        for (const node of initNodes) {\n            node.remove();\n        }\n    }\n\n    public insert_before(parent: number, child: number, ref_id: number | null | undefined) {\n        const parentNode = this.get(\"insert_before\", parent);\n        const childNode = this.get_any(\"insert_before child\", child);\n\n        if (ref_id === null || ref_id === undefined) {\n            parentNode.insertBefore(childNode, null);\n        } else {\n            const ref_node = this.get_any('insert_before ref', ref_id);\n            parentNode.insertBefore(childNode, ref_node);\n        }\n\n        if (parentNode === this.get_root_head()) {\n            //we make sure that the automatically generated styles are always the last element of the head\n            this.get_root_head().appendChild(this.style);\n        }\n    }\n}\n","import { ExportType } from \"../../wasm_module\";\nimport { GuardJsValue } from \"../../guard\";\nimport { MapNodes } from \"./map_nodes\";\nimport { ModuleControllerType } from \"../../wasm_init\";\nimport { AppLocation } from \"../../exec_command/location/AppLocation\";\n\ninterface FileItemType {\n    name: string,\n    data: Uint8Array,\n}\n\nconst createElement = (name: string): Element => {\n    if (name == \"path\" || name == \"svg\") {\n        return document.createElementNS(\"http://www.w3.org/2000/svg\", name);\n    } else {\n        return document.createElement(name);\n    }\n}\n\ntype CommandType = {\n    type: 'create_node',\n    id: number,\n    name: string,\n} | {\n    type: 'create_text',\n    id: number,\n    value: string\n} | {\n    type: 'update_text',\n    id: number,\n    value: string\n} | {\n    type: 'set_attr',\n    id: number,\n    name: string,\n    value: string\n} | {\n    type: 'remove_attr',\n    id: number,\n    name: string\n} | {\n    type: 'remove_node',\n    id: number,\n} | {\n    type: 'remove_text',\n    id: number,\n} | {\n    type: 'insert_before',\n    parent: number,\n    child: number,\n    ref_id: number | null,\n} | {\n    type: 'insert_css',\n    selector: string | null,\n    value: string\n} | {\n    type: 'create_comment',\n    id: number,\n    value: string\n} | {\n    type: 'remove_comment',\n    id: number,\n} | {\n    type: 'callback_add',\n    id: number,\n    event_name: string,\n    callback_id: number,\n} | {\n    type: 'callback_remove',\n    id: number,\n    event_name: string,\n    callback_id: number,\n};\n\nconst assertNeverCommand = (data: never): never => {\n    console.error(data);\n    throw Error('unknown command');\n};\n\nexport class DriverDom {\n    private appLocation: AppLocation;\n    private readonly getWasm: () => ModuleControllerType<ExportType>;\n    public readonly nodes: MapNodes;\n    private callbacks: Map<bigint, (data: Event) => void>;\n\n    public constructor(appLocation: AppLocation, getWasm: () => ModuleControllerType<ExportType>) {\n        this.appLocation = appLocation;\n        this.getWasm = getWasm;\n        this.nodes = new MapNodes();\n        this.callbacks = new Map();\n\n        document.addEventListener('dragover', (ev): void => {\n            // console.log('File(s) in drop zone');\n            ev.preventDefault();\n        });\n    }\n\n    public debugNodes(...ids: Array<number>) {\n        const result: Record<number, unknown> = {};\n        for (const id of ids) {\n            const value = this.nodes.get_any_option(id);\n            result[id] = value;\n        }\n        console.info('debug nodes', result);\n    }\n\n    private create_node(id: number, name: string) {\n        const node = createElement(name);\n        this.nodes.set(id, node);\n\n        if (name.toLowerCase().trim() === 'a') {\n            node.addEventListener('click', (e) => {\n                let href = node.getAttribute('href');\n                if (href === null) {\n                    return;\n                }\n\n                if (href.startsWith('#') || href.startsWith('http://') || href.startsWith('https://') || href.startsWith('//')) {\n                    return;\n                }\n\n                e.preventDefault();\n                this.appLocation.set('History', 'Push', href);\n                window.scrollTo(0, 0);\n            })\n        }\n    }\n\n    private set_attribute(id: number, name: string, value: string) {\n        const node = this.nodes.get_node(\"set_attribute\", id);\n        node.setAttribute(name, value);\n\n        if (name == \"value\") {\n            if (node instanceof HTMLInputElement) {\n                node.value = value;\n                return;\n            }\n\n            if (node instanceof HTMLTextAreaElement) {\n                node.value = value;\n                node.defaultValue = value;\n                return;\n            }\n        }\n    }\n\n    private remove_attribute(id: number, name: string) {\n        const node = this.nodes.get_node(\"remove_attribute\", id);\n        node.removeAttribute(name);\n\n        if (name == \"value\") {\n            if (node instanceof HTMLInputElement) {\n                node.value = \"\";\n                return;\n            }\n\n            if (node instanceof HTMLTextAreaElement) {\n                node.value = \"\";\n                node.defaultValue = \"\";\n                return;\n            }\n        }\n    }\n\n    private remove_node(id: number) {\n        const node = this.nodes.delete(\"remove_node\", id);\n        node.remove();\n    }\n\n    private create_text(id: number, value: string) {\n        const text = document.createTextNode(value);\n        this.nodes.set(id, text);\n    }\n\n    private remove_text(id: number) {\n        const text = this.nodes.delete(\"remove_node\", id);\n        text.remove();\n    }\n\n    private update_text(id: number, value: string) {\n        const text = this.nodes.get_text(\"set_attribute\", id);\n        text.textContent = value;\n    }\n\n    private callback_click(event: Event, callback_id: bigint) {\n        event.preventDefault();\n        let click_event = this.getWasm().wasm_callback(callback_id, undefined);\n\n        if (GuardJsValue.isJsObject(click_event)) {\n            let value = click_event.value;\n            if (value !== null) {\n                if (value['stop_propagation'] === true) {\n                    event.stopPropagation();\n                }\n                if (value['prevent_default'] === true) {\n                    event.preventDefault();\n                }\n            }\n        }\n    }\n\n    private callback_submit(event: Event, callback_id: bigint) {\n        event.preventDefault();\n        this.getWasm().wasm_callback(callback_id, undefined);\n    }\n\n    private callback_input(event: Event, callback_id: bigint) {\n        const target = event.target;\n\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement) {\n            this.getWasm().wasm_callback(callback_id, target.value);\n            return;\n        }\n\n        console.warn('event input ignore', target);\n    }\n\n    private callback_change(event: Event, callback_id: bigint) {\n        const target = event.target;\n\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement || target instanceof HTMLSelectElement) {\n            this.getWasm().wasm_callback(callback_id, target.value);\n            return;\n        }\n\n        console.warn('event input ignore', target);\n    }\n\n    private callback_blur(_event: Event, callback_id: bigint) {\n        this.getWasm().wasm_callback(callback_id, undefined);\n    }\n\n    private callback_mousedown(event: Event, callback_id: bigint) {\n        if (this.getWasm().wasm_callback(callback_id, undefined)) {\n            event.preventDefault()\n        }\n    }\n\n    private callback_mouseup(event: Event, callback_id: bigint) {\n        if (this.getWasm().wasm_callback(callback_id, undefined)) {\n            event.preventDefault()\n        }\n    }\n\n    private callback_mouseenter(_event: Event, callback_id: bigint) {\n        this.getWasm().wasm_callback(callback_id, undefined);\n    }\n\n    private callback_mouseleave(_event: Event, callback_id: bigint) {\n        this.getWasm().wasm_callback(callback_id, undefined);\n    }\n\n    private callback_drop(event: Event, callback_id: bigint) {\n        event.preventDefault();\n\n        if (event instanceof DragEvent) {\n            if (event.dataTransfer === null) {\n                console.error('dom -> drop -> dataTransfer null');\n            } else {\n                const files: Array<Promise<FileItemType>> = [];\n\n                for (let i = 0; i < event.dataTransfer.items.length; i++) {\n                    const item = event.dataTransfer.items[i];\n\n                    if (item === undefined) {\n                        console.error('dom -> drop -> item - undefined');\n                    } else {\n                        const file = item.getAsFile();\n\n                        if (file === null) {\n                            console.error(`dom -> drop -> index:${i} -> It's not a file`);\n                        } else {\n                            files.push(file\n                                .arrayBuffer()\n                                .then((data): FileItemType => ({\n                                    name: file.name,\n                                    data: new Uint8Array(data),\n                                }))\n                            );\n                        }\n                    }\n                }\n\n                if (files.length) {\n                    Promise.all(files).then((files) => {\n                        const params = [];\n\n                        for (const file of files) {\n                            params.push([\n                                file.name,\n                                file.data,\n                            ]);\n                        }\n\n                        this.getWasm().wasm_callback(callback_id, [params]);\n                    }).catch((error) => {\n                        console.error('callback_drop -> promise.all -> ', error);\n                    });\n                } else {\n                    console.error('No files to send');\n                }\n            }\n        } else {\n            console.warn('event drop ignore', event);\n        }\n    }\n\n    private callback_keydown(event: Event, callback_id: bigint) {\n        if (event instanceof KeyboardEvent) {\n            const result = this.getWasm().wasm_callback(callback_id, [\n                event.key,\n                event.code,\n                event.altKey,\n                event.ctrlKey,\n                event.shiftKey,\n                event.metaKey\n            ]);\n\n            if (result === true) {\n                event.preventDefault();\n                event.stopPropagation();\n            }\n\n            return;\n        }\n\n        console.warn('keydown ignore', event);\n    }\n\n    private callback_load(event: Event, callback_id: bigint) {\n        event.preventDefault();\n        this.getWasm().wasm_callback(callback_id, undefined);\n    }\n\n    private callback_add(id: number, event_name: string, callback_id: bigint) {\n        const callback = (event: Event) => {\n            if (event_name === 'click') {\n                return this.callback_click(event, callback_id);\n            }\n\n            if (event_name === 'submit') {\n                return this.callback_submit(event, callback_id);\n            }\n\n            if (event_name === 'input') {\n                return this.callback_input(event, callback_id);\n            }\n\n            if (event_name === 'change') {\n                return this.callback_change(event, callback_id);\n            }\n\n            if (event_name === 'blur') {\n                return this.callback_blur(event, callback_id);\n            }\n\n            if (event_name === 'mousedown') {\n                return this.callback_mousedown(event, callback_id);\n            }\n\n            if (event_name === 'mouseup') {\n                return this.callback_mouseup(event, callback_id);\n            }\n\n            if (event_name === 'mouseenter') {\n                return this.callback_mouseenter(event, callback_id);\n            }\n\n            if (event_name === 'mouseleave') {\n                return this.callback_mouseleave(event, callback_id);\n            }\n\n            if (event_name === 'keydown') {\n                return this.callback_keydown(event, callback_id);\n            }\n\n            if (event_name === 'hook_keydown') {\n                return this.callback_keydown(event, callback_id);\n            }\n\n            if (event_name === 'drop') {\n                return this.callback_drop(event, callback_id);\n            }\n\n            if (event_name === 'load') {\n                return this.callback_load(event, callback_id);\n            }\n\n            console.error(`No support for the event ${event_name}`);\n        };\n\n        if (this.callbacks.has(callback_id)) {\n            console.error(`There was already a callback added with the callback_id=${callback_id}`);\n            return;\n        }\n\n        this.callbacks.set(callback_id, callback);\n\n        if (event_name === 'hook_keydown') {\n            document.addEventListener('keydown', callback, false);\n        } else {\n            const node = this.nodes.get('callback_add', id);\n            node.addEventListener(event_name, callback, false);\n        }\n    }\n\n    private callback_remove(id: number, event_name: string, callback_id: bigint) {\n        const callback = this.callbacks.get(callback_id);\n        this.callbacks.delete(callback_id);\n\n        if (callback === undefined) {\n            console.error(`The callback is missing with the id=${callback_id}`);\n            return;\n        }\n\n        if (event_name === 'hook_keydown') {\n            document.removeEventListener('keydown', callback);\n        } else {\n            const node = this.nodes.get('callback_remove', id);\n            node.removeEventListener(event_name, callback);\n        }\n    }\n\n    public dom_bulk_update = (commands: Array<CommandType>) => {\n        const setFocus: Set<number> = new Set();\n\n        for (const command of commands) {\n            try {\n                this.bulk_update_command(command);\n            } catch (error) {\n                console.error('bulk_update - item', error, command);\n            }\n\n            if (command.type === 'set_attr' && command.name.toLocaleLowerCase() === 'autofocus') {\n                setFocus.add(command.id);\n            }\n        }\n\n        if (setFocus.size > 0) {\n            setTimeout(() => {\n                for (const id of setFocus) {\n                    const node = this.nodes.get_node_element(`set focus ${id}`, id);\n                    node.focus();\n                }\n            }, 0);\n        }\n\n        this.nodes.removeInitNodes();\n    }\n\n    private bulk_update_command(command: CommandType) {\n        if (command.type === 'remove_node') {\n            this.remove_node(command.id);\n            return;\n        }\n\n        if (command.type === 'insert_before') {\n            this.nodes.insert_before(command.parent, command.child, command.ref_id === null ? null : command.ref_id);\n            return;\n        }\n\n        if (command.type === 'create_node') {\n            this.create_node(command.id, command.name);\n            return;\n        }\n\n        if (command.type === 'create_text') {\n            this.create_text(command.id, command.value);\n            return;\n        }\n\n        if (command.type === 'update_text') {\n            this.update_text(command.id, command.value);\n            return;\n        }\n\n        if (command.type === 'set_attr') {\n            this.set_attribute(command.id, command.name, command.value);\n            return;\n        }\n\n        if (command.type === 'remove_attr') {\n            this.remove_attribute(command.id, command.name);\n            return;\n        }\n\n        if (command.type === 'remove_text') {\n            this.remove_text(command.id);\n            return;\n        }\n\n        if (command.type === 'insert_css') {\n            this.nodes.insert_css(command.selector, command.value);\n            return;\n        }\n\n        if (command.type === 'create_comment') {\n            const comment = document.createComment(command.value);\n            this.nodes.set(command.id, comment);\n            return;\n        }\n\n        if (command.type === 'remove_comment') {\n            const comment = this.nodes.delete(\"remove_comment\", command.id);\n            comment.remove();\n            return;\n        }\n\n        if (command.type === 'callback_add') {\n            this.callback_add(command.id, command.event_name, BigInt(command.callback_id));\n            return;\n        }\n\n        if (command.type === 'callback_remove') {\n            this.callback_remove(command.id, command.event_name, BigInt(command.callback_id));\n            return;\n        }\n\n        return assertNeverCommand(command);\n    }\n}\n","import { ModuleControllerType } from \"./wasm_init\";\nimport { ExportType } from \"./wasm_module\";\nimport { DriverDom } from \"./api_browser/dom/dom\";\nimport { AppLocation } from \"./exec_command/location/AppLocation\";\n\n/**\n * @deprecated\n */\nexport class ApiBrowser {\n    public readonly dom: DriverDom;\n\n    constructor(getWasm: () => ModuleControllerType<ExportType>, appLocation: AppLocation) {\n        this.dom = new DriverDom(appLocation, getWasm);\n    }\n}\n","import { ApiBrowser } from \"./api_browser\";\nimport { convertFromJsValue, convertToJsValue } from \"./jsvalue\";\nimport { JsValueType } from \"./jsvalue_types\";\nimport { GuardJsValue } from './guard';\nimport { MapNodes } from \"./api_browser/dom/map_nodes\";\n\nexport class JsNode {\n    private api: ApiBrowser;\n    private nodes: MapNodes;\n    private wsk: unknown;\n\n    public constructor(\n        api: ApiBrowser,\n        nodes: MapNodes,\n        wsk: unknown\n    ) {\n        this.api = api;\n        this.nodes = nodes;\n        this.wsk = wsk;\n    }\n\n    getByProperty(path: Array<JsValueType>, property: string): JsNode | null {\n        try {\n            //@ts-expect-error\n            const nextCurrentPointer = this.wsk[property];\n            return new JsNode(this.api, this.nodes, nextCurrentPointer);\n        } catch (error) {\n            console.error('A problem with get', {\n                path,\n                property,\n                error\n            });\n            return null;\n        }\n    }\n\n    public toValue(): JsValueType {\n        return convertToJsValue(this.wsk);\n    }\n\n    public next(path: Array<JsValueType>, command: JsValueType): JsNode | null {\n        if (Array.isArray(command)) {\n            const [commandName, ...args] = command;\n\n            if (commandName === 'api') {\n                return this.nextApi(path, args);\n            }\n\n            if (commandName === 'root') {\n                return this.nextRoot(path, args);\n            }\n\n            if (commandName === 'get') {\n                return this.nextGet(path, args);\n            }\n\n            if (commandName === 'set') {\n                return this.nextSet(path, args);\n            }\n\n            if (commandName === 'call') {\n                return this.nextCall(path, args);\n            }\n\n            if (commandName === 'get_props') {\n                return this.nextGetProps(path, args);\n            }\n\n            console.error('JsNode.next - wrong commandName', commandName);\n            return null;\n        }\n\n        console.error('JsNode.next - array was expected', { path, command });\n        return null;\n    }\n\n    nextApi(path: Array<JsValueType>, args: Array<JsValueType>): JsNode | null {\n        if (args.length === 0) {\n            return new JsNode(this.api, this.nodes, this.api);\n        }\n\n        console.error('nextApi: wrong parameter', {path, args});\n        return null;\n    }\n\n    nextRoot(path: Array<JsValueType>, args: Array<JsValueType>): JsNode | null {\n        const [firstName, ...rest] = args;\n\n        if (GuardJsValue.isString(firstName) && rest.length === 0) {\n            if (firstName === 'window') {\n                return new JsNode(this.api, this.nodes, window);\n            }\n\n            if (firstName === 'document') {\n                return new JsNode(this.api, this.nodes, document);\n            }\n\n            console.error(`JsNode.nextRoot: Global name not found -> ${firstName}`, {path, args});\n            return null;\n        }\n\n        if ((GuardJsValue.isNumber(firstName) || GuardJsValue.isBigInt(firstName)) && rest.length === 0) {\n            const domId = Number(firstName.value);\n\n            const node = this.nodes.get_any_option(domId);\n\n            if (node !== undefined) {\n                return new JsNode(this.api, this.nodes, node);\n            }\n\n            console.error(`JsNode.nextRoot: No node with id=${domId}`, {path, args});\n            return null;\n        }\n\n        console.error('JsNode.nextRoot: wrong parameter', {path, args});\n        return null;\n    }\n\n    nextGet(path: Array<JsValueType>, args: Array<JsValueType>): JsNode | null {\n        const [property, ...getArgs] = args;\n\n        if (GuardJsValue.isString(property) && getArgs.length === 0) {\n            return this.getByProperty(path, property);\n        }\n\n        console.error('JsNode.nextGet - wrong parameters', { path, args });\n        return null;\n    }\n\n    nextSet(path: Array<JsValueType>, args: Array<JsValueType>): JsNode | null {\n        const [property, value, ...setArgs] = args;\n\n        if (GuardJsValue.isString(property) && setArgs.length === 0) {\n            try {\n                //@ts-expect-error\n                this.wsk[property] = convertFromJsValue(value);\n                return new JsNode(this.api, this.nodes, undefined);\n            } catch (error) {\n                console.error('A problem with set', {\n                    path,\n                    property,\n                    error\n                });\n                return null;\n            }\n        }\n\n        console.error('JsNode.nextSet - wrong parameters', { path, args });\n        return null;\n    }\n\n    nextCall(path: Array<JsValueType>, args: Array<JsValueType>): JsNode | null {\n        const [property, ...callArgs] = args;\n\n        if (GuardJsValue.isString(property)) {\n            try {\n                let paramsJs = callArgs.map(convertFromJsValue);\n                //@ts-expect-error\n                const result = this.wsk[property](...paramsJs);\n                return new JsNode(this.api, this.nodes, result);\n            } catch (error) {\n                console.error('A problem with call', {\n                    path,\n                    property,\n                    error\n                });\n                return null;\n            }\n        }\n\n        console.error('JsNode.nextCall - wrong parameters', { path, args });\n        return null;\n    }\n\n    nextGetProps(path: Array<JsValueType>, args: Array<JsValueType>): JsNode | null {\n        const result: Record<string, JsValueType> = {};\n\n        for (const property of args) {\n            if (GuardJsValue.isString(property)) {\n                const value = this.getByProperty(path, property);\n                if (value === null) {\n                    return null;\n                }\n\n                result[property] = value.toValue();\n            } else {\n                console.error('JsNode.nextGetProps - wrong parameters', { path, args, property });\n                return null;\n            }\n        }\n\n        return new JsNode(this.api, this.nodes, result);\n    }\n}\n","export class EventEmitter<T> {\n    private events: Set<(param: T) => void>;\n\n    constructor() {\n        this.events = new Set()\n    }\n\n    on(callback: (param: T) => void) {\n        let isActive = true;\n\n        const onExec = (param: T) => {\n            if (isActive) {\n                callback(param);\n            }\n        };\n\n        this.events.add(onExec);\n\n        return () => {\n            isActive = false;\n            this.events.delete(onExec);\n        };\n    }\n\n    trigger(param: T) {\n        const eventsCopy = Array.from(this.events.values())\n\n        for (const itemCallbackToRun of eventsCopy) {\n            try {\n                itemCallbackToRun(param);\n            } catch (err) {\n                console.error(err);\n            }\n        }\n    }\n\n    get size(): number {\n        return this.events.size;\n    }\n}\n","type ResolveFn<T> = (data: T) => void;\ntype RejectFn = (err: unknown) => void;\n\ninterface PromiseResolveReject<T> {\n    readonly resolve: (value: T) => void,\n    readonly reject: (err: unknown) => void,\n};\n\nconst createPromiseValue = <T>(): [PromiseResolveReject<T>, Promise<T>] => {\n    let resolve: ResolveFn<T> | null = null;\n    let reject: RejectFn | null = null;\n\n    const promise: Promise<T> = new Promise((localResolve: ResolveFn<T>, localReject: RejectFn) => {\n        resolve = localResolve;\n        reject = localReject;\n    });\n\n    if (resolve === null) {\n        throw Error('createPromiseValue - resolve is null');\n    }\n\n    if (reject === null) {\n        throw Error('createPromiseValue - reject is null');\n    }\n\n    const promiseValue = {\n        resolve,\n        reject,\n    };\n\n    return [promiseValue, promise];\n};\n\nexport class PromiseBoxRace<T> {\n    private promiseResolveReject: PromiseResolveReject<T> | null = null;\n    readonly promise: Promise<T>;\n\n    constructor() {\n        const [promiseResolveReject, promise] = createPromiseValue<T>();\n\n        this.promiseResolveReject = promiseResolveReject;\n        this.promise = promise;\n    }\n\n    resolve = (value: T) => {\n        const promiseResolveReject = this.promiseResolveReject;\n        this.promiseResolveReject = null;\n\n        if (promiseResolveReject === null) {\n            return;\n        }\n\n        promiseResolveReject.resolve(value);\n    }\n\n    reject = (err?: unknown) => {\n        const promiseResolveReject = this.promiseResolveReject;\n        this.promiseResolveReject = null;\n\n        if (promiseResolveReject === null) {\n            return;\n        }\n\n        promiseResolveReject.reject(err);\n    }\n\n    isFulfilled = (): boolean => {\n        return this.promiseResolveReject === null;\n    }\n}\n","import { EventEmitter } from \"./event_emiter\";\nimport { PromiseBoxRace } from \"./promise\";\n\nconst timeout = async (timeout: number): Promise<void> => {\n    return new Promise((resolve: (data: void) => void) => {\n        setTimeout(resolve, timeout);\n    });\n};\n\n\nconst reconnectDelay = async (label: string, timeout_retry: number): Promise<void> => {\n    console.info(`${label} wait ${timeout_retry}ms`);\n    await timeout(timeout_retry);\n    console.info(`${label} go forth`);\n};\n\nexport type SocketEventType = {\n    type: 'message',\n    message: string,\n} | {\n    type: 'socket',\n    socket: SocketConnection\n} | {\n    type: 'close',\n};\n\nexport type OnMessageType = (message: SocketEventType) => void;\nexport type UnsubscribeFnType = () => void;\n\ninterface OpenSocketResult {\n    socket: Promise<SocketConnection | null>,\n    done: Promise<void>,\n}\n\nexport interface SocketConnectionController {\n    send: (message: string) => void,\n    dispose: UnsubscribeFnType\n}\n\nclass LogContext {\n    public constructor(private host: string) {}\n    public formatLog = (message: string): string => `Socket ${this.host} ==> ${message}`;\n}\nexport class SocketConnection {\n    private readonly eventMessage: EventEmitter<string>;\n    public readonly close: () => void;\n    public readonly send: (message: string) => void;\n\n    private constructor(\n        close: () => void,\n        send: (message: string) => void,\n    ) {\n        this.eventMessage = new EventEmitter();\n        this.close = close;\n        this.send = send;\n    }\n\n    private static connect(\n        log: LogContext,\n        host: string,\n        timeout: number,\n    ): OpenSocketResult {\n        const result = new PromiseBoxRace<SocketConnection | null>();\n        const done = new PromiseBoxRace<void>();\n        const socket = new WebSocket(host);\n        let isClose: boolean = false;\n\n        console.info(log.formatLog('starting ...'));\n\n        const closeSocket = (): void => {\n            if (isClose) {\n                return;\n            }\n\n            console.info(log.formatLog('close'));\n\n            isClose = true;\n            result.resolve(null);\n            done.resolve();\n            socket.close();\n        };\n\n\n        const socketConnection = new SocketConnection(\n            closeSocket,\n            (message: string) => {\n                if (isClose) {\n                    return;\n                }\n                socket.send(message);\n            }\n        );\n\n        setTimeout(() => {\n            if (result.isFulfilled() === false) {\n                console.error(log.formatLog(`timeout (${timeout}ms)`));\n                closeSocket();\n            }\n        }, timeout);\n\n        const onOpen = (): void => {\n            console.info(log.formatLog('open'));\n            result.resolve(socketConnection);\n        };\n\n        const onError = (error: Event): void => {\n            console.error(log.formatLog('error'), error);\n            closeSocket();\n        };\n\n        const onMessage = (event: MessageEvent): void => {\n            if (isClose) {\n                return;\n            }\n\n            const dataRaw = event.data;\n\n            if (typeof dataRaw === 'string') {\n                socketConnection.eventMessage.trigger(dataRaw);\n                return;\n            }\n\n            console.error(log.formatLog('onMessage - expected string'), dataRaw);\n        };\n\n        socket.addEventListener('open', onOpen);\n        socket.addEventListener('error', onError);\n        socket.addEventListener('close', closeSocket);\n        socket.addEventListener('message', onMessage);\n\n        return {\n            socket: result.promise,\n            done: done.promise\n        };\n    }\n\n    public static startSocket(\n        host: string,\n        timeout_connection: number,\n        timeout_retry: number,\n        onMessage: OnMessageType,\n    ): SocketConnectionController {\n        let isConnect: boolean = true;\n        let socketConnection: SocketConnection | null = null;\n\n        const log = new LogContext(host);\n\n        (async (): Promise<void> => {\n            while (isConnect) {\n                const openSocketResult = SocketConnection.connect(log, host, timeout_connection);\n\n                const socket = await openSocketResult.socket;\n\n                if (socket === null) {\n                    await reconnectDelay(log.formatLog('reconnect after error'), timeout_retry);\n                    continue;\n                }\n\n                socketConnection = socket;\n                onMessage({\n                    type: 'socket',\n                    socket\n                });\n\n                socket.eventMessage.on(message => {\n                    onMessage({\n                        type: 'message',\n                        message\n                    });\n                });\n\n                await openSocketResult.done;\n\n                onMessage({\n                    type: 'close'\n                });\n\n                if (!isConnect) {\n                    console.info(log.formatLog('disconnect (1)'));\n                    return;\n                }\n\n                await reconnectDelay(log.formatLog('reconnect after close'), timeout_retry);\n            }\n\n            console.info(log.formatLog('disconnect (2)'));\n        })().catch((error) => {\n            console.error(error);\n        });\n\n        return {\n            send: (message: string): void => {\n                if (socketConnection === null) {\n                    console.error('send fail - missing connection', message);\n                } else {\n                    socketConnection.send(message);\n                }\n            },\n            dispose: (): void => {\n                isConnect = false;\n                socketConnection?.close();\n            }\n        };\n    }\n}\n","import { ModuleControllerType } from \"../../wasm_init\";\nimport { ExportType } from \"../../wasm_module\";\nimport { CallbackId } from \"../types\";\nimport { SocketConnection, SocketConnectionController } from \"./connection\";\n\n\nconst assertNeverMessage = (data: never): never => {\n    console.error(data);\n    throw Error('unknown message');\n};\n\ntype CommandType = 'Connected' | 'Disconnected' | {\n    'Message': {\n        message: string,\n    }\n}\nconst wasmCallback = (wasm: ModuleControllerType<ExportType>, callbackId: CallbackId, command: CommandType) => {\n    wasm.wasm_command({\n        'Websocket': {\n            callback: callbackId,\n            message: command,\n        }\n    })\n};\n\n\nexport class DriverWebsocket {\n    private getWasm: () => ModuleControllerType<ExportType>;\n    private readonly controllerList: Map<CallbackId, SocketConnectionController>;\n    private readonly socket: Map<CallbackId, SocketConnection>;\n\n    constructor(getWasm: () => ModuleControllerType<ExportType>) {\n        this.getWasm = getWasm;\n        this.controllerList = new Map();\n        this.socket = new Map();\n    }\n\n    public websocket_register_callback = (\n        host: string,\n        callback_id: CallbackId,\n    ) => {\n        const wasm = this.getWasm();\n\n        let controller = SocketConnection.startSocket(\n            host,\n            5000,                   //timeout connection\n            3000,                   //timeout reconnection\n            (message) => {\n\n                if (this.controllerList.has(callback_id) === false) {\n                    return;\n                }\n\n                if (message.type === 'socket') {\n                    this.socket.set(callback_id, message.socket);\n                    wasmCallback(wasm, callback_id, 'Connected');\n                    return;\n                }\n\n                if (message.type === 'message') {\n                    wasmCallback(wasm, callback_id, {\n                        'Message': {\n                            message: message.message\n                        }\n                    });\n                    return;\n                }\n\n                if (message.type === 'close') {\n                    this.socket.delete(callback_id);\n                    wasmCallback(wasm, callback_id, 'Disconnected');\n                    return;\n                }\n\n                return assertNeverMessage(message);\n            }\n        );\n\n        this.controllerList.set(callback_id, controller);\n    }\n\n    public websocket_unregister_callback = (callback_id: CallbackId) => {\n        const controller = this.controllerList.get(callback_id);\n\n        if (controller === undefined) {\n            console.error('Expected controller');\n            return;\n        }\n\n        controller.dispose();\n        this.controllerList.delete(callback_id);\n    }\n\n    public websocket_send_message = (\n        callback_id: CallbackId,\n        message: string,\n    ) => {\n        const socket = this.socket.get(callback_id);\n\n        if (socket === undefined) {\n            console.error(`Missing socket connection for callback_id=${callback_id}`);\n        } else {\n            socket.send(message);\n        }\n    }\n}\n","import { JsJsonType } from \"../../jsjson\";\n\n// interface ResponseType {\n//     data: string | null,\n// }\n\nexport const fetchCacheGet = (): JsJsonType => {\n    const cache = document.getElementById('v-metadata')?.getAttribute('data-fetch-cache') ?? null;\n\n    return {\n        data: cache\n    };\n};\n","import { JsJsonType } from \"../../jsjson\";\nimport { ModuleControllerType } from \"../../wasm_init\";\nimport { ExportType } from \"../../wasm_module\";\nimport { CallbackId } from \"../types\";\n\nexport interface FetchRequestType {\n    method: string,\n    url: string,\n    headers: Array<{ k: string, v: string }>,\n    body: 'None' | {\n        Data: {\n            data: JsJsonType\n        }\n    }\n}\n\ntype FetchResponseType = {\n    Ok: {\n        status: number,\n        response: {\n            Text: string\n         } | {\n            Json: JsJsonType,\n         }\n    }\n} | {\n    Error: {\n        message: string,\n    }\n};\n\nconst getHeaders = (headers: Array<{ k: string, v: string }>): Record<string, string> => {\n    const result: Record<string, string> = {};\n\n    for (const { k, v } of headers) {\n        result[k] = v;\n    }\n\n    return result;\n};\n\nconst getBodyString = (body: FetchRequestType['body']): string | undefined => {\n    if (body === 'None') {\n        return undefined;\n    }\n\n    return JSON.stringify(body.Data.data);\n};\n\nconst processResponse = async (response: Response): Promise<FetchResponseType> => {\n    const status = response.status;\n    const contentType = response.headers.get(\"Content-Type\");\n\n    try {\n        if (contentType?.startsWith('text/plain;')) {\n            return {\n                Ok:  {\n                    status,\n                    response: {\n                        Text: await response.text(),\n                    }\n                }\n            }\n        }\n\n        return {\n            Ok: {\n                status,\n                response: {\n                    Json: await response.json()\n                }\n            }\n        };\n    } catch (error) {\n        return {\n            Error: {\n                message: String(error),\n            }\n        };\n    }\n};\n\n\nexport const fetchExec = async (\n    getWasm: () => ModuleControllerType<ExportType>,\n    callback_id: CallbackId,\n    request: FetchRequestType\n): Promise<void> => {\n    const wasm = getWasm();\n\n    console.info('fetch request', request);\n\n    try {\n        const response = await fetch(request.url, {\n            method: request.method,\n            headers: getHeaders(request.headers),\n            body: getBodyString(request.body),\n        });\n\n        const response2 = await processResponse(response);\n\n        wasm.wasm_command({\n            'FetchExecResponse': {\n                response: response2,\n                callback: Number(callback_id),\n            }\n        });\n\n    } catch (err) {\n        console.error('fetch error (1)', err);\n        const responseMessage = new String(err).toString();\n\n        const responseToWasm: FetchResponseType = {\n            'Error': {\n                message: responseMessage\n            }\n        };\n\n        wasm.wasm_command({\n            'FetchExecResponse': {\n                response: responseToWasm,\n                callback: Number(callback_id),\n            }\n        });\n    }\n};\n\n\n","import { CallbackId } from \"../types\";\nimport { ModuleControllerType } from \"../../wasm_init\";\nimport { ExportType } from \"../../wasm_module\";\n\ntype TimerResourceId = ReturnType<typeof setTimeout>;\n\ninterface TimerId {\n    kind: 'Interval' | 'Timeout',\n    timerId: TimerResourceId,\n}\n\nexport class Interval {\n    private readonly getWasm: () => ModuleControllerType<ExportType>;\n    private readonly data: Map<CallbackId, TimerId>;\n\n    constructor(getWasm: () => ModuleControllerType<ExportType>) {\n        this.getWasm = getWasm;\n        this.data = new Map();\n    }\n\n    timerSet = (callback: CallbackId, duration: number, kind: 'Interval' | 'Timeout') => {\n        switch (kind) {\n            case 'Interval': {\n                const timerId = setInterval(() => {\n                    this.getWasm().wasm_command({\n                        'TimerCall': {\n                            callback,\n                        },\n                    })\n                }, duration);\n\n                this.data.set(callback, {\n                    kind: 'Interval',\n                    timerId,\n                });\n                break;\n            }\n            case 'Timeout': {\n                const timerId = setTimeout(() => {\n                    this.getWasm().wasm_command({\n                        'TimerCall': {\n                            callback,\n                        },\n                    })\n                }, duration);\n\n                this.data.set(callback, {\n                    kind: 'Timeout',\n                    timerId,\n                });\n                break;\n            }\n        }\n    }\n\n    timerClear = (callback: CallbackId) => {\n        const timerResource = this.data.get(callback);\n\n        if (timerResource === undefined) {\n            throw Error('panic');\n        }\n\n        switch (timerResource.kind) {\n            case 'Interval': {\n                clearInterval(timerResource.timerId);\n                break;\n            }\n            case 'Timeout': {\n                clearTimeout(timerResource.timerId);\n                break;\n            }\n        }\n    }\n}\n","import { JsJsonType } from \"../../jsjson\";\n\nexport class Cookies {\n    public get = (cname: string): string => {\n        for (const cookie of document.cookie.split(';')) {\n            if (cookie === \"\") continue;\n\n            const cookieChunk = cookie.trim().split('=');\n\n            if (cookieChunk.length !== 2) {\n                console.warn(`Cookies.get: Incorrect number of cookieChunk => ${cookieChunk.length} in ${cookie}`);\n                continue;\n            }\n\n            const cookieName = cookieChunk[0];\n            const cookieValue = cookieChunk[1];\n\n            if (cookieName === undefined || cookieValue === undefined) {\n                console.warn(`Cookies.get: Broken cookie part => ${cookie}`);\n                continue;\n            }\n\n            if (cookieName === cname) {\n                return decodeURIComponent(cookieValue);\n            }\n        }\n\n        return '';\n    }\n\n    public get_json = (cname: string): JsJsonType => {\n        let cvalue_str = this.get(cname);\n\n        if (cvalue_str.length !== 0) {\n            try {\n                let cookie_value = JSON.parse(cvalue_str);\n                return cookie_value;\n            } catch (e) {\n                console.error!(\"Error deserializing cookie\", e);\n            }\n        }\n        return null\n    }\n\n    public set = (\n        cname: string,\n        cvalue: string,\n        expires_in: number,\n    ) => {\n        const cvalueEncoded = cvalue == null ? \"\" : encodeURIComponent(cvalue);\n\n        const d = new Date();\n        d.setTime(d.getTime() + (expires_in * 1000));\n        let expires = \"expires=\"+ d.toUTCString();\n\n        document.cookie = `${cname}=${cvalueEncoded};${expires};path=/;samesite=strict\"`;\n    }\n\n    public set_json = (\n        cname: string,\n        cvalue: JsJsonType,\n        expires_in: number,\n    ) => {\n        let cvalue_str = JSON.stringify(cvalue);\n\n        this.set(cname, cvalue_str, expires_in);\n    }\n}\n","export const getRandom = (min: number, max: number): number => {\n    const range = max - min + 1;\n    let result = Math.floor(Math.random() * range);\n    return min + result;\n};\n\n","import { DriverWebsocket } from \"./websocket/websocket\";\nimport { assertNever } from \"../assert_never\";\nimport { JsJsonType } from \"../jsjson\";\nimport { ModuleControllerType } from \"../wasm_init\";\nimport { ExportType } from \"../wasm_module\";\nimport { fetchCacheGet } from \"./command/fetchCacheGet\";\nimport { fetchExec, FetchRequestType } from \"./command/fetchExec\";\nimport { CallbackId } from \"./types\";\nimport { Interval } from \"./command/interval\";\nimport { AppLocation } from './location/AppLocation';\nimport { Cookies } from \"./command/cookies\";\nimport { getRandom } from \"./command/getRandom\";\n\ntype ExecType\n    = 'FetchCacheGet'\n    | 'IsBrowser'\n    | 'GetDateNow'\n    | 'TimezoneOffset'\n    | 'HistoryBack'\n    | {\n        FetchExec: {\n            callback: CallbackId,\n            request: FetchRequestType,\n        }\n    }\n    | {\n        WebsocketRegister: {\n            callback: CallbackId,\n            host: string\n        }\n    }\n    | {\n        WebsocketSendMessage: {\n            callback: CallbackId,\n            message: string,\n        }\n    }\n    | {\n        WebsocketUnregister: {\n            callback: CallbackId,\n        }\n    }\n    | {\n        TimerSet: {\n            callback: CallbackId,\n            duration: number,\n            kind: 'Interval' | 'Timeout',\n        }\n    }\n    | {\n        TimerClear: {\n            callback: CallbackId,\n        }\n    }\n    | {\n        LocationGet: {\n            target: 'Hash' | 'History',\n        }\n    }\n    | {\n        LocationCallback: {\n            callback: number,\n            mode: 'Add' | 'Remove',\n            target: 'Hash' | 'History'\n        }\n    }\n    | {\n        LocationSet: {\n            mode: 'Push' | 'Replace',\n            target: 'Hash' | 'History'\n            value: string\n        }\n    }\n    | {\n        CookieSet: {\n            name: string,\n            value: string,\n            expires_in: number,\n        }\n    }\n    | {\n        CookieGet: {\n            name: string,\n        }\n    }\n    | {\n        CookieJsonSet: {\n            name: string,\n            value: JsJsonType,\n            expires_in: number,\n        }\n    }\n    | {\n        CookieJsonGet: {\n            name: string,\n        }\n    }\n    | {\n        GetEnv: {\n            name: string\n        }\n    }\n    | {\n        ConsoleLog: {\n            arg2: string, //\"color: white; padding: 0 3px; background: green;\",\n            arg3: string, //\"font-weight: bold; color: inherit\",\n            arg4: string, //\"background: inherit; color: inherit\",\n            kind: 'Debug' | 'Info' | 'Log' | 'Warn' | 'Error',\n            message: string, //\"%cINFO%c crates/vertigo/src/driver_module/api/api_fetch_cache.rs:26%c FetchCache ready\"\n        }\n    }\n    | {\n        GetRandom: {\n            max: number,\n            min: number\n        }\n    };\n\nexport class ExecCommand {\n    private readonly websocket: DriverWebsocket;\n    private readonly interval: Interval;\n    private readonly location: AppLocation;\n    private readonly cookie: Cookies;\n    \n\n    constructor(private readonly getWasm: () => ModuleControllerType<ExportType>, location: AppLocation) {\n        this.websocket = new DriverWebsocket(getWasm);\n        this.interval = new Interval(getWasm);\n        this.location = location;\n        this.cookie = new Cookies();\n    }\n\n    exec(arg: JsJsonType): JsJsonType {\n\n        //@ts-expect-error - //TODO Add safe type checking\n        const safeArg: ExecType = arg;\n\n        // console.info('exec arg', safeArg);\n\n        if (safeArg === 'FetchCacheGet') {\n            return fetchCacheGet();\n        }\n\n        if (safeArg === 'IsBrowser') {\n            return {\n                value: true\n            };\n        }\n\n        if (safeArg === 'GetDateNow') {\n            return {\n                value: Date.now(),\n            };\n        }\n\n        if (safeArg === 'TimezoneOffset') {\n            return {\n                value: new Date().getTimezoneOffset()\n            };\n        }\n\n        if (safeArg === 'HistoryBack') {\n            window.history.back();\n            return null;\n        }\n\n        if ('FetchExec' in safeArg) {\n            fetchExec(this.getWasm, safeArg.FetchExec.callback, safeArg.FetchExec.request);\n            return null;\n        }\n\n        if ('WebsocketRegister' in safeArg) {\n            this.websocket.websocket_register_callback(safeArg.WebsocketRegister.host, safeArg.WebsocketRegister.callback);\n            return null;\n        }\n\n        if ('WebsocketSendMessage' in safeArg) {\n            this.websocket.websocket_send_message(safeArg.WebsocketSendMessage.callback, safeArg.WebsocketSendMessage.message);\n            return null;\n        }\n\n        if ('WebsocketUnregister' in safeArg) {\n            this.websocket.websocket_unregister_callback(safeArg.WebsocketUnregister.callback);\n            return null;\n        }\n\n        if ('TimerSet' in safeArg) {\n            this.interval.timerSet(safeArg.TimerSet.callback, safeArg.TimerSet.duration, safeArg.TimerSet.kind);\n            return null;\n        }\n\n        if ('TimerClear' in safeArg) {\n            this.interval.timerClear(safeArg.TimerClear.callback);\n            return null;\n        }\n\n        if ('LocationGet' in safeArg) {\n            return {\n                value: this.location.get(safeArg.LocationGet.target)\n            };\n        }\n\n        if ('LocationCallback' in safeArg) {\n            this.location.callback(safeArg.LocationCallback.target, safeArg.LocationCallback.mode, safeArg.LocationCallback.callback);\n            return null;\n        }\n\n        if ('LocationSet' in safeArg) {\n            this.location.set(safeArg.LocationSet.target, safeArg.LocationSet.mode, safeArg.LocationSet.value);\n            return null;\n        }\n\n        if ('CookieGet' in safeArg) {\n            return {\n                value: this.cookie.get(safeArg.CookieGet.name)\n            };\n        }\n\n        if ('CookieSet' in safeArg) {\n            this.cookie.set(safeArg.CookieSet.name, safeArg.CookieSet.value, safeArg.CookieSet.expires_in);\n            return null;\n        }\n\n        if ('CookieJsonGet' in safeArg) {\n            return {\n                value: this.cookie.get_json(safeArg.CookieJsonGet.name)\n            };\n        }\n\n        if ('CookieJsonSet' in safeArg) {\n            this.cookie.set_json(safeArg.CookieJsonSet.name, safeArg.CookieJsonSet.value, safeArg.CookieJsonSet.expires_in);\n            return null;\n        }\n\n        if ('GetEnv' in safeArg) {\n            const name = safeArg.GetEnv.name;\n\n            return {\n                value: document.getElementById('v-metadata')?.getAttribute(`data-env-${name}`) ?? null\n            }\n        }\n\n        if ('ConsoleLog' in safeArg) {\n            switch (safeArg.ConsoleLog.kind) {\n                case 'Info': {\n                    console.info(safeArg.ConsoleLog.message, safeArg.ConsoleLog.arg2, safeArg.ConsoleLog.arg3, safeArg.ConsoleLog.arg4);\n                    return null;\n                }\n                case 'Debug': {\n                    console.debug(safeArg.ConsoleLog.message, safeArg.ConsoleLog.arg2, safeArg.ConsoleLog.arg3, safeArg.ConsoleLog.arg4);\n                    return null;\n                }\n                case 'Error': {\n                    console.error(safeArg.ConsoleLog.message, safeArg.ConsoleLog.arg2, safeArg.ConsoleLog.arg3, safeArg.ConsoleLog.arg4);\n                    return null;\n                }\n                case 'Log': {\n                    console.log(safeArg.ConsoleLog.message, safeArg.ConsoleLog.arg2, safeArg.ConsoleLog.arg3, safeArg.ConsoleLog.arg4);\n                    return null;\n                }\n                case 'Warn': {\n                    console.warn(safeArg.ConsoleLog.message, safeArg.ConsoleLog.arg2, safeArg.ConsoleLog.arg3, safeArg.ConsoleLog.arg4);\n                    return null;\n                }\n            }\n        }\n\n        if ('GetRandom' in safeArg) {\n            return {\n                value: getRandom(safeArg.GetRandom.min, safeArg.GetRandom.max)\n            };\n        }\n\n        console.info('exec_command: Arg', safeArg);\n        return assertNever(safeArg);\n    }\n}\n","import { ModuleControllerType } from \"../../wasm_init\";\nimport { ExportType } from \"../../wasm_module\";\nimport { CallbackId } from \"../types\";\nimport { LocationCommonType } from \"./types\";\n\nexport class HashRouter implements LocationCommonType {\n    private getWasm: () => ModuleControllerType<ExportType>;\n    private callback: Map<CallbackId, () => void>;\n\n    constructor(getWasm: () => ModuleControllerType<ExportType>) {\n        this.getWasm = getWasm;\n        this.callback = new Map();\n\n        window.addEventListener(\"hashchange\", this.trigger);\n    }\n\n    private trigger = () => {\n        for (const callback of Array.from(this.callback.values())) {\n            callback();\n        }\n    }\n\n    public add = (callback_id: CallbackId) => {\n        this.callback.set(callback_id, () => {\n            this.getWasm().wasm_command({\n                LocationCall: {\n                    callback: callback_id,\n                    value: this.get(),\n                }\n            });\n        });\n    }\n\n    public remove = (callback_id: CallbackId) => {\n        this.callback.delete(callback_id);\n    }\n\n    public push = (new_hash: string) => {\n        if (this.get() === new_hash) {\n            return;\n        }\n\n        location.hash = new_hash;\n        this.trigger();\n    }\n\n    public replace = (new_hash: string) => {\n        if (this.get() === new_hash) {\n            return;\n        }\n\n        history.replaceState(null, '', `#${new_hash}`);\n    }\n\n    public get(): string {\n        return decodeURIComponent(location.hash.substr(1));\n    }\n}\n","import { ModuleControllerType } from \"../../wasm_init\";\nimport { ExportType } from \"../../wasm_module\";\nimport { CallbackId } from \"../types\";\nimport { LocationCommonType } from \"./types\";\n\nexport class HistoryLocation implements LocationCommonType {\n    private getWasm: () => ModuleControllerType<ExportType>;\n    private callback: Map<CallbackId, () => void>;\n\n    constructor(getWasm: () => ModuleControllerType<ExportType>) {\n        this.getWasm = getWasm;\n        this.callback = new Map();\n\n        window.addEventListener(\"popstate\", this.trigger);\n    }\n\n    private trigger = () => {\n        for (const callback of Array.from(this.callback.values())) {\n            callback();\n        }\n    }\n\n    public add = (callback_id: CallbackId) => {\n        this.callback.set(callback_id, () => {\n            this.getWasm().wasm_command({\n                LocationCall: {\n                    callback: callback_id,\n                    value: this.get(),\n                }\n            });\n        });\n    }\n\n    public remove = (callback_id: CallbackId) => {\n        this.callback.delete(callback_id);\n    }\n\n    public push = (url: string) => {\n        if (this.get() === url) {\n            return;\n        }\n\n        window.history.pushState(null, '', url);\n        this.trigger();\n    }\n\n    public replace = (url: string) => {\n        if (this.get() === url) {\n            return;\n        }\n\n        window.history.replaceState(null, '', url);\n        this.trigger();\n    }\n\n    public get(): string {\n        return window.location.pathname + window.location.search + window.location.hash;\n    }\n}\n","import { ModuleControllerType } from \"../../wasm_init\";\nimport { ExportType } from \"../../wasm_module\";\nimport { CallbackId } from \"../types\";\nimport { HashRouter } from \"./hashrouter\";\nimport { HistoryLocation } from \"./historyLocation\";\nimport { LocationCommonType } from \"./types\";\n\ntype LocationTarget = 'Hash' | 'History';\n\nexport class AppLocation {\n    private readonly locations: Record<LocationTarget, LocationCommonType>;\n\n    constructor(getWasm: () => ModuleControllerType<ExportType>) {\n        this.locations = {\n            Hash: new HashRouter(getWasm),\n            History: new HistoryLocation(getWasm),\n        };\n    }\n    \n    callback = (target: LocationTarget, mode: 'Add' | 'Remove', callbackId: CallbackId) => {\n        switch (mode) {\n            case 'Add': {\n                this.locations[target].add(callbackId);\n                return;\n            }\n            case 'Remove': {\n                this.locations[target].remove(callbackId);\n                return;\n            }\n        }\n    }\n\n    set = (target: LocationTarget, mode: 'Push' | 'Replace', newValue: string) => {\n        switch (mode) {\n            case 'Push': {\n                this.locations[target].push(newValue);\n                return;\n            }\n            case 'Replace': {\n                 this.locations[target].replace(newValue);\n                 return;\n            }\n        }\n    }\n\n    get = (target: LocationTarget): string => {\n        return this.locations[target].get();\n    }\n}","import { wasmInit, ModuleControllerType } from './wasm_init';\nimport { ApiBrowser as ApiBrowser } from './api_browser';\nimport { JsNode } from './js_node';\nimport { GuardJsValue } from './guard';\nimport { ExecCommand } from './exec_command/exec_command';\nimport { JsValueConst } from './jsvalue_types';\nimport { AppLocation } from './exec_command/location/AppLocation';\n\n//Number -> u32 or i32\n//BigInt -> u64 or i64\n\nexport type ImportType = {\n    panic_message: (long_ptr: bigint) => void,\n    //call from rust - To be deleted eventually\n    dom_access: (long_ptr: bigint) => bigint,\n}\n\nexport type ExportType = {\n    vertigo_export_alloc_block: (size: number) => bigint,\n    vertigo_export_free_block: (pointer: bigint) => void,\n    //TODO - This function is to be removed eventually.\n    vertigo_export_wasm_callback: (callback_id: bigint, value_ptr: bigint) => bigint,\n    vertigo_export_wasm_command: (value_ptr: bigint) => bigint,\n    vertigo_entry_function: (major: number, minor: number) => void,\n}\n\nexport class WasmModule {\n    private readonly wasm: ModuleControllerType<ExportType>;\n\n    private constructor(\n        wasm: ModuleControllerType<ExportType>,\n    ) {\n        this.wasm = wasm;\n    }\n\n    public vertigo_entry_function(major: number, minor: number) {\n        this.wasm.exports.vertigo_entry_function(major, minor);\n    }\n\n    public static async create(wasmBinPath: string): Promise<WasmModule> {\n        let wasmModule: ModuleControllerType<ExportType> | null = null;\n\n        const getWasm = (): ModuleControllerType<ExportType> => {\n            if (wasmModule === null) {\n                throw Error('Wasm is no initialized');\n            }\n\n            return wasmModule;\n        };\n\n        const appLocation = new AppLocation(getWasm);\n        const apiBrowser = new ApiBrowser(getWasm, appLocation);\n        const execCommand = new ExecCommand(getWasm, appLocation);\n\n        //@ts-expect-error\n        window.$vertigoApi = apiBrowser;\n\n        wasmModule = await wasmInit<ImportType, ExportType>(wasmBinPath, {\n            mod: {\n                panic_message: (long_ptr: bigint) => {\n\n                    const size = Number(long_ptr % (2n ** 32n));\n                    const ptr = Number(long_ptr >> 32n);\n\n                    const decoder = new TextDecoder(\"utf-8\");\n                    const m = getWasm().getUint8Memory().subarray(ptr, ptr + size);\n                    const message = decoder.decode(m);\n                    console.error('PANIC', message);\n                },\n                dom_access: (long_ptr: bigint): bigint => {\n                    let args = getWasm().decodeArgumentsLong(long_ptr);\n\n                    //new wersion\n                    if (GuardJsValue.isJson(args)) {\n                        const response = execCommand.exec(args.value);\n                        return getWasm().valueSaveToBufferLong({\n                            type: JsValueConst.Json,\n                            value: response\n                        });\n                    }\n\n                    //old version\n                    if (Array.isArray(args)) {\n                        const path = args;\n                        let wsk = new JsNode(apiBrowser, apiBrowser.dom.nodes, null);\n\n                        for (const pathItem of path) {\n                            const newWsk = wsk.next(path, pathItem);\n\n                            if (newWsk === null) {\n                                return 0n;\n                            }\n\n                            wsk = newWsk;\n                        }\n\n                        return getWasm().valueSaveToBufferLong(wsk.toValue());\n                    }\n\n                    console.error('dom_access - wrong parameters', args);\n                    return 0n;\n                }\n            }\n        });\n\n        return new WasmModule(wasmModule);\n    }\n}\n","import { WasmModule } from \"./wasm_module\";\n\n// vertigo-cli compatibility version, change together with package version.\nconst VERTIGO_COMPAT_VERSION_MAJOR = 0;\nconst VERTIGO_COMPAT_VERSION_MINOR = 9;\n\nconst moduleRun: Set<string> = new Set();\n\nconst runModule = async (wasm: string) => {\n    if (moduleRun.has(wasm)) {\n        //ok, module is run\n        return;\n    }\n\n    if (moduleRun.size > 0) {\n        console.error('Only one wasm module can be run', { moduleRun, wasm });\n        return;\n    }\n\n    moduleRun.add(wasm);\n\n    console.info(`Wasm module: \"${wasm}\" -> start`);\n    const wasmModule = await WasmModule.create(wasm);\n    console.info(`Wasm module: \"${wasm}\" -> initialized`);\n    wasmModule.vertigo_entry_function(VERTIGO_COMPAT_VERSION_MAJOR, VERTIGO_COMPAT_VERSION_MINOR);\n    console.info(`Wasm module: \"${wasm}\" -> launched vertigo_entry_function with version ${VERTIGO_COMPAT_VERSION_MAJOR}.${VERTIGO_COMPAT_VERSION_MINOR}`);\n};\n\nconst findAndRunModule = async () => {\n    document.querySelectorAll('*[data-vertigo-run-wasm]').forEach((node) => {\n        const wasm = node.getAttribute('data-vertigo-run-wasm');\n\n        if (typeof wasm === 'string') {\n            runModule(wasm);\n        } else {\n            console.error('Run error', node);\n        }\n    });\n};\n\n(() => {\n    window.addEventListener('load', findAndRunModule);\n    setTimeout(findAndRunModule, 3000);\n})();\n"],"names":["JsValueConst","GuardJsValue","isString","value","isStringOrNull","isNumber","type","isBigInt","isJsObject","isJson","assertNever","_value","Error","decoder","TextDecoder","encoder","TextEncoder","BufferCursor","constructor","getUint8Memory","long_ptr","this","pointer","ptr","Number","size","dataView","DataView","buffer","getByte","getUint8","setByte","byte","setUint8","getU16","getUint16","setU16","setUint16","getU32","getUint32","setU32","setUint32","getI32","getInt32","setI32","setInt32","getU64","getBigUint64","setU64","setBigUint64","getI64","getBigInt64","setI64","setBigInt64","getF64","getFloat64","setF64","setFloat64","getBuffer","result","subarray","setBuffer","length","set","getString","decode","setString","encode","getSavedSize","getStringSize","JsJsonConst","jsJsonGetSize","Array","isArray","sum","item","key","propertyValue","Object","entries","jsJsonDecodeItem","cursor","typeParam","out","listSize","i","push","saveJsJsonToBufferItem","list","jsValueDecodeItem","json","console","error","getSize","Uint8Array","saveToBufferItem","undefined","convertFromJsValue","newList","convertToJsValue","BigInt","convertToJsJson","_error","propName","propValue","map","warn","wasmInit","async","wasmBinPath","imports","module_instance","WebAssembly","instantiateStreaming","stream","fetch","err","info","resp","binary","arrayBuffer","instantiate","fetchModule","cacheGetUint8Memory","instance","exports","memory","Memory","decodeArgumentsLong","response","jsValueDecode","vertigo_export_free_block","valueSaveToBufferLong","alloc","savedSize","saveToBufferLongPtr","vertigo_export_alloc_block","wasm_callback","callback_id","value_ptr","result_long_ptr","vertigo_export_wasm_callback","wasm_command","vertigo_export_wasm_command","MapNodes","data","Map","initNodes","get_root_head","childNodes","get_root_body","style","document","createElement","appendChild","get_root_html","documentElement","head","body","id","get_any_option","get","get_any","label","get_node_element","node","HTMLElement","get_node","Element","get_text","Text","get_comment","Comment","delete","insert_css","selector","content","createTextNode","removeInitNodes","remove","insert_before","parent","child","ref_id","parentNode","childNode","insertBefore","ref_node","DriverDom","appLocation","getWasm","dom_bulk_update","commands","setFocus","Set","command","bulk_update_command","name","toLocaleLowerCase","add","setTimeout","nodes","focus","callbacks","addEventListener","ev","preventDefault","debugNodes","ids","create_node","createElementNS","toLowerCase","trim","e","href","getAttribute","startsWith","window","scrollTo","set_attribute","setAttribute","HTMLInputElement","HTMLTextAreaElement","defaultValue","remove_attribute","removeAttribute","remove_node","create_text","text","remove_text","update_text","textContent","callback_click","event","click_event","stopPropagation","callback_submit","callback_input","target","callback_change","HTMLSelectElement","callback_blur","_event","callback_mousedown","callback_mouseup","callback_mouseenter","callback_mouseleave","callback_drop","DragEvent","dataTransfer","files","items","file","getAsFile","then","Promise","all","params","catch","callback_keydown","KeyboardEvent","code","altKey","ctrlKey","shiftKey","metaKey","callback_load","callback_add","event_name","callback","has","callback_remove","removeEventListener","comment","createComment","assertNeverCommand","ApiBrowser","dom","JsNode","api","wsk","getByProperty","path","property","nextCurrentPointer","toValue","next","commandName","args","nextApi","nextRoot","nextGet","nextSet","nextCall","nextGetProps","firstName","rest","domId","getArgs","setArgs","callArgs","paramsJs","EventEmitter","events","on","isActive","onExec","param","trigger","eventsCopy","from","values","itemCallbackToRun","PromiseBoxRace","promiseResolveReject","resolve","reject","isFulfilled","promise","localResolve","localReject","createPromiseValue","reconnectDelay","timeout_retry","timeout","LogContext","host","formatLog","message","SocketConnection","close","send","eventMessage","connect","log","done","socket","WebSocket","isClose","closeSocket","socketConnection","dataRaw","startSocket","timeout_connection","onMessage","isConnect","openSocketResult","dispose","wasmCallback","wasm","callbackId","Websocket","DriverWebsocket","websocket_register_callback","controller","controllerList","assertNeverMessage","Message","websocket_unregister_callback","websocket_send_message","getHeaders","headers","k","v","getBodyString","JSON","stringify","Data","fetchExec","request","url","method","response2","status","contentType","Ok","Json","String","processResponse","FetchExecResponse","responseToWasm","toString","Interval","timerSet","duration","kind","timerId","setInterval","TimerCall","timerClear","timerResource","clearInterval","clearTimeout","Cookies","cname","cookie","split","cookieChunk","cookieName","cookieValue","decodeURIComponent","get_json","cvalue_str","parse","cvalue","expires_in","cvalueEncoded","encodeURIComponent","d","Date","setTime","getTime","expires","toUTCString","set_json","getRandom","min","max","range","Math","floor","random","ExecCommand","location","websocket","interval","exec","arg","safeArg","getElementById","now","getTimezoneOffset","history","back","FetchExec","WebsocketRegister","WebsocketSendMessage","WebsocketUnregister","TimerSet","TimerClear","LocationGet","LocationCallback","mode","LocationSet","CookieGet","CookieSet","CookieJsonGet","CookieJsonSet","GetEnv","ConsoleLog","arg2","arg3","arg4","debug","GetRandom","HashRouter","LocationCall","new_hash","hash","replace","replaceState","substr","HistoryLocation","pushState","pathname","search","AppLocation","locations","newValue","Hash","History","WasmModule","vertigo_entry_function","major","minor","create","wasmModule","apiBrowser","execCommand","$vertigoApi","mod","panic_message","m","dom_access","pathItem","newWsk","moduleRun","findAndRunModule","querySelectorAll","forEach","runModule"],"mappings":"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"}