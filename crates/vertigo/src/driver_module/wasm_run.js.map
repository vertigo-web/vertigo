{"version":3,"file":"wasm_run.js","sources":["src_js/buffer_cursor.ts","src_js/jsjson.ts","src_js/wasm_init.ts","src_js/exec_command/websocket/event_emiter.ts","src_js/exec_command/websocket/promise.ts","src_js/exec_command/websocket/connection.ts","src_js/exec_command/websocket/websocket.ts","src_js/assert_never.ts","src_js/exec_command/command/fetchExec.ts","src_js/exec_command/command/interval.ts","src_js/exec_command/location/hashrouter.ts","src_js/exec_command/location/historyLocation.ts","src_js/exec_command/location/AppLocation.ts","src_js/exec_command/command/cookies.ts","src_js/exec_command/command/getRandom.ts","src_js/exec_command/command/dom/map_nodes.ts","src_js/exec_command/command/dom/injects.ts","src_js/exec_command/command/dom/hydration.ts","src_js/exec_command/command/dom/featureHydration.ts","src_js/exec_command/command/dom/dom.ts","src_js/exec_command/exec_command.ts","src_js/exec_command/command/fetchCacheGet.ts","src_js/wasm_module.ts","src_js/index.ts"],"sourcesContent":["///https://javascript.info/arraybuffer-binary-arrays#dataview\n\nconst decoder = new TextDecoder(\"utf-8\");\nconst encoder = new TextEncoder();\n\nexport class BufferCursor {\n    private dataView: DataView;\n    private pointer: number = 0;\n    private ptr: number;\n    private size: number;\n\n    constructor(\n        private getUint8Memory: () => Uint8Array,\n        long_ptr: bigint,\n    ) {\n        this.ptr = Number(long_ptr >> 32n);\n        this.size = Number(long_ptr % (2n ** 32n));\n\n        this.dataView = new DataView(\n            this.getUint8Memory().buffer,\n            this.ptr,\n            this.size\n        );\n    }\n\n    public getByte(): number {\n        const value = this.dataView.getUint8(this.pointer);\n        this.pointer += 1;\n        return value;\n    }\n\n    public setByte(byte: number) {\n        this.dataView.setUint8(this.pointer, byte);\n        this.pointer += 1;\n    }\n\n    public getU16(): number {\n        const value = this.dataView.getUint16(this.pointer);\n        this.pointer += 2;\n        return value;\n    }\n\n    public setU16(value: number) {\n        this.dataView.setUint16(this.pointer, value);\n        this.pointer += 2;\n    }\n\n    public getU32(): number {\n        const value = this.dataView.getUint32(this.pointer);\n        this.pointer += 4;\n        return value;\n    }\n\n    public setU32(value: number) {\n        this.dataView.setUint32(this.pointer, value);\n        this.pointer += 4;\n    }\n\n    public getI32(): number {\n        const value = this.dataView.getInt32(this.pointer);\n        this.pointer += 4;\n        return value;\n    }\n\n    public setI32(value: number) {\n        this.dataView.setInt32(this.pointer, value);\n        this.pointer += 4;\n    }\n\n    public getU64(): bigint {\n        const value = this.dataView.getBigUint64(this.pointer);\n        this.pointer += 8;\n        return value;\n    }\n\n    public setU64(value: bigint) {\n        this.dataView.setBigUint64(this.pointer, value);\n        this.pointer += 8;\n    }\n\n    public getI64(): bigint {\n        const value = this.dataView.getBigInt64(this.pointer);\n        this.pointer += 8;\n        return value;\n    }\n\n    public setI64(value: bigint) {\n        this.dataView.setBigInt64(this.pointer, value);\n        this.pointer += 8;\n    }\n\n    public getF64(): number {\n        const value = this.dataView.getFloat64(this.pointer);\n        this.pointer += 8;\n        return value;\n    }\n\n    public setF64(value: number) {\n        this.dataView.setFloat64(this.pointer, value);\n        this.pointer += 8;\n    }\n\n    public getBuffer(): Uint8Array {\n        const size = this.getU32();\n        const result = this\n            .getUint8Memory()\n            .subarray(\n                this.ptr + this.pointer,\n                this.ptr + this.pointer + size\n            );\n\n        this.pointer += size;\n        return result;\n    }\n\n    public setBuffer(buffer: Uint8Array) {\n        const size = buffer.length;\n        this.setU32(size);\n\n        const sub_buffer = this\n            .getUint8Memory()\n            .subarray(\n                this.ptr + this.pointer,\n                this.ptr + this.pointer + size\n            );\n\n        sub_buffer.set(buffer);\n\n        this.pointer += size;\n    }\n\n    public getString(): string {\n        return decoder.decode(this.getBuffer());\n    }\n\n    public setString(value: string) {\n        const buffer = encoder.encode(value);\n        this.setBuffer(buffer);\n    }\n\n    public getSavedSize(): number {\n        return this.pointer;\n    }\n}\n\nexport const getStringSize = (value: string): number => {\n    return new TextEncoder().encode(value).length;\n};\n\n","import { BufferCursor } from \"./buffer_cursor\";\n\nconst JsJsonConst = {\n    True: 1,\n    False: 2,\n    Null: 3,\n    Undefined: 4,\n    String: 5,\n    Number: 6,\n    List: 7,\n    Object: 8,\n    Vec: 9,\n} as const;\n\nexport type JsJsonType = boolean | null | undefined | string | number | Uint8Array | Array<JsJsonType> | { [key: string]: JsJsonType };\n\nexport const jsJsonGetSize = (value: JsJsonType): number => {\n    if (value === true || value === false || value === null || value === undefined) {\n        return 1;\n    }\n\n    if (typeof value === 'string') {\n        return 1 + 4 + new TextEncoder().encode(value).length;\n    }\n\n    if (typeof value === 'number') {\n        return 1 + 8;\n    }\n\n    if (value instanceof Uint8Array) {\n        return 1 + 4 + value.length;\n    }\n\n    if (Array.isArray(value)) {\n        let sum = 1 + 4;\n        for (const item of value) {\n            sum += jsJsonGetSize(item);\n        }\n        return sum;\n    }\n\n    if (typeof value === 'object' && value !== null) {\n        let sum = 1 + 2;\n        for (const [key, propertyValue] of Object.entries(value)) {\n            sum += 4 + new TextEncoder().encode(key).length;\n            sum += jsJsonGetSize(propertyValue);\n        }\n        return sum;\n    }\n\n    throw new Error(`jsJsonGetSize: Unknown type ${typeof value}`);\n};\n\nexport const jsJsonDecodeItem = (buffer: BufferCursor): JsJsonType => {\n    const typeId = buffer.getByte();\n\n    if (typeId === JsJsonConst.True) {\n        return true;\n    }\n\n    if (typeId === JsJsonConst.False) {\n        return false;\n    }\n\n    if (typeId === JsJsonConst.Null) {\n        return null;\n    }\n\n    if (typeId === JsJsonConst.Undefined) {\n        return undefined;\n    }\n\n    if (typeId === JsJsonConst.String) {\n        return buffer.getString();\n    }\n\n    if (typeId === JsJsonConst.Number) {\n        return buffer.getF64();\n    }\n\n    if (typeId === JsJsonConst.List) {\n        const count = buffer.getU32();\n        const list: Array<JsJsonType> = [];\n\n        for (let i = 0; i < count; i++) {\n            list.push(jsJsonDecodeItem(buffer));\n        }\n\n        return list;\n    }\n\n    if (typeId === JsJsonConst.Object) {\n        const count = buffer.getU16();\n        const obj: { [key: string]: JsJsonType } = {};\n\n        for (let i = 0; i < count; i++) {\n            const key = buffer.getString();\n            const value = jsJsonDecodeItem(buffer);\n            obj[key] = value;\n        }\n\n        return obj;\n    }\n\n    if (typeId === JsJsonConst.Vec) {\n        return buffer.getBuffer();\n    }\n\n    throw new Error(`jsJsonDecodeItem: Unknown type id ${typeId}`);\n};\n\nexport const saveJsJsonToBufferItem = (value: JsJsonType, buffer: BufferCursor): void => {\n    if (value === true) {\n        buffer.setByte(JsJsonConst.True);\n        return;\n    }\n\n    if (value === false) {\n        buffer.setByte(JsJsonConst.False);\n        return;\n    }\n\n    if (value === null) {\n        buffer.setByte(JsJsonConst.Null);\n        return;\n    }\n\n    if (value === undefined) {\n        buffer.setByte(JsJsonConst.Undefined);\n        return;\n    }\n\n    if (typeof value === 'string') {\n        buffer.setByte(JsJsonConst.String);\n        buffer.setString(value);\n        return;\n    }\n\n    if (typeof value === 'number') {\n        buffer.setByte(JsJsonConst.Number);\n        buffer.setF64(value);\n        return;\n    }\n\n    if (value instanceof Uint8Array) {\n        buffer.setByte(JsJsonConst.Vec);\n        buffer.setBuffer(value);\n        return;\n    }\n\n    if (Array.isArray(value)) {\n        buffer.setByte(JsJsonConst.List);\n        buffer.setU32(value.length);\n\n        for (const item of value) {\n            saveJsJsonToBufferItem(item, buffer);\n        }\n\n        return;\n    }\n\n    if (typeof value === 'object' && value !== null) {\n        const entries = Object.entries(value);\n\n        buffer.setByte(JsJsonConst.Object);\n        buffer.setU16(entries.length);\n\n        for (const [key, propertyValue] of entries) {\n            buffer.setString(key);\n            saveJsJsonToBufferItem(propertyValue, buffer);\n        }\n\n        return;\n    }\n\n    throw new Error(`saveJsJsonToBufferItem: Unknown type ${typeof value}`);\n};\n","import { BufferCursor } from './buffer_cursor';\nimport { jsJsonGetSize, jsJsonDecodeItem, saveJsJsonToBufferItem, JsJsonType } from './jsjson';\n\nexport interface BaseExportType {\n    vertigo_export_alloc_block: (size: number) => bigint,\n    vertigo_export_free_block: (pointer: bigint) => void,\n    vertigo_export_wasm_command: (value_ptr: bigint) => bigint,\n};\n\nexport interface ModuleControllerType<ExportType extends BaseExportType> {\n    exports: ExportType,\n    getUint8Memory: () => Uint8Array,\n    wasm_command: (params: JsJsonType) => JsJsonType,\n}\n\nconst fetchModule = async (wasmBinPath: string, imports: Record<string, WebAssembly.ModuleImports>): Promise<WebAssembly.WebAssemblyInstantiatedSource> => {\n    if (typeof WebAssembly.instantiateStreaming === 'function') {\n        const stream = fetch(wasmBinPath);\n        try {\n            const module = await WebAssembly.instantiateStreaming(stream, imports);\n            return module;\n        } catch (err) {\n            console.warn(\"`WebAssembly.instantiateStreaming` failed. This could happen if your server does not serve wasm with `application/wasm` MIME type, but check the original error too. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", err);\n        }\n    }\n\n    console.info('fetchModule by WebAssembly.instantiate');\n\n    const resp = await fetch(wasmBinPath);\n    const binary = await resp.arrayBuffer();\n    const module_instance = await WebAssembly.instantiate(binary, imports);\n    return module_instance;\n};\n\nexport const wasmInit = async <ImportType extends Record<string, Function>, ExportType extends BaseExportType>(\n    wasmBinPath: string,\n    imports: { mod: ImportType },\n): Promise<ModuleControllerType<ExportType>> => {\n    const module_instance = await fetchModule(wasmBinPath, imports);\n\n    let cacheGetUint8Memory: Uint8Array = new Uint8Array(1);\n\n    const getUint8Memory = () => {\n        if (module_instance.instance.exports.memory instanceof WebAssembly.Memory) {\n            if (cacheGetUint8Memory.buffer !== module_instance.instance.exports.memory.buffer) {\n                cacheGetUint8Memory = new Uint8Array(module_instance.instance.exports.memory.buffer);\n            }\n            return cacheGetUint8Memory;\n        } else {\n            throw Error('Missing memory');\n        }\n    };\n\n    //@ts-expect-error\n    const exports: ExportType = module_instance.instance.exports;\n\n    const wasm_command = (value: JsJsonType): JsJsonType => {\n        // Serialize JsJson\n        const size = jsJsonGetSize(value);\n        const long_ptr = exports.vertigo_export_alloc_block(size);\n        const buffer = new BufferCursor(getUint8Memory, long_ptr);\n        saveJsJsonToBufferItem(value, buffer);\n\n        let result_long_ptr = exports.vertigo_export_wasm_command(long_ptr);\n\n        // Decode JsJson\n        if (result_long_ptr === 0n) {\n            return null;\n        }\n        const resultBuffer = new BufferCursor(getUint8Memory, result_long_ptr);\n        const result = jsJsonDecodeItem(resultBuffer);\n        exports.vertigo_export_free_block(result_long_ptr);\n\n        return result;\n    };\n\n\n    return {\n        exports,\n        getUint8Memory,\n        wasm_command,\n    };\n};\n","export class EventEmitter<T> {\n    private events: Set<(param: T) => void>;\n\n    constructor() {\n        this.events = new Set()\n    }\n\n    on(callback: (param: T) => void) {\n        let isActive = true;\n\n        const onExec = (param: T) => {\n            if (isActive) {\n                callback(param);\n            }\n        };\n\n        this.events.add(onExec);\n\n        return () => {\n            isActive = false;\n            this.events.delete(onExec);\n        };\n    }\n\n    trigger(param: T) {\n        const eventsCopy = Array.from(this.events.values())\n\n        for (const itemCallbackToRun of eventsCopy) {\n            try {\n                itemCallbackToRun(param);\n            } catch (err) {\n                console.error(err);\n            }\n        }\n    }\n\n    get size(): number {\n        return this.events.size;\n    }\n}\n","type ResolveFn<T> = (data: T) => void;\ntype RejectFn = (err: unknown) => void;\n\ninterface PromiseResolveReject<T> {\n    readonly resolve: (value: T) => void,\n    readonly reject: (err: unknown) => void,\n};\n\nconst createPromiseValue = <T>(): [PromiseResolveReject<T>, Promise<T>] => {\n    let resolve: ResolveFn<T> | null = null;\n    let reject: RejectFn | null = null;\n\n    const promise: Promise<T> = new Promise((localResolve: ResolveFn<T>, localReject: RejectFn) => {\n        resolve = localResolve;\n        reject = localReject;\n    });\n\n    if (resolve === null) {\n        throw Error('createPromiseValue - resolve is null');\n    }\n\n    if (reject === null) {\n        throw Error('createPromiseValue - reject is null');\n    }\n\n    const promiseValue = {\n        resolve,\n        reject,\n    };\n\n    return [promiseValue, promise];\n};\n\nexport class PromiseBoxRace<T> {\n    private promiseResolveReject: PromiseResolveReject<T> | null = null;\n    readonly promise: Promise<T>;\n\n    constructor() {\n        const [promiseResolveReject, promise] = createPromiseValue<T>();\n\n        this.promiseResolveReject = promiseResolveReject;\n        this.promise = promise;\n    }\n\n    resolve = (value: T) => {\n        const promiseResolveReject = this.promiseResolveReject;\n        this.promiseResolveReject = null;\n\n        if (promiseResolveReject === null) {\n            return;\n        }\n\n        promiseResolveReject.resolve(value);\n    }\n\n    reject = (err?: unknown) => {\n        const promiseResolveReject = this.promiseResolveReject;\n        this.promiseResolveReject = null;\n\n        if (promiseResolveReject === null) {\n            return;\n        }\n\n        promiseResolveReject.reject(err);\n    }\n\n    isFulfilled = (): boolean => {\n        return this.promiseResolveReject === null;\n    }\n}\n","import { EventEmitter } from \"./event_emiter\";\nimport { PromiseBoxRace } from \"./promise\";\n\nconst timeout = async (timeout: number): Promise<void> => {\n    return new Promise((resolve: (data: void) => void) => {\n        setTimeout(resolve, timeout);\n    });\n};\n\n\nconst reconnectDelay = async (label: string, timeout_retry: number): Promise<void> => {\n    console.info(`${label} wait ${timeout_retry}ms`);\n    await timeout(timeout_retry);\n    console.info(`${label} go forth`);\n};\n\nexport type SocketEventType = {\n    type: 'message',\n    message: string,\n} | {\n    type: 'socket',\n    socket: SocketConnection\n} | {\n    type: 'close',\n};\n\nexport type OnMessageType = (message: SocketEventType) => void;\nexport type UnsubscribeFnType = () => void;\n\ninterface OpenSocketResult {\n    socket: Promise<SocketConnection | null>,\n    done: Promise<void>,\n}\n\nexport interface SocketConnectionController {\n    send: (message: string) => void,\n    dispose: UnsubscribeFnType\n}\n\nclass LogContext {\n    public constructor(private host: string) {}\n    public formatLog = (message: string): string => `Socket ${this.host} ==> ${message}`;\n}\nexport class SocketConnection {\n    private readonly eventMessage: EventEmitter<string>;\n    public readonly close: () => void;\n    public readonly send: (message: string) => void;\n\n    private constructor(\n        close: () => void,\n        send: (message: string) => void,\n    ) {\n        this.eventMessage = new EventEmitter();\n        this.close = close;\n        this.send = send;\n    }\n\n    private static connect(\n        log: LogContext,\n        host: string,\n        timeout: number,\n    ): OpenSocketResult {\n        const result = new PromiseBoxRace<SocketConnection | null>();\n        const done = new PromiseBoxRace<void>();\n        const socket = new WebSocket(host);\n        let isClose: boolean = false;\n\n        console.info(log.formatLog('starting ...'));\n\n        const closeSocket = (): void => {\n            if (isClose) {\n                return;\n            }\n\n            console.info(log.formatLog('close'));\n\n            isClose = true;\n            result.resolve(null);\n            done.resolve();\n            socket.close();\n        };\n\n\n        const socketConnection = new SocketConnection(\n            closeSocket,\n            (message: string) => {\n                if (isClose) {\n                    return;\n                }\n                socket.send(message);\n            }\n        );\n\n        setTimeout(() => {\n            if (result.isFulfilled() === false) {\n                console.error(log.formatLog(`timeout (${timeout}ms)`));\n                closeSocket();\n            }\n        }, timeout);\n\n        const onOpen = (): void => {\n            console.info(log.formatLog('open'));\n            result.resolve(socketConnection);\n        };\n\n        const onError = (error: Event): void => {\n            console.error(log.formatLog('error'), error);\n            closeSocket();\n        };\n\n        const onMessage = (event: MessageEvent): void => {\n            if (isClose) {\n                return;\n            }\n\n            const dataRaw = event.data;\n\n            if (typeof dataRaw === 'string') {\n                socketConnection.eventMessage.trigger(dataRaw);\n                return;\n            }\n\n            console.error(log.formatLog('onMessage - expected string'), dataRaw);\n        };\n\n        socket.addEventListener('open', onOpen);\n        socket.addEventListener('error', onError);\n        socket.addEventListener('close', closeSocket);\n        socket.addEventListener('message', onMessage);\n\n        return {\n            socket: result.promise,\n            done: done.promise\n        };\n    }\n\n    public static startSocket(\n        host: string,\n        timeout_connection: number,\n        timeout_retry: number,\n        onMessage: OnMessageType,\n    ): SocketConnectionController {\n        let isConnect: boolean = true;\n        let socketConnection: SocketConnection | null = null;\n\n        const log = new LogContext(host);\n\n        (async (): Promise<void> => {\n            while (isConnect) {\n                const openSocketResult = SocketConnection.connect(log, host, timeout_connection);\n\n                const socket = await openSocketResult.socket;\n\n                if (socket === null) {\n                    await reconnectDelay(log.formatLog('reconnect after error'), timeout_retry);\n                    continue;\n                }\n\n                socketConnection = socket;\n                onMessage({\n                    type: 'socket',\n                    socket\n                });\n\n                socket.eventMessage.on(message => {\n                    onMessage({\n                        type: 'message',\n                        message\n                    });\n                });\n\n                await openSocketResult.done;\n\n                onMessage({\n                    type: 'close'\n                });\n\n                if (!isConnect) {\n                    console.info(log.formatLog('disconnect (1)'));\n                    return;\n                }\n\n                await reconnectDelay(log.formatLog('reconnect after close'), timeout_retry);\n            }\n\n            console.info(log.formatLog('disconnect (2)'));\n        })().catch((error) => {\n            console.error(error);\n        });\n\n        return {\n            send: (message: string): void => {\n                if (socketConnection === null) {\n                    console.error('send fail - missing connection', message);\n                } else {\n                    socketConnection.send(message);\n                }\n            },\n            dispose: (): void => {\n                isConnect = false;\n                socketConnection?.close();\n            }\n        };\n    }\n}\n","import { ModuleControllerType } from \"../../wasm_init\";\nimport { ExportType } from \"../../wasm_module\";\nimport { CallbackId } from \"../types\";\nimport { SocketConnection, SocketConnectionController } from \"./connection\";\n\n\nconst assertNeverMessage = (data: never): never => {\n    console.error(data);\n    throw Error('unknown message');\n};\n\ntype CommandType = 'Connected' | 'Disconnected' | {\n    'Message': {\n        message: string,\n    }\n}\nconst wasmCallback = (wasm: ModuleControllerType<ExportType>, callbackId: CallbackId, command: CommandType) => {\n    wasm.wasm_command({\n        'Websocket': {\n            callback: callbackId,\n            message: command,\n        }\n    })\n};\n\n\nexport class DriverWebsocket {\n    private getWasm: () => ModuleControllerType<ExportType>;\n    private readonly controllerList: Map<CallbackId, SocketConnectionController>;\n    private readonly socket: Map<CallbackId, SocketConnection>;\n\n    constructor(getWasm: () => ModuleControllerType<ExportType>) {\n        this.getWasm = getWasm;\n        this.controllerList = new Map();\n        this.socket = new Map();\n    }\n\n    public websocket_register_callback = (\n        host: string,\n        callback_id: CallbackId,\n    ) => {\n        const wasm = this.getWasm();\n\n        let controller = SocketConnection.startSocket(\n            host,\n            5000,                   //timeout connection\n            3000,                   //timeout reconnection\n            (message) => {\n\n                if (this.controllerList.has(callback_id) === false) {\n                    return;\n                }\n\n                if (message.type === 'socket') {\n                    this.socket.set(callback_id, message.socket);\n                    wasmCallback(wasm, callback_id, 'Connected');\n                    return;\n                }\n\n                if (message.type === 'message') {\n                    wasmCallback(wasm, callback_id, {\n                        'Message': {\n                            message: message.message\n                        }\n                    });\n                    return;\n                }\n\n                if (message.type === 'close') {\n                    this.socket.delete(callback_id);\n                    wasmCallback(wasm, callback_id, 'Disconnected');\n                    return;\n                }\n\n                return assertNeverMessage(message);\n            }\n        );\n\n        this.controllerList.set(callback_id, controller);\n    }\n\n    public websocket_unregister_callback = (callback_id: CallbackId) => {\n        const controller = this.controllerList.get(callback_id);\n\n        if (controller === undefined) {\n            console.error('Expected controller');\n            return;\n        }\n\n        controller.dispose();\n        this.controllerList.delete(callback_id);\n    }\n\n    public websocket_send_message = (\n        callback_id: CallbackId,\n        message: string,\n    ) => {\n        const socket = this.socket.get(callback_id);\n\n        if (socket === undefined) {\n            console.error(`Missing socket connection for callback_id=${callback_id}`);\n        } else {\n            socket.send(message);\n        }\n    }\n}\n","\nexport const assertNever = (_value: never) => {\n    throw Error(\"assert never\");\n}\n","import { JsJsonType } from \"../../jsjson\";\nimport { ModuleControllerType } from \"../../wasm_init\";\nimport { ExportType } from \"../../wasm_module\";\nimport { CallbackId } from \"../types\";\n\nexport interface FetchRequestType {\n    method: string,\n    url: string,\n    headers: Array<{ k: string, v: string }>,\n    body: 'None' | {\n        Data: {\n            data: JsJsonType\n        }\n    }\n}\n\ntype FetchResponseType = {\n    Ok: {\n        status: number,\n        response: {\n            Text: string\n         } | {\n            Json: JsJsonType,\n         }\n    }\n} | {\n    Error: {\n        message: string,\n    }\n};\n\nconst getHeaders = (headers: Array<{ k: string, v: string }>): Record<string, string> => {\n    const result: Record<string, string> = {};\n\n    for (const { k, v } of headers) {\n        result[k] = v;\n    }\n\n    return result;\n};\n\nconst getBodyString = (body: FetchRequestType['body']): string | undefined => {\n    if (body === 'None') {\n        return undefined;\n    }\n\n    return JSON.stringify(body.Data.data);\n};\n\nconst processResponse = async (response: Response): Promise<FetchResponseType> => {\n    const status = response.status;\n    const contentType = response.headers.get(\"Content-Type\");\n\n    try {\n        if (contentType?.startsWith('text/plain;')) {\n            return {\n                Ok:  {\n                    status,\n                    response: {\n                        Text: await response.text(),\n                    }\n                }\n            }\n        }\n\n        return {\n            Ok: {\n                status,\n                response: {\n                    Json: await response.json()\n                }\n            }\n        };\n    } catch (error) {\n        return {\n            Error: {\n                message: String(error),\n            }\n        };\n    }\n};\n\n\nexport const fetchExec = async (\n    getWasm: () => ModuleControllerType<ExportType>,\n    callback_id: CallbackId,\n    request: FetchRequestType\n): Promise<void> => {\n    const wasm = getWasm();\n\n    console.info('fetch request', request);\n\n    try {\n        const response = await fetch(request.url, {\n            method: request.method,\n            headers: getHeaders(request.headers),\n            body: getBodyString(request.body),\n        });\n\n        const response2 = await processResponse(response);\n\n        wasm.wasm_command({\n            'FetchExecResponse': {\n                response: response2,\n                callback: Number(callback_id),\n            }\n        });\n\n    } catch (err) {\n        console.error('fetch error (1)', err);\n        const responseMessage = new String(err).toString();\n\n        const responseToWasm: FetchResponseType = {\n            'Error': {\n                message: responseMessage\n            }\n        };\n\n        wasm.wasm_command({\n            'FetchExecResponse': {\n                response: responseToWasm,\n                callback: Number(callback_id),\n            }\n        });\n    }\n};\n\n\n","import { CallbackId } from \"../types\";\nimport { ModuleControllerType } from \"../../wasm_init\";\nimport { ExportType } from \"../../wasm_module\";\n\ntype TimerResourceId = ReturnType<typeof setTimeout>;\n\ninterface TimerId {\n    kind: 'Interval' | 'Timeout',\n    timerId: TimerResourceId,\n}\n\nexport class Interval {\n    private readonly getWasm: () => ModuleControllerType<ExportType>;\n    private readonly data: Map<CallbackId, TimerId>;\n\n    constructor(getWasm: () => ModuleControllerType<ExportType>) {\n        this.getWasm = getWasm;\n        this.data = new Map();\n    }\n\n    timerSet = (callback: CallbackId, duration: number, kind: 'Interval' | 'Timeout') => {\n        switch (kind) {\n            case 'Interval': {\n                const timerId = setInterval(() => {\n                    this.getWasm().wasm_command({\n                        'TimerCall': {\n                            callback,\n                        },\n                    })\n                }, duration);\n\n                this.data.set(callback, {\n                    kind: 'Interval',\n                    timerId,\n                });\n                break;\n            }\n            case 'Timeout': {\n                const timerId = setTimeout(() => {\n                    this.getWasm().wasm_command({\n                        'TimerCall': {\n                            callback,\n                        },\n                    })\n                }, duration);\n\n                this.data.set(callback, {\n                    kind: 'Timeout',\n                    timerId,\n                });\n                break;\n            }\n        }\n    }\n\n    timerClear = (callback: CallbackId) => {\n        const timerResource = this.data.get(callback);\n\n        if (timerResource === undefined) {\n            throw Error('panic');\n        }\n\n        switch (timerResource.kind) {\n            case 'Interval': {\n                clearInterval(timerResource.timerId);\n                break;\n            }\n            case 'Timeout': {\n                clearTimeout(timerResource.timerId);\n                break;\n            }\n        }\n    }\n}\n","import { ModuleControllerType } from \"../../wasm_init\";\nimport { ExportType } from \"../../wasm_module\";\nimport { CallbackId } from \"../types\";\nimport { LocationCommonType } from \"./types\";\n\nexport class HashRouter implements LocationCommonType {\n    private getWasm: () => ModuleControllerType<ExportType>;\n    private callback: Map<CallbackId, () => void>;\n\n    constructor(getWasm: () => ModuleControllerType<ExportType>) {\n        this.getWasm = getWasm;\n        this.callback = new Map();\n\n        window.addEventListener(\"hashchange\", this.trigger);\n    }\n\n    private trigger = () => {\n        for (const callback of Array.from(this.callback.values())) {\n            callback();\n        }\n    }\n\n    public add = (callback_id: CallbackId) => {\n        this.callback.set(callback_id, () => {\n            this.getWasm().wasm_command({\n                LocationCall: {\n                    callback: callback_id,\n                    value: this.get(),\n                }\n            });\n        });\n    }\n\n    public remove = (callback_id: CallbackId) => {\n        this.callback.delete(callback_id);\n    }\n\n    public push = (new_hash: string) => {\n        if (this.get() === new_hash) {\n            return;\n        }\n\n        location.hash = new_hash;\n        this.trigger();\n    }\n\n    public replace = (new_hash: string) => {\n        if (this.get() === new_hash) {\n            return;\n        }\n\n        history.replaceState(null, '', `#${new_hash}`);\n    }\n\n    public get(): string {\n        return decodeURIComponent(location.hash.substr(1));\n    }\n}\n","import { ModuleControllerType } from \"../../wasm_init\";\nimport { ExportType } from \"../../wasm_module\";\nimport { CallbackId } from \"../types\";\nimport { LocationCommonType } from \"./types\";\n\nexport class HistoryLocation implements LocationCommonType {\n    private getWasm: () => ModuleControllerType<ExportType>;\n    private callback: Map<CallbackId, () => void>;\n\n    constructor(getWasm: () => ModuleControllerType<ExportType>) {\n        this.getWasm = getWasm;\n        this.callback = new Map();\n\n        window.addEventListener(\"popstate\", this.trigger);\n    }\n\n    private trigger = () => {\n        for (const callback of Array.from(this.callback.values())) {\n            callback();\n        }\n    }\n\n    public add = (callback_id: CallbackId) => {\n        this.callback.set(callback_id, () => {\n            this.getWasm().wasm_command({\n                LocationCall: {\n                    callback: callback_id,\n                    value: this.get(),\n                }\n            });\n        });\n    }\n\n    public remove = (callback_id: CallbackId) => {\n        this.callback.delete(callback_id);\n    }\n\n    public push = (url: string) => {\n        if (this.get() === url) {\n            return;\n        }\n\n        window.history.pushState(null, '', url);\n        this.trigger();\n    }\n\n    public replace = (url: string) => {\n        if (this.get() === url) {\n            return;\n        }\n\n        window.history.replaceState(null, '', url);\n        this.trigger();\n    }\n\n    public get(): string {\n        return window.location.pathname + window.location.search + window.location.hash;\n    }\n}\n","import { ModuleControllerType } from \"../../wasm_init\";\nimport { ExportType } from \"../../wasm_module\";\nimport { CallbackId } from \"../types\";\nimport { HashRouter } from \"./hashrouter\";\nimport { HistoryLocation } from \"./historyLocation\";\nimport { LocationCommonType } from \"./types\";\n\ntype LocationTarget = 'Hash' | 'History';\n\nexport class AppLocation {\n    private readonly locations: Record<LocationTarget, LocationCommonType>;\n\n    constructor(getWasm: () => ModuleControllerType<ExportType>) {\n        this.locations = {\n            Hash: new HashRouter(getWasm),\n            History: new HistoryLocation(getWasm),\n        };\n    }\n    \n    callback = (target: LocationTarget, mode: 'Add' | 'Remove', callbackId: CallbackId) => {\n        switch (mode) {\n            case 'Add': {\n                this.locations[target].add(callbackId);\n                return;\n            }\n            case 'Remove': {\n                this.locations[target].remove(callbackId);\n                return;\n            }\n        }\n    }\n\n    set = (target: LocationTarget, mode: 'Push' | 'Replace', newValue: string) => {\n        switch (mode) {\n            case 'Push': {\n                this.locations[target].push(newValue);\n                return;\n            }\n            case 'Replace': {\n                 this.locations[target].replace(newValue);\n                 return;\n            }\n        }\n    }\n\n    get = (target: LocationTarget): string => {\n        return this.locations[target].get();\n    }\n}","import { JsJsonType } from \"../../jsjson\";\n\nexport class Cookies {\n    public get = (cname: string): string => {\n        for (const cookie of document.cookie.split(';')) {\n            if (cookie === \"\") continue;\n\n            const cookieChunk = cookie.trim().split('=');\n\n            if (cookieChunk.length !== 2) {\n                console.warn(`Cookies.get: Incorrect number of cookieChunk => ${cookieChunk.length} in ${cookie}`);\n                continue;\n            }\n\n            const cookieName = cookieChunk[0];\n            const cookieValue = cookieChunk[1];\n\n            if (cookieName === undefined || cookieValue === undefined) {\n                console.warn(`Cookies.get: Broken cookie part => ${cookie}`);\n                continue;\n            }\n\n            if (cookieName === cname) {\n                return decodeURIComponent(cookieValue);\n            }\n        }\n\n        return '';\n    }\n\n    public get_json = (cname: string): JsJsonType => {\n        let cvalue_str = this.get(cname);\n\n        if (cvalue_str.length !== 0) {\n            try {\n                let cookie_value = JSON.parse(cvalue_str);\n                return cookie_value;\n            } catch (e) {\n                console.error!(\"Error deserializing cookie\", e);\n            }\n        }\n        return null\n    }\n\n    public set = (\n        cname: string,\n        cvalue: string,\n        expires_in: number,\n    ) => {\n        const cvalueEncoded = cvalue == null ? \"\" : encodeURIComponent(cvalue);\n\n        const d = new Date();\n        d.setTime(d.getTime() + (expires_in * 1000));\n        let expires = \"expires=\"+ d.toUTCString();\n\n        document.cookie = `${cname}=${cvalueEncoded};${expires};path=/;samesite=strict\"`;\n    }\n\n    public set_json = (\n        cname: string,\n        cvalue: JsJsonType,\n        expires_in: number,\n    ) => {\n        let cvalue_str = JSON.stringify(cvalue);\n\n        this.set(cname, cvalue_str, expires_in);\n    }\n}\n","export const getRandom = (min: number, max: number): number => {\n    const range = max - min + 1;\n    let result = Math.floor(Math.random() * range);\n    return min + result;\n};\n\n","type NodeType = Element | Comment | Text;\nexport class MapNodes {\n    private data: Map<number, NodeType>;\n    private initNodes: Array<ChildNode> | null;\n    private style: HTMLStyleElement;\n\n    constructor() {\n        this.data = new Map();\n\n        this.initNodes = [\n            ...this.get_root_head().childNodes,\n            ...this.get_root_body().childNodes,\n        ];\n\n        this.style = document.createElement('style');\n        this.get_root_head().appendChild(this.style);\n    }\n\n    private get_root_html(): Element {\n        return document.documentElement;\n    }\n\n    private get_root_head(): Element {\n        return document.head;\n    }\n\n    private get_root_body(): Element {\n        return document.body;\n    }\n\n    public set(id: number, value: NodeType) {\n        if (id === 1 || id === 2 || id === 3) {\n            //ignore\n        } else {\n            this.data.set(id, value);\n        }\n    }\n\n    public get_any_option(id: number): NodeType | undefined {\n        if (id === 1) {\n            return this.get_root_html();\n        }\n\n        if (id === 2) {\n            return this.get_root_head();\n        }\n\n        if (id === 3) {\n            return this.get_root_body();\n        }\n\n        return this.data.get(id);\n    }\n\n    public get_any(label: string, id: number): NodeType {\n        const item = this.get_any_option(id);\n\n        if (item === undefined) {\n            throw Error(`${label} -> item not found=${id}`);\n        }\n\n        return item;\n    }\n\n    public get(label: string, id: number): NodeType {\n        const item = this.get_any_option(id);\n\n        if (item === undefined) {\n            throw new Error(`${label}->get: Item id not found = ${id}`);\n        }\n        return item;\n    }\n\n    public get_node_element(label: string, id: number): HTMLElement {\n        const node = this.get(label, id);\n        if (node instanceof HTMLElement) {\n            return node;\n        } else {\n            throw Error(`Expected id=${id} as HTMLElement`);\n        }\n    }\n\n    public get_node(label: string, id: number): Element {\n        const node = this.get(label, id);\n        if (node instanceof Element) {\n            return node;\n        } else {\n            throw Error(`Expected id=${id} as Element`);\n        }\n    }\n\n    public get_text(label: string, id: number): Text {\n        const node = this.get(label, id);\n        if (node instanceof Text) {\n            return node;\n        } else {\n            throw Error(`Expected id=${id} as Text`);\n        }\n    }\n\n    public get_comment(label: string, id: number): Comment {\n        const node = this.get(label, id);\n        if (node instanceof Comment) {\n            return node;\n        } else {\n            throw Error(`Expected id=${id} as Comment`);\n        }\n    }\n\n    public delete(label: string, id: number): NodeType {\n        const item = this.get_any_option(id);\n        this.data.delete(id);\n\n        if (item === undefined) {\n            throw new Error(`${label}->delete: Item id not found = ${id}`);\n        }\n\n        return item;\n    }\n\n    public insert_css(selector: string | null, value: string) {\n        if (selector !== null) {\n            // Add autocss styles\n            const content = document.createTextNode(`\\n${selector} { ${value} }`);\n            this.style.appendChild(content);\n        } else {\n            // Add bundle (i.e. a tailwind bundle)\n            const content = document.createTextNode(`\\n${value}`);\n            this.style.appendChild(content);\n        }\n    }\n\n    public removeInitNodes() {\n        const initNodes = this.initNodes;\n        this.initNodes = null;\n\n        if (initNodes === null) {\n            return;\n        }\n\n        for (const node of initNodes) {\n            node.remove();\n        }\n    }\n\n    public insert_before(parent: number, child: number, ref_id: number | null | undefined) {\n        const parentNode = this.get(\"insert_before\", parent);\n        const childNode = this.get_any(\"insert_before child\", child);\n\n        if (ref_id === null || ref_id === undefined) {\n            parentNode.insertBefore(childNode, null);\n        } else {\n            const ref_node = this.get_any('insert_before ref', ref_id);\n            parentNode.insertBefore(childNode, ref_node);\n        }\n\n        if (parentNode === this.get_root_head()) {\n            //we make sure that the automatically generated styles are always the last element of the head\n            this.get_root_head().appendChild(this.style);\n        }\n    }\n\n    public has(id: number): boolean {\n        return this.data.has(id);\n    }\n\n    public claimNode(id: number, node: NodeType) {\n        this.data.set(id, node);\n    }\n}\n","import { AppLocation } from \"../../location/AppLocation\";\n\nexport function hydrate_link(node: Element, appLocation: AppLocation) {\n    node.addEventListener('click', (e) => {\n        let href = node.getAttribute('href');\n        if (href === null) {\n            return;\n        }\n\n        if (href.startsWith('#') || href.startsWith('http://') || href.startsWith('https://') || href.startsWith('//')) {\n            return;\n        }\n\n        e.preventDefault();\n        appLocation.set('History', 'Push', href);\n        window.scrollTo(0, 0);\n    })\n}\n","import { CommandType } from \"./dom\";\nimport { hydrate_link } from \"./injects\";\nimport { AppLocation } from \"../../location/AppLocation\";\nimport { MapNodes } from \"./map_nodes\";\n\n/**\n * Virtual Element Node - represents a DOM element\n */\ninterface VirtualElement {\n    readonly kind: 'element';\n    readonly id: number;\n    readonly name: string;\n    readonly attributes: Map<string, string>;\n    readonly children: ReadonlyArray<number>;\n}\n\n/**\n * Virtual Text Node - represents a text node\n * Text nodes cannot have children in the DOM\n */\ninterface VirtualText {\n    readonly kind: 'text';\n    readonly id: number;\n    readonly value: string;\n}\n\n/**\n * Virtual Comment Node - represents a comment node\n * Comment nodes cannot have children in the DOM\n */\ninterface VirtualComment {\n    readonly kind: 'comment';\n    readonly id: number;\n    readonly value: string;\n}\n\n/**\n * Algebraic Data Type for Virtual Nodes\n * A virtual node can be one of: Element, Text, or Comment\n */\ntype VirtualNode = VirtualElement | VirtualText | VirtualComment;\n\nconst createVirtualNodes = (commands: Array<CommandType>): Map<number, VirtualNode> => {\n    const virtualNodes = new Map<number, VirtualNode>();\n\n    // First pass: Create nodes\n    for (const command of commands) {\n        if ('CreateNode' in command) {\n            const element: VirtualElement = {\n                kind: 'element',\n                id: command.CreateNode.id,\n                name: command.CreateNode.name.toUpperCase(),\n                attributes: new Map(),\n                children: []\n            };\n            virtualNodes.set(command.CreateNode.id, element);\n        } else if ('CreateText' in command) {\n            const text: VirtualText = {\n                kind: 'text',\n                id: command.CreateText.id,\n                value: command.CreateText.value\n            };\n            virtualNodes.set(command.CreateText.id, text);\n        }\n    }\n\n    // Second pass: Set attributes and build tree structure\n    for (const command of commands) {\n        if ('SetAttr' in command) {\n            const node = virtualNodes.get(command.SetAttr.id);\n            if (node && node.kind === 'element') {\n                node.attributes.set(command.SetAttr.name, command.SetAttr.value);\n            }\n        } else if ('InsertBefore' in command) {\n            const parent = virtualNodes.get(command.InsertBefore.parent);\n            if (!parent || parent.kind !== 'element') continue;\n\n            const childId = command.InsertBefore.child;\n            const refId = command.InsertBefore.ref_id;\n\n            // Need to cast to mutable array for manipulation\n            const children = parent.children as Array<number>;\n\n            if (refId === null || refId === undefined) {\n                children.push(childId);\n            } else {\n                const index = children.indexOf(refId);\n                if (index !== -1) {\n                    children.splice(index, 0, childId);\n                } else {\n                    console.warn(`Hydration: ref_id ${refId} not found in parent ${command.InsertBefore.parent}`);\n                    children.push(childId);\n                }\n            }\n        }\n    }\n\n    return virtualNodes;\n};\n\n/**\n * Normalizes text content by replacing newlines with spaces and trimming\n */\nconst normalizeText = (text: string | null | undefined): string => {\n    return text?.replace('\\n', ' ').trim() || '';\n};\n\n/**\n * Checks if an element node matches a virtual element node by tag name\n */\nconst isElementMatch = (candidate: Node, vNode: VirtualElement): boolean => {\n    return candidate.nodeType === Node.ELEMENT_NODE &&\n        (candidate as Element).tagName === vNode.name;\n};\n\n/**\n * Checks if a text node matches a virtual text node\n */\nconst isTextNodeMatch = (candidate: Node, _vNode: VirtualText): boolean => {\n    return candidate.nodeType === Node.TEXT_NODE;\n};\n\n/**\n * Synchronizes attributes from virtual node to real element\n */\nconst syncAttributes = (element: Element, attributes: Map<string, string>): void => {\n    for (const [name, value] of attributes) {\n        if (element.getAttribute(name) !== value) {\n            element.setAttribute(name, value);\n        }\n    }\n};\n\n/**\n * Updates text content if it differs from the virtual node value\n */\nconst syncTextContent = (textNode: Node, expectedValue: string): void => {\n    const currentText = normalizeText(textNode.textContent);\n    const expectedText = normalizeText(expectedValue);\n\n    if (currentText !== expectedText) {\n        textNode.textContent = expectedValue;\n    }\n};\n\n/**\n * Removes all nodes from the provided array\n */\nconst removeNodes = (\n    nodesToRemove: Array<Node>,\n    depth: number\n): void => {\n    for (const node of nodesToRemove) {\n        if (node && node.parentNode) {\n            if (node.nodeType !== Node.TEXT_NODE) {\n                console.warn(`Hydration ${depth}: Removing node`, node);\n            }\n            node.parentNode.removeChild(node);\n        }\n    }\n};\n\n/**\n * Removes remaining unmatched nodes from the DOM\n */\nconst removeRemainingNodes = (\n    nodesToRemove: Array<Node>,\n    depth: number\n): void => {\n    for (const node of nodesToRemove) {\n        if (node && node.parentNode) {\n            if (depth > 0 && node.nodeType !== Node.TEXT_NODE) {\n                console.warn(`Hydration ${depth}: removing node (2)`, node);\n            }\n            node.parentNode.removeChild(node);\n        }\n    }\n};\n\n/**\n * Claims a node and runs necessary injections\n */\nconst claimAndInjectNode = (\n    candidate: Node,\n    childVId: number,\n    nodes: MapNodes,\n    appLocation: AppLocation\n): void => {\n    if (candidate instanceof Element || candidate instanceof Comment || candidate instanceof Text) {\n        nodes.claimNode(childVId, candidate);\n\n        // Run injects for specific element types\n        if (candidate instanceof Element) {\n            if (candidate.tagName.toLowerCase() === 'a') {\n                hydrate_link(candidate, appLocation);\n            }\n        }\n    }\n};\n\n/**\n * Attempts to match a virtual node with a real DOM node\n * Returns true if a match was found and processed\n */\nconst tryMatchNode = (\n    childVNode: VirtualNode,\n    candidate: Node,\n    depth: number\n): boolean => {\n    switch (childVNode.kind) {\n        case 'element':\n            // Element node matching\n            if (isElementMatch(candidate, childVNode)) {\n                syncAttributes(candidate as Element, childVNode.attributes);\n                return true;\n            }\n            break;\n\n        case 'text':\n            // Text node matching\n            if (isTextNodeMatch(candidate, childVNode)) {\n                syncTextContent(candidate, childVNode.value);\n                return true;\n            }\n            console.error(`Hydration ${depth}: Text node mismatch`, childVNode, candidate);\n            break;\n\n        case 'comment':\n            // Comment node matching - not yet implemented\n            break;\n    }\n\n    return false;\n};\n\n/**\n * Result of attempting to find a match for a virtual node\n */\ninterface MatchResult {\n    matchFound: boolean;\n    remainingNodes: Array<Node>;\n}\n\n/**\n * Finds and processes a matching real node for a virtual child node\n * Returns the remaining unprocessed nodes\n */\nconst findAndProcessMatch = (\n    childVNode: VirtualNode,\n    childVId: number,\n    remainingRealNodes: Array<Node>,\n    depth: number,\n    nodes: MapNodes,\n    appLocation: AppLocation,\n    hydrateNode: (vNodeId: number, realNode: Node) => void\n): MatchResult => {\n    for (let i = 0; i < remainingRealNodes.length; i++) {\n        const candidate = remainingRealNodes[i];\n        if (!candidate) continue;\n\n        const isMatch = tryMatchNode(childVNode, candidate, depth);\n\n        if (isMatch) {\n            // Remove skipped nodes before the match\n            const skippedNodes = remainingRealNodes.slice(0, i);\n            removeNodes(skippedNodes, depth);\n\n            // Claim the matched node\n            claimAndInjectNode(candidate, childVId, nodes, appLocation);\n\n            // Recurse for element nodes\n            if (childVNode.kind === 'element') {\n                hydrateNode(childVId, candidate);\n            }\n\n            // Return remaining nodes after the matched one\n            return {\n                matchFound: true,\n                remainingNodes: remainingRealNodes.slice(i + 1)\n            };\n        }\n    }\n\n    return {\n        matchFound: false,\n        remainingNodes: remainingRealNodes\n    };\n};\n\n/**\n * Hydrates children of a virtual node against real DOM children\n */\nconst hydrateChildren = (\n    vNode: VirtualElement,\n    realChildren: Array<Node>,\n    virtualNodes: Map<number, VirtualNode>,\n    depth: number,\n    nodes: MapNodes,\n    appLocation: AppLocation,\n    hydrateNode: (vNodeId: number, realNode: Node) => void\n): void => {\n    let remainingNodes = realChildren;\n\n    for (const childVId of vNode.children) {\n        const childVNode = virtualNodes.get(childVId);\n        if (!childVNode) continue;\n\n        const result = findAndProcessMatch(\n            childVNode,\n            childVId,\n            remainingNodes,\n            depth,\n            nodes,\n            appLocation,\n            hydrateNode\n        );\n\n        remainingNodes = result.remainingNodes;\n\n        if (!result.matchFound) {\n            // If we couldn't find a match for this virtual child,\n            // we stop trying to match subsequent children in this parent\n            // to avoid misalignment. The remaining virtual children will be created.\n            break;\n        }\n    }\n\n    // Remove remaining unmatched real nodes\n    removeRemainingNodes(remainingNodes, depth);\n};\n\nexport const hydrate = (commands: Array<CommandType>, nodes: MapNodes, appLocation: AppLocation) => {\n    console.info('hydrate ...');\n    const virtualNodes = createVirtualNodes(commands);\n\n    let depth = 0;\n\n    // Recursive hydration function\n    const hydrateNode = (vNodeId: number, realNode: Node): void => {\n        const vNode = virtualNodes.get(vNodeId);\n        if (!vNode) return;\n\n        // Only element nodes can have children\n        if (vNode.kind !== 'element') return;\n\n        const realChildren = Array.from(realNode.childNodes);\n\n        depth++;\n        hydrateChildren(vNode, realChildren, virtualNodes, depth, nodes, appLocation, hydrateNode);\n        depth--;\n    };\n\n    // Start hydration from Body (id=3) and Head (id=2) if needed\n    const bodyVNode = virtualNodes.get(3);\n    if (bodyVNode) {\n        hydrateNode(3, document.body);\n    }\n\n    const headVNode = virtualNodes.get(2);\n    if (headVNode) {\n        hydrateNode(2, document.head);\n    }\n\n    console.log(\"Hydration complete\");\n};\n","\nexport const getDisableHydration = (): boolean => {\n    const metadataDiv = document.getElementById('v-metadata');\n    const value = metadataDiv?.getAttribute('data-env-disable-hydration');\n    return value === 'true';\n};\n\nexport const getEnableHudration = (): boolean => {\n    return !getDisableHydration();\n};\n\n","import { ExportType } from \"../../../wasm_module\";\nimport { MapNodes } from \"./map_nodes\";\nimport { ModuleControllerType } from \"../../../wasm_init\";\nimport { JsJsonType } from \"../../../jsjson\";\nimport { AppLocation } from \"../../location/AppLocation\";\nimport { hydrate } from \"./hydration\";\nimport { hydrate_link } from \"./injects\";\nimport { getEnableHudration } from \"./featureHydration\";\n\ninterface FileItemType {\n    name: string,\n    data: Uint8Array,\n}\n\nconst createElement = (name: string): Element => {\n    if (name == \"path\" || name == \"svg\") {\n        return document.createElementNS(\"http://www.w3.org/2000/svg\", name);\n    } else {\n        return document.createElement(name);\n    }\n}\n\nexport type CommandType = {\n    CreateNode: {\n        id: number,\n        name: string,\n    }\n} | {\n    CreateText: {\n        id: number,\n        value: string\n    }\n} | {\n    UpdateText: {\n        id: number,\n        value: string\n    }\n} | {\n    SetAttr: {\n        id: number,\n        name: string,\n        value: string\n    }\n} | {\n    RemoveAttr: {\n        id: number,\n        name: string\n    }\n} | {\n    RemoveNode: {\n        id: number,\n    }\n} | {\n    RemoveText: {\n        id: number,\n    }\n} | {\n    InsertBefore: {\n        parent: number,\n        child: number,\n        ref_id: number | null,\n    }\n} | {\n    InsertCss: {\n        selector: string | null,\n        value: string\n    }\n} | {\n    CreateComment: {\n        id: number,\n        value: string\n    }\n} | {\n    RemoveComment: {\n        id: number,\n    }\n} | {\n    CallbackAdd: {\n        id: number,\n        event_name: string,\n        callback_id: number,\n    }\n} | {\n    CallbackRemove: {\n        id: number,\n        event_name: string,\n        callback_id: number,\n    }\n};\n\nconst assertNeverCommand = (data: never): never => {\n    console.error(data);\n    throw Error('unknown command');\n};\n\nexport class DriverDom {\n    private appLocation: AppLocation;\n    private readonly getWasm: () => ModuleControllerType<ExportType>;\n    public readonly nodes: MapNodes;\n    private callbacks: Map<bigint, (data: Event) => void>;\n\n    public constructor(appLocation: AppLocation, getWasm: () => ModuleControllerType<ExportType>) {\n        this.appLocation = appLocation;\n        this.getWasm = getWasm;\n        this.nodes = new MapNodes();\n        this.callbacks = new Map();\n\n        document.addEventListener('dragover', (ev): void => {\n            // console.log('File(s) in drop zone');\n            ev.preventDefault();\n        });\n    }\n\n    public debugNodes(...ids: Array<number>) {\n        const result: Record<number, unknown> = {};\n        for (const id of ids) {\n            const value = this.nodes.get_any_option(id);\n            result[id] = value;\n        }\n        console.info('debug nodes', result);\n    }\n\n    private wasm_callback(callback_id: bigint, value: JsJsonType): JsJsonType {\n        return this.getWasm().wasm_command({\n            CallbackCall: {\n                callback_id: Number(callback_id),\n                value: value\n            }\n        });\n    }\n\n    private create_node(id: number, name: string) {\n        if (this.nodes.has(id)) {\n            console.error('create_node - this branch should never occur', id);\n            return;\n        }\n\n        const node = createElement(name);\n        this.nodes.set(id, node);\n\n        if (name.toLowerCase().trim() === 'a') {\n            hydrate_link(node, this.appLocation);\n        }\n    }\n\n    private set_attribute(id: number, name: string, value: string) {\n        const node = this.nodes.get_node(\"set_attribute\", id);\n        node.setAttribute(name, value);\n\n        if (name == \"value\") {\n            if (node instanceof HTMLInputElement) {\n                node.value = value;\n                return;\n            }\n\n            if (node instanceof HTMLTextAreaElement) {\n                node.value = value;\n                node.defaultValue = value;\n                return;\n            }\n        }\n    }\n\n    private remove_attribute(id: number, name: string) {\n        const node = this.nodes.get_node(\"remove_attribute\", id);\n        node.removeAttribute(name);\n\n        if (name == \"value\") {\n            if (node instanceof HTMLInputElement) {\n                node.value = \"\";\n                return;\n            }\n\n            if (node instanceof HTMLTextAreaElement) {\n                node.value = \"\";\n                node.defaultValue = \"\";\n                return;\n            }\n        }\n    }\n\n    private remove_node(id: number) {\n        const node = this.nodes.delete(\"remove_node\", id);\n        node.remove();\n    }\n\n    private create_text(id: number, value: string) {\n        if (this.nodes.has(id)) {\n            console.error('create_text - this branch should never occur', id);\n            return;\n        }\n\n        const text = document.createTextNode(value);\n        this.nodes.set(id, text);\n    }\n\n    private remove_text(id: number) {\n        const text = this.nodes.delete(\"remove_node\", id);\n        text.remove();\n    }\n\n    private update_text(id: number, value: string) {\n        const text = this.nodes.get_text(\"set_attribute\", id);\n        text.textContent = value;\n    }\n\n    private callback_click(event: Event, callback_id: bigint) {\n        event.preventDefault();\n        let click_event = this.wasm_callback(callback_id, undefined);\n\n        // Check if click_event is an object (JsJson Object type)\n        if (click_event !== null && typeof click_event === 'object' && !Array.isArray(click_event)) {\n            if ('stop_propagation' in click_event && click_event['stop_propagation'] === true) {\n                event.stopPropagation();\n            }\n            if ('prevent_default' in click_event && click_event['prevent_default'] === true) {\n                event.preventDefault();\n            }\n        }\n    }\n\n    private callback_submit(event: Event, callback_id: bigint) {\n        event.preventDefault();\n        this.wasm_callback(callback_id, undefined);\n    }\n\n    private callback_input(event: Event, callback_id: bigint) {\n        const target = event.target;\n\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement) {\n            this.wasm_callback(callback_id, target.value);\n            return;\n        }\n\n        console.warn('event input ignore', target);\n    }\n\n    private callback_change(event: Event, callback_id: bigint) {\n        const target = event.target;\n\n        if (target instanceof HTMLInputElement || target instanceof HTMLTextAreaElement || target instanceof HTMLSelectElement) {\n            this.wasm_callback(callback_id, target.value);\n            return;\n        }\n\n        console.warn('event input ignore', target);\n    }\n\n    private callback_blur(_event: Event, callback_id: bigint) {\n        this.wasm_callback(callback_id, undefined);\n    }\n\n    private callback_mousedown(event: Event, callback_id: bigint) {\n        if (this.wasm_callback(callback_id, undefined)) {\n            event.preventDefault()\n        }\n    }\n\n    private callback_mouseup(event: Event, callback_id: bigint) {\n        if (this.wasm_callback(callback_id, undefined)) {\n            event.preventDefault()\n        }\n    }\n\n    private callback_mouseenter(_event: Event, callback_id: bigint) {\n        this.wasm_callback(callback_id, undefined);\n    }\n\n    private callback_mouseleave(_event: Event, callback_id: bigint) {\n        this.wasm_callback(callback_id, undefined);\n    }\n\n    private callback_drop(event: Event, callback_id: bigint) {\n        event.preventDefault();\n\n        if (event instanceof DragEvent) {\n            if (event.dataTransfer === null) {\n                console.error('dom -> drop -> dataTransfer null');\n            } else {\n                const files: Array<Promise<FileItemType>> = [];\n\n                for (let i = 0; i < event.dataTransfer.items.length; i++) {\n                    const item = event.dataTransfer.items[i];\n\n                    if (item === undefined) {\n                        console.error('dom -> drop -> item - undefined');\n                    } else {\n                        const file = item.getAsFile();\n\n                        if (file === null) {\n                            console.error(`dom -> drop -> index:${i} -> It's not a file`);\n                        } else {\n                            files.push(file\n                                .arrayBuffer()\n                                .then((data): FileItemType => ({\n                                    name: file.name,\n                                    data: new Uint8Array(data),\n                                }))\n                            );\n                        }\n                    }\n                }\n\n                if (files.length) {\n                    Promise.all(files).then((files) => {\n                        const params = [];\n\n                        for (const file of files) {\n                            // Convert Uint8Array to array of numbers for JsJson\n                            const dataArray = Array.from(file.data);\n                            params.push([\n                                file.name,\n                                dataArray,\n                            ]);\n                        }\n\n                        this.wasm_callback(callback_id, [params]);\n                    }).catch((error) => {\n                        console.error('callback_drop -> promise.all -> ', error);\n                    });\n                } else {\n                    console.error('No files to send');\n                }\n            }\n        } else {\n            console.warn('event drop ignore', event);\n        }\n    }\n\n    private callback_keydown(event: Event, callback_id: bigint) {\n        if (event instanceof KeyboardEvent) {\n            const result = this.wasm_callback(callback_id, [\n                event.key,\n                event.code,\n                event.altKey,\n                event.ctrlKey,\n                event.shiftKey,\n                event.metaKey\n            ]);\n\n            if (result === true) {\n                event.preventDefault();\n                event.stopPropagation();\n            }\n\n            return;\n        }\n\n        console.warn('keydown ignore', event);\n    }\n\n    private callback_load(event: Event, callback_id: bigint) {\n        event.preventDefault();\n        this.wasm_callback(callback_id, undefined);\n    }\n\n    private callback_add(id: number, event_name: string, callback_id: bigint) {\n        const callback = (event: Event) => {\n            if (event_name === 'click') {\n                return this.callback_click(event, callback_id);\n            }\n\n            if (event_name === 'submit') {\n                return this.callback_submit(event, callback_id);\n            }\n\n            if (event_name === 'input') {\n                return this.callback_input(event, callback_id);\n            }\n\n            if (event_name === 'change') {\n                return this.callback_change(event, callback_id);\n            }\n\n            if (event_name === 'blur') {\n                return this.callback_blur(event, callback_id);\n            }\n\n            if (event_name === 'mousedown') {\n                return this.callback_mousedown(event, callback_id);\n            }\n\n            if (event_name === 'mouseup') {\n                return this.callback_mouseup(event, callback_id);\n            }\n\n            if (event_name === 'mouseenter') {\n                return this.callback_mouseenter(event, callback_id);\n            }\n\n            if (event_name === 'mouseleave') {\n                return this.callback_mouseleave(event, callback_id);\n            }\n\n            if (event_name === 'keydown') {\n                return this.callback_keydown(event, callback_id);\n            }\n\n            if (event_name === 'hook_keydown') {\n                return this.callback_keydown(event, callback_id);\n            }\n\n            if (event_name === 'drop') {\n                return this.callback_drop(event, callback_id);\n            }\n\n            if (event_name === 'load') {\n                return this.callback_load(event, callback_id);\n            }\n\n            console.error(`No support for the event ${event_name}`);\n        };\n\n        if (this.callbacks.has(callback_id)) {\n            console.error(`There was already a callback added with the callback_id=${callback_id}`);\n            return;\n        }\n\n        this.callbacks.set(callback_id, callback);\n\n        if (event_name === 'hook_keydown') {\n            document.addEventListener('keydown', callback, false);\n        } else {\n            const node = this.nodes.get('callback_add', id);\n            node.addEventListener(event_name, callback, false);\n        }\n    }\n\n    private callback_remove(id: number, event_name: string, callback_id: bigint) {\n        const callback = this.callbacks.get(callback_id);\n        this.callbacks.delete(callback_id);\n\n        if (callback === undefined) {\n            console.error(`The callback is missing with the id=${callback_id}`);\n            return;\n        }\n\n        if (event_name === 'hook_keydown') {\n            document.removeEventListener('keydown', callback);\n        } else {\n            const node = this.nodes.get('callback_remove', id);\n            node.removeEventListener(event_name, callback);\n        }\n    }\n\n    public dom_bulk_update = (commands: Array<CommandType>) => {\n        if (getEnableHudration()) {\n            hydrate(commands, this.nodes, this.appLocation);\n        }\n\n        const setFocus: Set<number> = new Set();\n\n        for (const command of commands) {\n            try {\n                this.bulk_update_command(command);\n            } catch (error) {\n                console.error('bulk_update - item', error, command);\n            }\n\n            if ('SetAttr' in command && command.SetAttr.name.toLocaleLowerCase() === 'autofocus') {\n                setFocus.add(command.SetAttr.id);\n            }\n        }\n\n        if (setFocus.size > 0) {\n            setTimeout(() => {\n                for (const id of setFocus) {\n                    const node = this.nodes.get_node_element(`set focus ${id}`, id);\n                    node.focus();\n                }\n            }, 0);\n        }\n\n        if (getEnableHudration() === false) {\n            this.nodes.removeInitNodes();\n        }\n    }\n\n    private bulk_update_command(command: CommandType) {\n        if ('RemoveNode' in command) {\n            this.remove_node(command.RemoveNode.id);\n            return;\n        }\n\n        if ('InsertBefore' in command) {\n            this.nodes.insert_before(command.InsertBefore.parent, command.InsertBefore.child, command.InsertBefore.ref_id === null ? null : command.InsertBefore.ref_id);\n            return;\n        }\n\n        if ('CreateNode' in command) {\n            this.create_node(command.CreateNode.id, command.CreateNode.name);\n            return;\n        }\n\n        if ('CreateText' in command) {\n            this.create_text(command.CreateText.id, command.CreateText.value);\n            return;\n        }\n\n        if ('UpdateText' in command) {\n            this.update_text(command.UpdateText.id, command.UpdateText.value);\n            return;\n        }\n\n        if ('SetAttr' in command) {\n            this.set_attribute(command.SetAttr.id, command.SetAttr.name, command.SetAttr.value);\n            return;\n        }\n\n        if ('RemoveAttr' in command) {\n            this.remove_attribute(command.RemoveAttr.id, command.RemoveAttr.name);\n            return;\n        }\n\n        if ('RemoveText' in command) {\n            this.remove_text(command.RemoveText.id);\n            return;\n        }\n\n        if ('InsertCss' in command) {\n            this.nodes.insert_css(command.InsertCss.selector, command.InsertCss.value);\n            return;\n        }\n\n        if ('CreateComment' in command) {\n            const comment = document.createComment(command.CreateComment.value);\n            this.nodes.set(command.CreateComment.id, comment);\n            return;\n        }\n\n        if ('RemoveComment' in command) {\n            const comment = this.nodes.delete(\"remove_comment\", command.RemoveComment.id);\n            comment.remove();\n            return;\n        }\n\n        if ('CallbackAdd' in command) {\n            this.callback_add(command.CallbackAdd.id, command.CallbackAdd.event_name, BigInt(command.CallbackAdd.callback_id));\n            return;\n        }\n\n        if ('CallbackRemove' in command) {\n            this.callback_remove(command.CallbackRemove.id, command.CallbackRemove.event_name, BigInt(command.CallbackRemove.callback_id));\n            return;\n        }\n\n        return assertNeverCommand(command);\n    }\n}\n","import { DriverWebsocket } from \"./websocket/websocket\";\nimport { assertNever } from \"../assert_never\";\nimport { JsJsonType } from \"../jsjson\";\nimport { ModuleControllerType } from \"../wasm_init\";\nimport { ExportType } from \"../wasm_module\";\nimport { fetchCacheGet } from \"./command/fetchCacheGet\";\nimport { fetchExec, FetchRequestType } from \"./command/fetchExec\";\nimport { CallbackId } from \"./types\";\nimport { Interval } from \"./command/interval\";\nimport { AppLocation } from './location/AppLocation';\nimport { Cookies } from \"./command/cookies\";\nimport { getRandom } from \"./command/getRandom\";\nimport { CommandType, DriverDom } from \"./command/dom/dom\";\n\ntype JsApiCommandType =\n    | { Root: { name: string } }\n    | { RootElement: { dom_id: number } }\n    | { Get: { property: string } }\n    | { Set: { property: string, value: JsJsonType } }\n    | { Call: { method: string, args: JsJsonType[] } };\n\ntype ExecType\n    = 'FetchCacheGet'\n    | 'IsBrowser'\n    | 'GetDateNow'\n    | 'TimezoneOffset'\n    | 'HistoryBack'\n    | {\n        FetchExec: {\n            callback: CallbackId,\n            request: FetchRequestType,\n        }\n    }\n    | {\n        WebsocketRegister: {\n            callback: CallbackId,\n            host: string\n        }\n    }\n    | {\n        WebsocketSendMessage: {\n            callback: CallbackId,\n            message: string,\n        }\n    }\n    | {\n        WebsocketUnregister: {\n            callback: CallbackId,\n        }\n    }\n    | {\n        TimerSet: {\n            callback: CallbackId,\n            duration: number,\n            kind: 'Interval' | 'Timeout',\n        }\n    }\n    | {\n        TimerClear: {\n            callback: CallbackId,\n        }\n    }\n    | {\n        LocationGet: {\n            target: 'Hash' | 'History',\n        }\n    }\n    | {\n        LocationCallback: {\n            callback: number,\n            mode: 'Add' | 'Remove',\n            target: 'Hash' | 'History'\n        }\n    }\n    | {\n        LocationSet: {\n            mode: 'Push' | 'Replace',\n            target: 'Hash' | 'History'\n            value: string\n        }\n    }\n    | {\n        CookieSet: {\n            name: string,\n            value: string,\n            expires_in: number,\n        }\n    }\n    | {\n        CookieGet: {\n            name: string,\n        }\n    }\n    | {\n        CookieJsonSet: {\n            name: string,\n            value: JsJsonType,\n            expires_in: number,\n        }\n    }\n    | {\n        CookieJsonGet: {\n            name: string,\n        }\n    }\n    | {\n        GetEnv: {\n            name: string\n        }\n    }\n    | {\n        ConsoleLog: {\n            arg2: string, //\"color: white; padding: 0 3px; background: green;\",\n            arg3: string, //\"font-weight: bold; color: inherit\",\n            arg4: string, //\"background: inherit; color: inherit\",\n            kind: 'Debug' | 'Info' | 'Log' | 'Warn' | 'Error',\n            message: string, //\"%cINFO%c crates/vertigo/src/driver_module/api/api_fetch_cache.rs:26%c FetchCache ready\"\n        }\n    }\n    | {\n        GetRandom: {\n            min: number,\n            max: number,\n        }\n    }\n    | {\n        JsApiCall: {\n            commands: Array<JsApiCommandType>\n        }\n    }\n    | {\n        DomBulkUpdate: {\n            list: Array<CommandType>\n        }\n    };\n\nexport class ExecCommand {\n    public readonly dom: DriverDom;\n    private readonly websocket: DriverWebsocket;\n    private readonly interval: Interval;\n    private readonly location: AppLocation;\n    private readonly cookie: Cookies;\n\n\n    constructor(private readonly getWasm: () => ModuleControllerType<ExportType>) {\n        const appLocation = new AppLocation(getWasm);\n\n        this.dom = new DriverDom(appLocation, getWasm);\n        this.websocket = new DriverWebsocket(getWasm);\n        this.interval = new Interval(getWasm);\n        this.location = appLocation;\n        this.cookie = new Cookies();\n    }\n\n    exec(arg: JsJsonType): JsJsonType {\n\n        //@ts-expect-error - //TODO Add safe type checking\n        const safeArg: ExecType = arg;\n\n        // console.info('exec arg', safeArg);\n\n        if (safeArg === 'FetchCacheGet') {\n            return fetchCacheGet();\n        }\n\n        if (safeArg === 'IsBrowser') {\n            return {\n                value: true\n            };\n        }\n\n        if (safeArg === 'GetDateNow') {\n            return {\n                value: Date.now(),\n            };\n        }\n\n        if (safeArg === 'TimezoneOffset') {\n            return {\n                value: new Date().getTimezoneOffset()\n            };\n        }\n\n        if (safeArg === 'HistoryBack') {\n            window.history.back();\n            return null;\n        }\n\n        if ('FetchExec' in safeArg) {\n            fetchExec(this.getWasm, safeArg.FetchExec.callback, safeArg.FetchExec.request);\n            return null;\n        }\n\n        if ('WebsocketRegister' in safeArg) {\n            this.websocket.websocket_register_callback(safeArg.WebsocketRegister.host, safeArg.WebsocketRegister.callback);\n            return null;\n        }\n\n        if ('WebsocketSendMessage' in safeArg) {\n            this.websocket.websocket_send_message(safeArg.WebsocketSendMessage.callback, safeArg.WebsocketSendMessage.message);\n            return null;\n        }\n\n        if ('WebsocketUnregister' in safeArg) {\n            this.websocket.websocket_unregister_callback(safeArg.WebsocketUnregister.callback);\n            return null;\n        }\n\n        if ('TimerSet' in safeArg) {\n            this.interval.timerSet(safeArg.TimerSet.callback, safeArg.TimerSet.duration, safeArg.TimerSet.kind);\n            return null;\n        }\n\n        if ('TimerClear' in safeArg) {\n            this.interval.timerClear(safeArg.TimerClear.callback);\n            return null;\n        }\n\n        if ('LocationGet' in safeArg) {\n            return {\n                value: this.location.get(safeArg.LocationGet.target)\n            };\n        }\n\n        if ('LocationCallback' in safeArg) {\n            this.location.callback(safeArg.LocationCallback.target, safeArg.LocationCallback.mode, safeArg.LocationCallback.callback);\n            return null;\n        }\n\n        if ('LocationSet' in safeArg) {\n            this.location.set(safeArg.LocationSet.target, safeArg.LocationSet.mode, safeArg.LocationSet.value);\n            return null;\n        }\n\n        if ('CookieGet' in safeArg) {\n            return {\n                value: this.cookie.get(safeArg.CookieGet.name)\n            };\n        }\n\n        if ('CookieSet' in safeArg) {\n            this.cookie.set(safeArg.CookieSet.name, safeArg.CookieSet.value, safeArg.CookieSet.expires_in);\n            return null;\n        }\n\n        if ('CookieJsonGet' in safeArg) {\n            return {\n                value: this.cookie.get_json(safeArg.CookieJsonGet.name)\n            };\n        }\n\n        if ('CookieJsonSet' in safeArg) {\n            this.cookie.set_json(safeArg.CookieJsonSet.name, safeArg.CookieJsonSet.value, safeArg.CookieJsonSet.expires_in);\n            return null;\n        }\n\n        if ('GetEnv' in safeArg) {\n            const name = safeArg.GetEnv.name;\n\n            return {\n                value: document.getElementById('v-metadata')?.getAttribute(`data-env-${name}`) ?? null\n            }\n        }\n\n        if ('ConsoleLog' in safeArg) {\n            switch (safeArg.ConsoleLog.kind) {\n                case 'Info': {\n                    console.info(safeArg.ConsoleLog.message, safeArg.ConsoleLog.arg2, safeArg.ConsoleLog.arg3, safeArg.ConsoleLog.arg4);\n                    return null;\n                }\n                case 'Debug': {\n                    console.debug(safeArg.ConsoleLog.message, safeArg.ConsoleLog.arg2, safeArg.ConsoleLog.arg3, safeArg.ConsoleLog.arg4);\n                    return null;\n                }\n                case 'Error': {\n                    console.error(safeArg.ConsoleLog.message, safeArg.ConsoleLog.arg2, safeArg.ConsoleLog.arg3, safeArg.ConsoleLog.arg4);\n                    return null;\n                }\n                case 'Log': {\n                    console.log(safeArg.ConsoleLog.message, safeArg.ConsoleLog.arg2, safeArg.ConsoleLog.arg3, safeArg.ConsoleLog.arg4);\n                    return null;\n                }\n                case 'Warn': {\n                    console.warn(safeArg.ConsoleLog.message, safeArg.ConsoleLog.arg2, safeArg.ConsoleLog.arg3, safeArg.ConsoleLog.arg4);\n                    return null;\n                }\n            }\n        }\n\n        if ('GetRandom' in safeArg) {\n            return {\n                value: getRandom(safeArg.GetRandom.min, safeArg.GetRandom.max)\n            };\n        }\n\n        if ('JsApiCall' in safeArg) {\n            return this.executeJsApiCall(safeArg.JsApiCall.commands);\n        }\n\n        if ('DomBulkUpdate' in safeArg) {\n            this.dom.dom_bulk_update(safeArg.DomBulkUpdate.list);\n            return null;\n        }\n\n        console.info('exec_command: Arg', safeArg);\n        return assertNever(safeArg);\n    }\n\n    private executeJsApiCall(commands: Array<JsApiCommandType>): JsJsonType {\n        let current: any = null;\n\n        for (const command of commands) {\n            if ('Root' in command) {\n                if (command.Root.name === 'window') {\n                    current = window;\n                } else if (command.Root.name === 'document') {\n                    current = document;\n                } else {\n                    console.error(`Unknown root: ${command.Root.name}`);\n                    return null;\n                }\n            } else if ('RootElement' in command) {\n                const domId = command.RootElement.dom_id;\n                const node = this.dom.nodes.get_any_option(domId);\n                if (node === undefined) {\n                    console.error(`Element not found: ${domId}`);\n                    return null;\n                }\n                current = node;\n            } else if ('Get' in command) {\n                if (current === null) {\n                    console.error('Get called on null');\n                    return null;\n                }\n                current = current[command.Get.property];\n            } else if ('Set' in command) {\n                if (current === null) {\n                    console.error('Set called on null');\n                    return null;\n                }\n                current[command.Set.property] = command.Set.value;\n                current = undefined;\n            } else if ('Call' in command) {\n                if (current === null) {\n                    console.error('Call called on null');\n                    return null;\n                }\n                current = current[command.Call.method](...command.Call.args);\n            }\n        }\n\n        // Convert result to JsJson\n        if (current === null || current === undefined) {\n            return null;\n        }\n        if (typeof current === 'boolean') {\n            return current;\n        }\n        if (typeof current === 'string') {\n            return current;\n        }\n        if (typeof current === 'number') {\n            return current;\n        }\n        if (Array.isArray(current)) {\n            return current;\n        }\n        if (typeof current === 'object') {\n            return current;\n        }\n        return null;\n    }\n}\n","import { JsJsonType } from \"../../jsjson\";\n\n// interface ResponseType {\n//     data: string | null,\n// }\n\nexport const fetchCacheGet = (): JsJsonType => {\n    const cache = document.getElementById('v-metadata')?.getAttribute('data-fetch-cache') ?? null;\n\n    return {\n        data: cache\n    };\n};\n","import { wasmInit, ModuleControllerType } from './wasm_init';\nimport { BufferCursor } from './buffer_cursor';\nimport { jsJsonDecodeItem, jsJsonGetSize, saveJsJsonToBufferItem } from './jsjson';\nimport { ExecCommand } from './exec_command/exec_command';\n\n//Number -> u32 or i32\n//BigInt -> u64 or i64\n\nexport type ImportType = {\n    panic_message: (long_ptr: bigint) => void,\n    //call from rust\n    dom_access: (long_ptr: bigint) => bigint,\n}\n\nexport type ExportType = {\n    vertigo_export_alloc_block: (size: number) => bigint,\n    vertigo_export_free_block: (pointer: bigint) => void,\n    vertigo_export_wasm_command: (value_ptr: bigint) => bigint,\n    vertigo_entry_function: (major: number, minor: number) => void,\n}\n\nexport class WasmModule {\n    private readonly wasm: ModuleControllerType<ExportType>;\n\n    private constructor(\n        wasm: ModuleControllerType<ExportType>,\n    ) {\n        this.wasm = wasm;\n    }\n\n    public vertigo_entry_function(major: number, minor: number) {\n        this.wasm.exports.vertigo_entry_function(major, minor);\n    }\n\n    public static async create(wasmBinPath: string): Promise<WasmModule> {\n        let wasmModule: ModuleControllerType<ExportType> | null = null;\n\n        const getWasm = (): ModuleControllerType<ExportType> => {\n            if (wasmModule === null) {\n                throw Error('Wasm is no initialized');\n            }\n\n            return wasmModule;\n        };\n\n        const execCommand = new ExecCommand(getWasm);\n\n        //@ts-expect-error\n        window.$vertigoApi = execCommand;\n\n        wasmModule = await wasmInit<ImportType, ExportType>(wasmBinPath, {\n            mod: {\n                panic_message: (long_ptr: bigint) => {\n\n                    const size = Number(long_ptr % (2n ** 32n));\n                    const ptr = Number(long_ptr >> 32n);\n\n                    const decoder = new TextDecoder(\"utf-8\");\n                    const m = getWasm().getUint8Memory().subarray(ptr, ptr + size);\n                    const message = decoder.decode(m);\n                    console.error('PANIC', message);\n                },\n                dom_access: (long_ptr: bigint): bigint => {\n                    if (long_ptr === 0n) {\n                        console.error('dom_access - null pointer');\n                        return 0n;\n                    }\n\n                    // Decode JsJson\n                    const buffer = new BufferCursor(\n                        () => getWasm().getUint8Memory(),\n                        long_ptr\n                    );\n                    const args = jsJsonDecodeItem(buffer);\n                    getWasm().exports.vertigo_export_free_block(long_ptr);\n\n                    // Execute command (now using JsApiCall instead of array-of-arrays)\n                    const response = execCommand.exec(args);\n\n                    // Save JsJson response\n                    const responseSize = jsJsonGetSize(response);\n                    const responseLongPtr = getWasm().exports.vertigo_export_alloc_block(responseSize);\n                    const responseBuffer = new BufferCursor(\n                        () => getWasm().getUint8Memory(),\n                        responseLongPtr\n                    );\n                    saveJsJsonToBufferItem(response, responseBuffer);\n\n                    return responseLongPtr;\n                }\n            }\n        });\n\n        return new WasmModule(wasmModule);\n    }\n}\n","import { WasmModule } from \"./wasm_module\";\n\n// vertigo-cli compatibility version, change together with package version.\nconst VERTIGO_COMPAT_VERSION_MAJOR = 0;\nconst VERTIGO_COMPAT_VERSION_MINOR = 9;\n\nconst moduleRun: Set<string> = new Set();\n\nconst runModule = async (wasm: string) => {\n    if (moduleRun.has(wasm)) {\n        //ok, module is run\n        return;\n    }\n\n    if (moduleRun.size > 0) {\n        console.error('Only one wasm module can be run', { moduleRun, wasm });\n        return;\n    }\n\n    moduleRun.add(wasm);\n\n    console.info(`Wasm module: \"${wasm}\" -> start`);\n    const wasmModule = await WasmModule.create(wasm);\n    console.info(`Wasm module: \"${wasm}\" -> initialized`);\n    wasmModule.vertigo_entry_function(VERTIGO_COMPAT_VERSION_MAJOR, VERTIGO_COMPAT_VERSION_MINOR);\n    console.info(`Wasm module: \"${wasm}\" -> launched vertigo_entry_function with version ${VERTIGO_COMPAT_VERSION_MAJOR}.${VERTIGO_COMPAT_VERSION_MINOR}`);\n};\n\nconst findAndRunModule = async () => {\n    document.querySelectorAll('*[data-vertigo-run-wasm]').forEach((node) => {\n        const wasm = node.getAttribute('data-vertigo-run-wasm');\n\n        if (typeof wasm === 'string') {\n            runModule(wasm);\n        } else {\n            console.error('Run error', node);\n        }\n    });\n};\n\n(() => {\n    window.addEventListener('load', findAndRunModule);\n    setTimeout(findAndRunModule, 3000);\n})();\n"],"names":["decoder","TextDecoder","encoder","TextEncoder","BufferCursor","constructor","getUint8Memory","long_ptr","this","pointer","ptr","Number","size","dataView","DataView","buffer","getByte","value","getUint8","setByte","byte","setUint8","getU16","getUint16","setU16","setUint16","getU32","getUint32","setU32","setUint32","getI32","getInt32","setI32","setInt32","getU64","getBigUint64","setU64","setBigUint64","getI64","getBigInt64","setI64","setBigInt64","getF64","getFloat64","setF64","setFloat64","getBuffer","result","subarray","setBuffer","length","set","getString","decode","setString","encode","getSavedSize","JsJsonConst","jsJsonGetSize","Uint8Array","Array","isArray","sum","item","key","propertyValue","Object","entries","Error","jsJsonDecodeItem","typeId","count","list","i","push","obj","saveJsJsonToBufferItem","undefined","wasmInit","async","wasmBinPath","imports","module_instance","WebAssembly","instantiateStreaming","stream","fetch","err","console","warn","info","resp","binary","arrayBuffer","instantiate","fetchModule","cacheGetUint8Memory","instance","exports","memory","Memory","wasm_command","vertigo_export_alloc_block","result_long_ptr","vertigo_export_wasm_command","resultBuffer","vertigo_export_free_block","EventEmitter","events","Set","on","callback","isActive","onExec","param","add","delete","trigger","eventsCopy","from","values","itemCallbackToRun","error","PromiseBoxRace","promiseResolveReject","resolve","reject","isFulfilled","promise","Promise","localResolve","localReject","createPromiseValue","reconnectDelay","label","timeout_retry","timeout","setTimeout","LogContext","host","formatLog","message","SocketConnection","close","send","eventMessage","connect","log","done","socket","WebSocket","isClose","closeSocket","socketConnection","addEventListener","event","dataRaw","data","startSocket","timeout_connection","onMessage","isConnect","openSocketResult","type","catch","dispose","wasmCallback","wasm","callbackId","command","Websocket","DriverWebsocket","getWasm","websocket_register_callback","callback_id","controller","controllerList","has","assertNeverMessage","Message","websocket_unregister_callback","get","websocket_send_message","Map","getHeaders","headers","k","v","getBodyString","body","JSON","stringify","Data","fetchExec","request","response","url","method","response2","status","contentType","startsWith","Ok","Text","text","Json","json","String","processResponse","FetchExecResponse","responseToWasm","toString","Interval","timerSet","duration","kind","timerId","setInterval","TimerCall","timerClear","timerResource","clearInterval","clearTimeout","HashRouter","LocationCall","remove","new_hash","location","hash","replace","history","replaceState","window","decodeURIComponent","substr","HistoryLocation","pushState","pathname","search","AppLocation","target","mode","locations","newValue","Hash","History","Cookies","cname","cookie","document","split","cookieChunk","trim","cookieName","cookieValue","get_json","cvalue_str","parse","e","cvalue","expires_in","cvalueEncoded","encodeURIComponent","d","Date","setTime","getTime","expires","toUTCString","set_json","getRandom","min","max","range","Math","floor","random","MapNodes","initNodes","get_root_head","childNodes","get_root_body","style","createElement","appendChild","get_root_html","documentElement","head","id","get_any_option","get_any","get_node_element","node","HTMLElement","get_node","Element","get_text","get_comment","Comment","insert_css","selector","content","createTextNode","removeInitNodes","insert_before","parent","child","ref_id","parentNode","childNode","insertBefore","ref_node","claimNode","hydrate_link","appLocation","href","getAttribute","preventDefault","scrollTo","normalizeText","removeNodes","nodesToRemove","depth","nodeType","Node","TEXT_NODE","removeChild","claimAndInjectNode","candidate","childVId","nodes","tagName","toLowerCase","tryMatchNode","childVNode","vNode","ELEMENT_NODE","name","isElementMatch","element","attributes","setAttribute","syncAttributes","isTextNodeMatch","textNode","expectedValue","textContent","findAndProcessMatch","remainingRealNodes","hydrateNode","skippedNodes","slice","matchFound","remainingNodes","hydrateChildren","realChildren","virtualNodes","children","removeRemainingNodes","hydrate","commands","CreateNode","toUpperCase","CreateText","SetAttr","InsertBefore","childId","refId","index","indexOf","splice","createVirtualNodes","vNodeId","realNode","getEnableHudration","metadataDiv","getElementById","getDisableHydration","DriverDom","dom_bulk_update","setFocus","bulk_update_command","toLocaleLowerCase","focus","callbacks","ev","debugNodes","ids","wasm_callback","CallbackCall","create_node","createElementNS","set_attribute","HTMLInputElement","HTMLTextAreaElement","defaultValue","remove_attribute","removeAttribute","remove_node","create_text","remove_text","update_text","callback_click","click_event","stopPropagation","callback_submit","callback_input","callback_change","HTMLSelectElement","callback_blur","_event","callback_mousedown","callback_mouseup","callback_mouseenter","callback_mouseleave","callback_drop","DragEvent","dataTransfer","files","items","file","getAsFile","then","all","params","dataArray","callback_keydown","KeyboardEvent","code","altKey","ctrlKey","shiftKey","metaKey","callback_load","callback_add","event_name","callback_remove","removeEventListener","RemoveNode","UpdateText","RemoveAttr","RemoveText","InsertCss","comment","createComment","CreateComment","RemoveComment","CallbackAdd","BigInt","assertNeverCommand","CallbackRemove","ExecCommand","dom","websocket","interval","exec","arg","safeArg","now","getTimezoneOffset","back","FetchExec","WebsocketRegister","WebsocketSendMessage","WebsocketUnregister","TimerSet","TimerClear","LocationGet","LocationCallback","LocationSet","CookieGet","CookieSet","CookieJsonGet","CookieJsonSet","GetEnv","ConsoleLog","arg2","arg3","arg4","debug","GetRandom","executeJsApiCall","JsApiCall","DomBulkUpdate","assertNever","current","Root","domId","RootElement","dom_id","Get","property","Call","args","WasmModule","vertigo_entry_function","major","minor","create","wasmModule","execCommand","$vertigoApi","mod","panic_message","m","dom_access","responseSize","responseLongPtr","responseBuffer","moduleRun","findAndRunModule","querySelectorAll","forEach","runModule"],"mappings":"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"}